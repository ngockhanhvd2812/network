<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>M√¥ H√¨nh H√≥a IP v√† Subnet Mask</title>
    <style>
        :root {
            --primary-color: #007bff;
            --primary-hover: #0056b3;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --light-bg: #f8f9fa;
            --dark-bg: #343a40;
            --text-color-light: #333;
            --text-color-dark: #f8f9fa;
            --border-color: #dee2e6;
            --card-bg: white;
            --card-shadow: 0 4px 8px rgba(0,0,0,0.1);
            --font-family: Arial, sans-serif;
            --sidebar-width: 280px;
        }

        html[data-theme='dark'] {
            --primary-color: #4dabf7; /* Lighter blue for dark mode contrast */
            --primary-hover: #74c0fc;
            --light-bg: #212529;
            --dark-bg: #f8f9fa;
            --text-color-light: #f8f9fa;
            --text-color-dark: #343a40;
            --border-color: #495057;
            --card-bg: #343a40;
            --card-shadow: 0 4px 12px rgba(0,0,0,0.4);
        }

        html {
            scroll-behavior: smooth;
            scroll-padding-top: 60px; /* Account for fixed header */
        }

        body {
            font-family: var(--font-family);
            margin: 0;
            background-color: var(--light-bg);
            color: var(--text-color-light);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }

        .main-content {
            padding: 20px 40px;
            padding-left: calc(var(--sidebar-width) + 40px);
        }

        h1, h2, h3 {
            color: var(--primary-color);
        }

        h3 {
             border-bottom: 2px solid var(--border-color);
             padding-bottom: 8px;
             margin-top: 30px;
        }

        .section {
            margin-bottom: 40px;
            padding: 25px;
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
            transition: background-color 0.3s, border-color 0.3s;
        }
        
        .section.done {
            border-left: 5px solid var(--success-color);
        }

        .interactive {
            border: 1px solid var(--primary-color);
            padding: 20px;
            border-radius: 10px;
            background-color: color-mix(in srgb, var(--primary-color) 10%, transparent);
            margin-top: 20px;
        }
        
        .case-study {
            padding: 15px;
            background-color: color-mix(in srgb, var(--info-color) 15%, transparent);
            border-left: 4px solid var(--info-color);
            margin-top: 25px;
            border-radius: 8px;
        }

        canvas {
            display: block;
            margin: 20px auto;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            max-width: 100%;
            height: auto;
        }

        input, button, select, textarea {
            padding: 12px;
            margin: 10px 5px;
            font-size: 16px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            background-color: var(--card-bg);
            color: var(--text-color-light);
            width: calc(100% - 24px);
            box-sizing: border-box;
        }
        textarea {
            min-height: 100px;
            font-family: monospace;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px color-mix(in srgb, var(--primary-color) 30%, transparent);
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            width: auto;
        }

        button:hover {
            background-color: var(--primary-hover);
            transform: translateY(-2px);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        th, td {
            border: 1px solid var(--border-color);
            padding: 12px;
            text-align: left;
        }

        th {
            background-color: color-mix(in srgb, var(--primary-color) 10%, transparent);
            font-weight: bold;
        }

        .result-box {
            margin-top: 20px;
            padding: 15px;
            background-color: color-mix(in srgb, var(--success-color) 10%, transparent);
            border-radius: 6px;
            color: var(--text-color-light);
            font-size: 16px;
            min-height: 50px;
            border-left: 4px solid var(--success-color);
            word-wrap: break-word;
        }
        #dhcpResult p[style*="text-align:right"] { 
            text-align: right; 
            color: var(--secondary-color);
            font-style: italic;
        }

        .bit-bar {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px 0;
        }

        .bit {
            width: 25px; height: 25px; line-height: 25px;
            text-align: center; border: 1px solid var(--text-color-light);
            margin: 2px; font-size: 14px; font-weight: bold;
            color: white; transition: transform 0.3s;
        }

        .bit:hover { transform: scale(1.2); }
        .network-bit { background-color: var(--primary-color); }
        .host-bit { background-color: var(--success-color); }

        .analogy {
            background-color: color-mix(in srgb, var(--warning-color) 20%, transparent);
            padding: 15px; border-radius: 8px;
            margin: 20px 0; font-style: italic;
            border-left: 4px solid var(--warning-color);
        }
        
        .sidebar {
            position: fixed; top: 0; left: 0; width: var(--sidebar-width);
            height: 100vh; background-color: var(--card-bg);
            box-shadow: 2px 0 5px rgba(0,0,0,0.1); padding: 20px;
            overflow-y: auto; border-right: 1px solid var(--border-color); z-index: 1000;
        }
        .sidebar h2 { margin-top: 0; }
        .sidebar ul { list-style: none; padding: 0; margin: 0; }
        .sidebar li a {
            display: block; padding: 10px 15px; color: var(--text-color-light);
            text-decoration: none; border-radius: 5px; margin-bottom: 5px; transition: background-color 0.2s;
        }
        .sidebar li a:hover { background-color: color-mix(in srgb, var(--primary-color) 10%, transparent); }
        .sidebar li a.active { background-color: var(--primary-color); color: white; font-weight: bold; }
        .sidebar li a.done::before { content: '‚úî '; color: var(--success-color); }

        .progress-container {
            width: 100%;
            background-color: var(--border-color);
            position: fixed; top: 0; left: 0; 
            z-index: 998; /* Below sidebar, above content */
        }
        .progress-bar {
            height: 8px; width: 0%; background-color: var(--primary-color); transition: width 0.1s linear;
        }

        .theme-toggle {
            position: absolute; top: 20px; right: 20px; background: none;
            border: 1px solid var(--border-color); border-radius: 50%; width: 40px; height: 40px;
            cursor: pointer; font-size: 20px; display: flex; align-items: center; justify-content: center;
        }

        .modal {
            display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%;
            overflow: auto; background-color: rgba(0,0,0,0.5); align-items: center; justify-content: center;
        }
        .modal-content {
            background-color: var(--card-bg); margin: auto; padding: 30px;
            border: 1px solid var(--border-color); width: 80%; max-width: 600px;
            border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); position: relative;
            animation: fadeIn 0.3s;
        }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .close-button {
            color: var(--secondary-color); position: absolute; top: 10px; right: 20px;
            font-size: 28px; font-weight: bold; cursor: pointer;
        }
        .close-button:hover { color: var(--danger-color); }

        .strength-bar {
            height: 8px; background-color: var(--border-color);
            border-radius: 4px; margin-top: 8px; overflow: hidden;
        }
        .strength-bar div {
            height: 100%; width: 0; border-radius: 4px;
            transition: width 0.3s, background-color 0.3s;
        }
        #scoreHistoryChart {
            margin-top: 20px; padding: 15px;
            background-color: color-mix(in srgb, var(--secondary-color) 10%, transparent);
            border-radius: 8px;
        }
        #scoreHistoryChart svg { width: 100%; height: 100px; }
        #scoreHistoryChart .bar { fill: var(--primary-color); transition: height 0.3s; }
        #scoreHistoryChart .bar:hover { fill: var(--primary-hover); }

        .sidebar-toggle {
            display: none; /* Only show on mobile */
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1001; /* Above progress bar, below sidebar */
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            width: 45px; height: 45px;
            font-size: 24px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }

        .sidebar.show {
            transform: translateX(0);
        }
        
        @media (max-width: 992px) {
            body { padding-left: 0; }
            .main-content { padding: 20px; padding-left: 20px; padding-top: 70px; }
            .sidebar { transform: translateX(calc(-1 * var(--sidebar-width))); transition: transform 0.3s ease-in-out; }
            .sidebar-toggle { display: block; }
            .progress-container { width: 100%; left: 0; }
        }
    </style>
</head>
<body>
    <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
    </div>
    
    <button class="sidebar-toggle" id="sidebarToggle" aria-label="Open navigation">‚ò∞</button>
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <nav class="sidebar" id="sidebar">
        <h2>B√†i H·ªçc</h2>
        <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode">üåô</button>
        <ul>
            <li><a href="#intro" id="nav-intro">Gi·ªõi thi·ªáu chung</a></li>
            <li><a href="#step1" id="nav-step1">B∆∞·ªõc 1: IP Address l√† g√¨?</a></li>
            <li><a href="#step2" id="nav-step2">B∆∞·ªõc 2: Subnet Mask l√† g√¨?</a></li>
            <li><a href="#step3" id="nav-step3">B∆∞·ªõc 3: T√≠nh to√°n Subnet</a></li>
            <li><a href="#step4" id="nav-step4">B∆∞·ªõc 4: Quiz c∆° b·∫£n</a></li>
            <li><a href="#step5" id="nav-step5">B∆∞·ªõc 5: M√¥ ph·ªèng m·∫°ng</a></li>
            <li><a href="#step6" id="nav-step6">B∆∞·ªõc 6: Subnetting n√¢ng cao</a></li>
            <li><a href="#step7" id="nav-step7">B∆∞·ªõc 7: IP Public & Private</a></li>
            <li><a href="#step8" id="nav-step8">B∆∞·ªõc 8: Quiz n√¢ng cao</a></li>
            <li><a href="#step9" id="nav-step9">B∆∞·ªõc 9: VLSM</a></li>
            <li><a href="#step10" id="nav-step10">B∆∞·ªõc 10: IPv6</a></li>
            <li><a href="#step11" id="nav-step11">B∆∞·ªõc 11: NAT</a></li>
            <li><a href="#step12" id="nav-step12">B∆∞·ªõc 12: DHCP</a></li>
            <li><a href="#step13" id="nav-step13">B∆∞·ªõc 13: DNS</a></li>
            <li><a href="#step14" id="nav-step14">B∆∞·ªõc 14: Routing</a></li>
            <li><a href="#step15" id="nav-step15">B∆∞·ªõc 15: Firewall</a></li>
            <li><a href="#step16" id="nav-step16">B∆∞·ªõc 16: VPN</a></li>
            <li><a href="#step17" id="nav-step17">B∆∞·ªõc 17: Wi-Fi</a></li>
            <li><a href="#step18" id="nav-step18">B∆∞·ªõc 18: Quiz cu·ªëi c√πng</a></li>
            <li><a href="#step19" id="nav-step19">B∆∞·ªõc 19: Port & Socket</a></li>
            <li><a href="#step20" id="nav-step20">B∆∞·ªõc 20: TCP vs UDP</a></li>
            <li><a href="#step21" id="nav-step21">B∆∞·ªõc 21: M√¥ h√¨nh OSI</a></li>
            <li><a href="#step22" id="nav-step22">B∆∞·ªõc 22: Quiz t·ªïng h·ª£p</a></li>
            <li><a href="#further-reading" id="nav-further-reading">ƒê·ªçc th√™m</a></li>
        </ul>
    </nav>
    
    <div class="main-content">
        <div class="section" id="preface">
            <h2>L·ªùi n√≥i ƒë·∫ßu: T·∫°i sao ph·∫£i hi·ªÉu v·ªÅ M·∫°ng M√°y T√≠nh?</h2>
            <p>Trong th·∫ø gi·ªõi s·ªë hi·ªán nay, t·ª´ vi·ªác l∆∞·ªõt web, g·ª≠i email, ch∆°i game online ƒë·∫øn v·∫≠n h√†nh c√°c trung t√¢m d·ªØ li·ªáu kh·ªïng l·ªì c·ªßa Google, Amazon, t·∫•t c·∫£ ƒë·ªÅu d·ª±a tr√™n n·ªÅn t·∫£ng m·∫°ng m√°y t√≠nh. Hi·ªÉu v·ªÅ ƒë·ªãa ch·ªâ IP, Subnet Mask v√† c√°c kh√°i ni·ªám li√™n quan kh√¥ng ch·ªâ l√† ki·∫øn th·ª©c d√†nh cho chuy√™n gia IT m√† c√≤n l√† k·ªπ nƒÉng c·∫ßn thi·∫øt cho b·∫•t k·ª≥ ai mu·ªën t√¨m hi·ªÉu s√¢u h∆°n v·ªÅ c√¥ng ngh·ªá.</p>
            <p>Kh√≥a h·ªçc n√†y s·∫Ω d·∫´n d·∫Øt b·∫°n qua <strong>22 b∆∞·ªõc</strong>, t·ª´ nh·ªØng kh√°i ni·ªám c∆° b·∫£n nh·∫•t nh∆∞ IP l√† g√¨ cho ƒë·∫øn c√°c ch·ªß ƒë·ªÅ n√¢ng cao nh∆∞ VLSM, IPv6, routing, v√† b·∫£o m·∫≠t m·∫°ng. H√£y c√πng b·∫Øt ƒë·∫ßu h√†nh tr√¨nh kh√°m ph√° x∆∞∆°ng s·ªëng c·ªßa Internet!</p>
        </div>
        
        <h1>M√¥ H√¨nh H√≥a IP v√† Subnet Mask</h1>
        
        <div class="section" id="intro">
            <h2>Gi·ªõi Thi·ªáu Chung: IP, MAC, v√† DNS - B·ªô Ba Quy·ªÅn L·ª±c</h2>
            <p>Tr∆∞·ªõc khi ƒëi s√¢u, h√£y ph√¢n bi·ªát r√µ ba kh√°i ni·ªám c·ªët l√µi:</p>
            <ul>
                <li><strong>ƒê·ªãa ch·ªâ IP (Logical Address):</strong> Nh∆∞ ƒë·ªãa ch·ªâ nh√† c·ªßa b·∫°n, c√≥ th·ªÉ thay ƒë·ªïi n·∫øu b·∫°n chuy·ªÉn nh√†. N√≥ d√πng ƒë·ªÉ ƒë·ªãnh tuy·∫øn g√≥i tin tr√™n Internet.</li>
                <li><strong>ƒê·ªãa ch·ªâ MAC (Physical Address):</strong> Nh∆∞ s·ªë CƒÉn c∆∞·ªõc c√¥ng d√¢n c·ªßa thi·∫øt b·ªã, l√† duy nh·∫•t v√† kh√¥ng ƒë·ªïi. N√≥ d√πng ƒë·ªÉ g·ª≠i d·ªØ li·ªáu trong m·∫°ng n·ªôi b·ªô (LAN).</li>
                <li><strong>DNS (Domain Name System):</strong> Nh∆∞ danh b·∫° ƒëi·ªán tho·∫°i, d·ªãch t√™n mi·ªÅn (v√≠ d·ª•: google.com) th√†nh ƒë·ªãa ch·ªâ IP ƒë·ªÉ m√°y t√≠nh c√≥ th·ªÉ hi·ªÉu v√† k·∫øt n·ªëi.</li>
            </ul>
            <p><strong>V√≠ d·ª• th·ª±c t·∫ø:</strong> Khi b·∫°n g√µ `google.com` v√†o tr√¨nh duy·ªát, m√°y t√≠nh c·ªßa b·∫°n h·ªèi DNS server ƒë·ªÉ l·∫•y IP c·ªßa Google. Sau ƒë√≥, n√≥ t·∫°o g√≥i tin v·ªõi IP ƒë√≠ch ƒë√≥ v√† g·ª≠i ƒë·∫øn router. Qu√° tr√¨nh n√†y ƒë∆∞·ª£c ƒëi·ªÅu ph·ªëi b·ªüi Giao th·ª©c ph√¢n gi·∫£i ƒë·ªãa ch·ªâ (ARP). <strong>Khi m·ªôt m√°y t√≠nh mu·ªën g·ª≠i d·ªØ li·ªáu ƒë·∫øn m·ªôt IP trong c√πng m·∫°ng LAN, n√≥ s·∫Ω g·ª≠i m·ªôt g√≥i tin ARP h·ªèi 'Ai c√≥ IP n√†y? H√£y cho t√¥i bi·∫øt ƒë·ªãa ch·ªâ MAC c·ªßa b·∫°n'. M√°y t√≠nh c√≥ IP ƒë√≥ s·∫Ω tr·∫£ l·ªùi b·∫±ng ƒë·ªãa ch·ªâ MAC c·ªßa m√¨nh.</strong> T√¨m hi·ªÉu th√™m t·∫°i <a href="https://tools.ietf.org/html/rfc826" target="_blank" rel="noopener noreferrer">RFC826 (ARP)</a>.</p>
        </div>

        <div class="section" id="step1">
            <h2>B∆∞·ªõc 1: IP Address L√† G√¨? (Gi·ªëng Nh∆∞ ƒê·ªãa Ch·ªâ Nh√†)</h2>
            <p>H√£y t∆∞·ªüng t∆∞·ª£ng internet nh∆∞ m·ªôt th√†nh ph·ªë kh·ªïng l·ªì. M·ªói m√°y t√≠nh, ƒëi·ªán tho·∫°i l√† m·ªôt ng√¥i nh√†. ƒê·ªÉ g·ª≠i th∆∞ (d·ªØ li·ªáu), c·∫ßn ƒë·ªãa ch·ªâ nh√† ch√≠nh x√°c. ƒê√≥ l√† IP!</p>
            <p>IP IPv4 gi·ªëng nh∆∞: <strong>S·ªë nh√†. ƒê∆∞·ªùng. Ph∆∞·ªùng. Qu·∫≠n</strong> - Nh∆∞ng d√πng s·ªë: xxx.xxx.xxx.xxx (m·ªói xxx t·ª´ 0-255). V√≠ d·ª•: 192.168.1.1.</p>
            <div class="analogy"><strong>V√≠ D·ª• ƒê·ªùi Th∆∞·ªùng:</strong> IP 192.168.1.1 gi·ªëng nh∆∞ "S·ªë 1, Ng√µ 1, Ph·ªë 168, Qu·∫≠n 192". Ph·∫ßn ƒë·∫ßu l√† khu v·ª±c l·ªõn, ph·∫ßn sau l√† nh√† c·ª• th·ªÉ.</div>
            
            <h3>Ph√¢n L·ªõp ƒê·ªãa Ch·ªâ IPv4 (Kh√°i ni·ªám c≈© nh∆∞ng h·ªØu √≠ch)</h3>
            <p>Tr∆∞·ªõc ƒë√¢y, IPv4 ƒë∆∞·ª£c chia th√†nh c√°c l·ªõp ƒë·ªÉ x√°c ƒë·ªãnh k√≠ch th∆∞·ªõc m·∫°ng m·∫∑c ƒë·ªãnh. M·∫∑c d√π ng√†y nay CIDR (s·∫Ω h·ªçc ·ªü b∆∞·ªõc 2) ƒë√£ thay th·∫ø, hi·ªÉu v·ªÅ c√°c l·ªõp v·∫´n c√≥ √≠ch.</p>
            <table>
                <thead><tr><th>L·ªõp</th><th>D·∫£i ƒë·ªãa ch·ªâ ƒë·∫ßu</th><th>Subnet Mask M·∫∑c ƒë·ªãnh</th><th>M·ª•c ƒë√≠ch s·ª≠ d·ª•ng</th></tr></thead>
                <tbody>
                    <tr><td>A</td><td>1.0.0.0 ‚Äì 126.255.255.255</td><td>255.0.0.0 (/8)</td><td>C√°c m·∫°ng r·∫•t l·ªõn, ISP</td></tr>
                    <tr><td>B</td><td>128.0.0.0 ‚Äì 191.255.255.255</td><td>255.255.0.0 (/16)</td><td>C√°c m·∫°ng trung b√¨nh ƒë·∫øn l·ªõn</td></tr>
                    <tr><td>C</td><td>192.0.0.0 ‚Äì 223.255.255.255</td><td>255.255.255.0 (/24)</td><td>C√°c m·∫°ng nh·ªè, m·∫°ng gia ƒë√¨nh, doanh nghi·ªáp nh·ªè</td></tr>
                    <tr><td>D</td><td>224.0.0.0 ‚Äì 239.255.255.255</td><td>N/A</td><td>Multicast (g·ª≠i ƒë·∫øn m·ªôt nh√≥m)</td></tr>
                    <tr><td>E</td><td>240.0.0.0 ‚Äì 255.255.255.255</td><td>N/A</td><td>D·ª± tr·ªØ, nghi√™n c·ª©u (Experimental)</td></tr>
                </tbody>
            </table>
            <p><strong>L∆∞u √Ω:</strong> D·∫£i 127.x.x.x ƒë∆∞·ª£c d√†nh ri√™ng cho loopback (v√≠ d·ª• `127.0.0.1` l√† ch√≠nh m√°y t√≠nh c·ªßa b·∫°n).</p>

            <h3>S∆° ƒê·ªì Minh H·ªça: C·∫•u Tr√∫c IP Nh∆∞ M·ªôt Ng√¥i Nh√†</h3>
            <canvas id="ipHouseCanvas" width="600" height="300"></canvas>
            <div class="interactive">
                <h3>T∆∞∆°ng T√°c 1: Th·ª≠ Nh·∫≠p IP V√† Xem N√≥ Sang S·ªë Nh·ªã Ph√¢n (0 v√† 1)</h3>
                <p>M√°y t√≠nh hi·ªÉu IP b·∫±ng 32 con s·ªë 0 ho·∫∑c 1 (bit). H√£y th·ª≠ nh·∫≠p IP ƒë·ªÉ xem!</p>
                <input type="text" id="ipInputBinary" placeholder="Nh·∫≠p IP: 192.168.1.1" aria-label="IP to Binary Input" />
                <button onclick="convertToBinary()" aria-label="Convert IP to Binary">Chuy·ªÉn Sang Nh·ªã Ph√¢n</button>
                <div id="binaryResult" class="result-box"></div>
            </div>
        </div>
        <div class="section" id="step2">
            <h2>B∆∞·ªõc 2: Subnet Mask L√† G√¨? (Gi·ªëng Nh∆∞ Ranh Gi·ªõi Khu Ph·ªë)</h2>
            <p>N·∫øu th√†nh ph·ªë qu√° l·ªõn, ta chia th√†nh c√°c khu ph·ªë nh·ªè (subnet) ƒë·ªÉ d·ªÖ qu·∫£n l√Ω. Subnet Mask l√† "ranh gi·ªõi" n√≥i r·∫±ng ph·∫ßn n√†o l√† khu ph·ªë (network), ph·∫ßn n√†o l√† nh√† ri√™ng (host).</p>
            <p>V√≠ d·ª•: Subnet Mask 255.255.255.0 (ho·∫∑c /24) nghƒ©a l√† 24 bit ƒë·∫ßu l√† khu ph·ªë, 8 bit sau l√† nh√† (c√≥ th·ªÉ c√≥ 2^8 = 256 ƒë·ªãa ch·ªâ). <strong>Tuy nhi√™n, ch√∫ng ta ph·∫£i tr·ª´ ƒëi 2 ƒë·ªãa ch·ªâ: m·ªôt ƒë·ªãa ch·ªâ ƒë·∫ßu ti√™n d√πng l√†m ƒë·ªãa ch·ªâ m·∫°ng (Network Address) v√† m·ªôt ƒë·ªãa ch·ªâ cu·ªëi c√πng d√πng l√†m ƒë·ªãa ch·ªâ qu·∫£ng b√° (Broadcast Address).</strong> V√¨ v·∫≠y, th·ª±c t·∫ø ch·ªâ c√≥ 254 nh√† d√πng ƒë∆∞·ª£c.</p>
            <div class="analogy"><strong>V√≠ D·ª• ƒê·ªùi Th∆∞·ªùng:</strong> Subnet Mask nh∆∞ bi·ªÉn b√°o "Khu ph·ªë t·ª´ s·ªë 1 ƒë·∫øn 255". N·∫øu v∆∞·ª£t ra, th∆∞ s·∫Ω kh√¥ng ƒë·∫øn ƒë√∫ng khu.</div>
            <h3>S∆° ƒê·ªì Minh H·ªça: Chia Khu Ph·ªë V·ªõi Subnet</h3>
            <canvas id="subnetCityCanvas" width="600" height="400"></canvas>
            <div class="interactive">
                <h3>T∆∞∆°ng T√°c 2: K√©o Slider ƒê·ªÉ Thay ƒê·ªïi K√≠ch Th∆∞·ªõc Khu Ph·ªë</h3>
                <p>K√©o thanh tr∆∞·ª£t ƒë·ªÉ thay ƒë·ªïi /CIDR (s·ªë bit cho khu ph·ªë). Xem s·ªë nh√† (host) thay ƒë·ªïi th·∫ø n√†o!</p>
                <label for="cidrSlider">CIDR (/prefix): <span id="cidrValue">24</span></label>
                <input type="range" id="cidrSlider" min="0" max="32" value="24" oninput="updateCidr()" aria-label="CIDR Slider" />
                <div id="bitBar" class="bit-bar"></div>
                <p>M√†u xanh d∆∞∆°ng: Khu ph·ªë (Network). M√†u xanh l√°: Nh√† ri√™ng (Host).</p>
                <p>S·ªë nh√† kh·∫£ d·ª•ng trong khu: <span id="hostCount">254</span> (lu√¥n tr·ª´ 2 cho ƒë·ªãa ch·ªâ m·∫°ng v√† qu·∫£ng b√°).</p>
            </div>
        </div>
        <div class="section" id="step3">
            <h2>B∆∞·ªõc 3: T√≠nh To√°n Subnet (Xem Khu Ph·ªë C·ª• Th·ªÉ)</h2>
            <p>B√¢y gi·ªù, v·ªõi IP v√† Subnet, ta t√≠nh ƒë∆∞·ª£c: ƒê·ªãa ch·ªâ khu ph·ªë ƒë·∫ßu (Network), ƒë·ªãa ch·ªâ cu·ªëi (Broadcast - g·ª≠i cho t·∫•t c·∫£), v√† d·∫£i nh√† d√πng ƒë∆∞·ª£c.</p>
            <div class="analogy"><strong>V√≠ D·ª• ƒê·ªùi Th∆∞·ªùng:</strong> V·ªõi ƒë·ªãa ch·ªâ "S·ªë 10, Ng√µ 1, Ph·ªë 168, Qu·∫≠n 192" v√† ranh gi·ªõi /24, khu ph·ªë l√† t·ª´ s·ªë 1 ƒë·∫øn 255 ·ªü Ng√µ 1, Ph·ªë 168, Qu·∫≠n 192.</div>
            <h3>S∆° ƒê·ªì Minh H·ªça: D·∫£i ƒê·ªãa Ch·ªâ Trong Khu Ph·ªë</h3>
            <canvas id="addressRangeCanvas" width="600" height="200"></canvas>
            <div class="interactive">
                <h3>T∆∞∆°ng T√°c 3: Nh·∫≠p IP V√† CIDR ƒê·ªÉ T√≠nh To√°n</h3>
                <input type="text" id="ipInputSubnet" placeholder="IP: 192.168.1.10 ho·∫∑c 192.168.1.10/24" aria-label="IP for Subnet Calculation" />
                <input type="text" id="cidrInputSubnet" placeholder="CIDR: /24 (ho·∫∑c ƒë·ªÉ tr·ªëng n·∫øu nh·∫≠p ·ªü tr√™n)" aria-label="CIDR for Subnet Calculation" />
                <button onclick="calculateSubnet()" aria-label="Calculate Subnet">T√≠nh V√† Minh H·ªça</button>
                <div id="subnetResult" class="result-box"></div>
            </div>
            <div class="interactive">
                <h3>T∆∞∆°ng T√°c 4: Ki·ªÉm Tra IP C√≥ Thu·ªôc Khu Ph·ªë Kh√¥ng?</h3>
                <p>Nh·∫≠p Network (v√≠ d·ª• 192.168.1.0/24) v√† m·ªôt IP ƒë·ªÉ ki·ªÉm tra.</p>
                <input type="text" id="networkInput" placeholder="Network: 192.168.1.0/24" aria-label="Network address to check against" />
                <input type="text" id="checkIpInput" placeholder="IP c·∫ßn ki·ªÉm tra: 192.168.1.50" aria-label="IP to check" />
                <button onclick="checkIpInSubnet()" aria-label="Check if IP is in Subnet">Ki·ªÉm Tra</button>
                <div id="checkResult" class="result-box"></div>
            </div>
            <div class="case-study">
               <h3>Case Study: Ph√¢n chia m·∫°ng cho vƒÉn ph√≤ng</h3>
               <p>M·ªôt c√¥ng ty ƒë∆∞·ª£c c·∫•p d·∫£i m·∫°ng <strong>192.168.0.0/22</strong>. H·ªç c·∫ßn chia ra c√°c m·∫°ng con cho c√°c ph√≤ng ban:</p>
               <ul>
                   <li><strong>Ph√≤ng K·∫ø to√°n (50 ng∆∞·ªùi):</strong> C·∫ßn m·ªôt subnet. H·ªç c√≥ th·ªÉ d√πng <strong>192.168.1.0/26</strong> (cung c·∫•p 62 host).</li>
                   <li><strong>Ph√≤ng K·ªπ thu·∫≠t (120 ng∆∞·ªùi):</strong> C·∫ßn subnet l·ªõn h∆°n. H·ªç c√≥ th·ªÉ d√πng <strong>192.168.2.0/25</strong> (cung c·∫•p 126 host).</li>
                   <li><strong>H·ªá th·ªëng Camera IoT (20 thi·∫øt b·ªã):</strong> C·∫ßn subnet nh·ªè. H·ªç c√≥ th·ªÉ d√πng <strong>192.168.3.0/27</strong> (cung c·∫•p 30 host).</li>
               </ul>
               <p>Vi·ªác chia subnet gi√∫p tƒÉng c∆∞·ªùng b·∫£o m·∫≠t (ch·ªâ c√°c thi·∫øt b·ªã trong c√πng subnet giao ti·∫øp d·ªÖ d√†ng) v√† d·ªÖ d√†ng qu·∫£n l√Ω.</p>
           </div>
        </div>
        <div class="section" id="step4">
            <h2>B∆∞·ªõc 4: Quiz ƒê·ªÉ Ki·ªÉm Tra V√† H·ªçc Th√™m</h2>
            <p>Th·ª≠ quiz n√†y ƒë·ªÉ xem b·∫°n hi·ªÉu ƒë·∫øn ƒë√¢u. C√≥ g·ª£i √Ω n·∫øu sai!</p>
            <div class="interactive">
                <p>C√¢u 1: IP IPv4 c√≥ bao nhi√™u bit?</p>
                <select id="quiz1" aria-label="Quiz question 1"><option value="">Ch·ªçn...</option><option value="32">32 bit (4 nh√≥m 8 bit)</option><option value="64">64 bit</option><option value="16">16 bit</option></select>
                <p>C√¢u 2: Subnet /24 c√≥ bao nhi√™u bit cho khu ph·ªë (network)?</p>
                <select id="quiz2" aria-label="Quiz question 2"><option value="">Ch·ªçn...</option><option value="24">24 bit</option><option value="8">8 bit</option><option value="32">32 bit</option></select>
                <p>C√¢u 3: V·ªõi /24, s·ªë nh√† (host) kh·∫£ d·ª•ng l√† bao nhi√™u?</p>
                <select id="quiz3" aria-label="Quiz question 3"><option value="">Ch·ªçn...</option><option value="254">254 (2^8 - 2)</option><option value="256">256</option><option value="128">128</option></select>
                <button onclick="checkQuiz()" aria-label="Check Basic Quiz Answers">Ki·ªÉm Tra ƒê√°p √Ån</button>
                <div id="quizResult" class="result-box"></div>
            </div>
        </div>
        <div class="section" id="step5">
            <h2>B∆∞·ªõc 5: M√¥ Ph·ªèng M·∫°ng ƒê∆°n Gi·∫£n</h2>
            <p>Xem m·ªôt m·∫°ng v·ªõi router v√† c√°c m√°y t√≠nh k·∫øt n·ªëi, m·ªói c√°i c√≥ IP trong subnet.</p>
            <canvas id="networkSimulationCanvas" width="800" height="400"></canvas>
        </div>
        <div class="section" id="step6">
            <h2>B∆∞·ªõc 6: Subnetting N√¢ng Cao - Chia M·∫°ng Con</h2>
            <p>B√¢y gi·ªù, ch√∫ng ta h·ªçc c√°ch chia m·ªôt m·∫°ng l·ªõn th√†nh nhi·ªÅu m·∫°ng con nh·ªè h∆°n. V√≠ d·ª•, t·ª´ m·ªôt m·∫°ng /24 (256 ƒë·ªãa ch·ªâ), chia th√†nh 4 m·∫°ng con /26 (m·ªói c√°i 64 ƒë·ªãa ch·ªâ).</p>
            <div class="analogy"><strong>V√≠ D·ª• ƒê·ªùi Th∆∞·ªùng:</strong> B·∫°n c√≥ m·ªôt khu ƒë·∫•t l·ªõn, chia th√†nh 4 khu nh·ªè ƒë·ªÉ b√°n. M·ªói khu nh·ªè c√≥ ranh gi·ªõi ri√™ng.</div>
            <h3>S∆° ƒê·ªì Minh H·ªça: Chia M·∫°ng Th√†nh C√°c Subnet</h3>
            <canvas id="subnettingCanvas" width="600" height="400"></canvas>
            <div class="interactive">
                <h3>T∆∞∆°ng T√°c 5: Chia Subnet</h3>
                <p>Nh·∫≠p network g·ªëc v√† s·ªë subnet c·∫ßn chia.</p>
                <input type="text" id="baseNetwork" placeholder="Network g·ªëc: 192.168.1.0/24" aria-label="Base network for subnetting"/>
                <input type="number" id="numSubnets" placeholder="S·ªë subnet: 4" min="2" max="128" aria-label="Number of subnets to create"/>
                <button onclick="calculateSubnets()" aria-label="Calculate Subnets">Chia Subnet</button>
                <button id="useForVlsmBtn" style="display:none;" onclick="populateVlsm()">D√πng k·∫øt qu·∫£ cho VLSM</button>
                <div id="subnettingResult" class="result-box"></div>
            </div>
        </div>
        <div class="section" id="step7">
            <h2>B∆∞·ªõc 7: IP Public V√† Private - Internet Th·ª±c T·∫ø</h2>
            <p>IP Private (nh∆∞ 192.168.x.x) d√πng trong nh√†/m·∫°ng n·ªôi b·ªô, kh√¥ng ra internet. IP Public l√† ƒë·ªãa ch·ªâ th·∫≠t tr√™n internet, do ISP cung c·∫•p.</p>
            <p>C√°c d·∫£i IP Private ƒë∆∞·ª£c quy ƒë·ªãnh trong RFC 1918:</p>
            <ul>
                <li><strong>10.0.0.0 /8</strong> (10.0.0.0 ƒë·∫øn 10.255.255.255)</li>
                <li><strong>172.16.0.0 /12</strong> (172.16.0.0 ƒë·∫øn 172.31.255.255)</li>
                <li><strong>192.168.0.0 /16</strong> (192.168.0.0 ƒë·∫øn 192.168.255.255)</li>
            </ul>
            <p><strong>L∆∞u √Ω ƒë·∫∑c bi·ªát:</strong> N·∫øu m√°y t√≠nh c·ªßa b·∫°n nh·∫≠n ƒë∆∞·ª£c IP trong d·∫£i <strong>169.254.0.0/16</strong>, ƒë√≥ l√† ƒë·ªãa ch·ªâ APIPA (Automatic Private IP Addressing). N√≥ c√≥ nghƒ©a l√† m√°y t√≠nh kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn m√°y ch·ªß DHCP ƒë·ªÉ nh·∫≠n IP.</p>
            <div class="analogy"><strong>V√≠ D·ª• ƒê·ªùi Th∆∞·ªùng:</strong> IP Private nh∆∞ s·ªë ph√≤ng trong nh√† b·∫°n. IP Public nh∆∞ ƒë·ªãa ch·ªâ nh√† ngo√†i ƒë∆∞·ªùng l·ªõn.</div>
            <h3>S∆° ƒê·ªì Minh H·ªça: M·∫°ng N·ªôi B·ªô V√† Internet</h3>
            <canvas id="publicPrivateCanvas" width="600" height="300"></canvas>
            <div class="interactive">
                <h3>T∆∞∆°ng T√°c 6: Ki·ªÉm Tra IP L√† Public Hay Private</h3>
                <input type="text" id="ipTypeInput" placeholder="Nh·∫≠p IP: 192.168.1.1" aria-label="IP to check type" />
                <button onclick="checkIpType()" aria-label="Check IP Type">Ki·ªÉm Tra</button>
                <div id="ipTypeResult" class="result-box"></div>
            </div>
        </div>
        <div class="section" id="step8">
            <h2>B∆∞·ªõc 8: Quiz N√¢ng Cao</h2>
            <p>Th·ª≠ quiz ƒë·ªÉ ki·ªÉm tra ki·∫øn th·ª©c n√¢ng cao!</p>
            <div class="interactive">
                <p>C√¢u 1: V·ªõi /27, s·ªë host kh·∫£ d·ª•ng l√† bao nhi√™u?</p>
                <select id="quiz4" aria-label="Advanced quiz question 1"><option value="">Ch·ªçn...</option><option value="30">30 (2^5 - 2)</option><option value="32">32</option><option value="62">62</option></select>
                <p>C√¢u 2: IP 10.0.0.1 l√† lo·∫°i g√¨?</p>
                <select id="quiz5" aria-label="Advanced quiz question 2"><option value="">Ch·ªçn...</option><option value="private">Private</option><option value="public">Public</option></select>
                <button onclick="checkAdvancedQuiz()" aria-label="Check Advanced Quiz Answers">Ki·ªÉm Tra</button>
                <div id="advancedQuizResult" class="result-box"></div>
            </div>
        </div>
        <div class="section" id="step9">
            <h2>B∆∞·ªõc 9: VLSM - Variable Length Subnet Mask (Subnet Linh Ho·∫°t)</h2>
            <p>VLSM cho ph√©p chia subnet v·ªõi k√≠ch th∆∞·ªõc kh√°c nhau, ti·∫øt ki·ªám ƒë·ªãa ch·ªâ IP. Thay v√¨ chia ƒë·ªÅu, b·∫°n c√≥ th·ªÉ c√≥ subnet l·ªõn nh·ªè t√πy nhu c·∫ßu. Nguy√™n t·∫Øc quan tr·ªçng l√† <strong>s·∫Øp x·∫øp c√°c y√™u c·∫ßu v·ªÅ s·ªë host t·ª´ l·ªõn nh·∫•t ƒë·∫øn nh·ªè nh·∫•t</strong> tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu chia m·∫°ng.</p>
            <p>ƒê·ªÉ t√≠nh prefix cho m·ªôt s·ªë l∆∞·ª£ng host y√™u c·∫ßu, ta l√†m theo c√°c b∆∞·ªõc sau:</p>
            <ol>
                <li>L·∫•y s·ªë host y√™u c·∫ßu c·ªông th√™m 2 (ƒë·ªÉ d√†nh cho ƒë·ªãa ch·ªâ m·∫°ng v√† broadcast).</li>
                <li>T√¨m s·ªë <code>x</code> nh·ªè nh·∫•t sao cho <code>2^x</code> l·ªõn h∆°n ho·∫∑c b·∫±ng k·∫øt qu·∫£ tr√™n. <code>x</code> ch√≠nh l√† s·ªë bit c·∫ßn cho ph·∫ßn host.</li>
                <li>Prefix (CIDR) m·ªõi s·∫Ω l√† <code>32 - x</code>.</li>
            </ol>
            <div class="analogy"><strong>V√≠ D·ª• ƒê·ªùi Th∆∞·ªùng:</strong> Chia khu ƒë·∫•t th√†nh c√°c ph·∫ßn: m·ªôt ph·∫ßn l·ªõn cho c√¥ng vi√™n, ph·∫ßn nh·ªè cho nh√† ·ªü, t√πy theo nhu c·∫ßu.</div>
            <h3>S∆° ƒê·ªì Minh H·ªça: VLSM V·ªõi C√°c Subnet K√≠ch Th∆∞·ªõc Kh√°c Nhau</h3>
            <canvas id="vlsmCanvas" width="600" height="400"></canvas>
            <div class="interactive">
                <h3>T∆∞∆°ng T√°c 7: T√≠nh VLSM</h3>
                <p>Nh·∫≠p network g·ªëc v√† c√°c k√≠ch th∆∞·ªõc host c·∫ßn (c√°ch nhau b·ªüi d·∫•u ph·∫©y, v√≠ d·ª•: 100,50,20). Script s·∫Ω t·ª± ƒë·ªông s·∫Øp x·∫øp.</p>
                <input type="text" id="vlsmNetwork" placeholder="Network g·ªëc: 192.168.0.0/16" aria-label="Base network for VLSM"/>
                <input type="text" id="vlsmHosts" placeholder="Host c·∫ßn: 100, 50, 20, 5, 2" aria-label="Required host counts for VLSM"/>
                <button onclick="calculateVLSM()" aria-label="Calculate VLSM">T√≠nh VLSM</button>
                <div id="vlsmResult" class="result-box"></div>
            </div>
        </div>
        <div class="section" id="step10">
            <h2>B∆∞·ªõc 10: IPv6 - Th·∫ø H·ªá IP M·ªõi</h2>
            <p>IPv4 s·∫Øp h·∫øt ƒë·ªãa ch·ªâ, IPv6 d√πng 128 bit, d·∫°ng hex (v√≠ d·ª•: 2001:0db8:85a3:0000:0000:8a2e:0370:7334). N√≥ gi·∫£i quy·∫øt thi·∫øu h·ª•t ƒë·ªãa ch·ªâ.</p>
             <h3>C√°c Lo·∫°i ƒê·ªãa Ch·ªâ IPv6 Ph·ªï Bi·∫øn</h3>
            <ul>
                <li><strong>Global Unicast:</strong> T∆∞∆°ng t·ª± IP public, c√≥ th·ªÉ ƒë·ªãnh tuy·∫øn to√†n c·∫ßu. B·∫Øt ƒë·∫ßu b·∫±ng `2000::/3`.</li>
                <li><strong>Link-Local:</strong> T·ª± ƒë·ªông c·∫•u h√¨nh tr√™n m·ªçi giao di·ªán, ch·ªâ d√πng trong m·∫°ng LAN. B·∫Øt ƒë·∫ßu b·∫±ng `fe80::/10`.</li>
                <li><strong>Unique Local:</strong> T∆∞∆°ng t·ª± IP private, d√πng trong m·∫°ng n·ªôi b·ªô. B·∫Øt ƒë·∫ßu b·∫±ng `fc00::/7`.</li>
            </ul>
            <div class="analogy"><strong>V√≠ D·ª• ƒê·ªùi Th∆∞·ªùng:</strong> IPv4 nh∆∞ s·ªë ƒëi·ªán tho·∫°i 10 ch·ªØ s·ªë s·∫Øp h·∫øt, IPv6 nh∆∞ s·ªë d√†i h∆°n ƒë·ªÉ c√≥ nhi·ªÅu h∆°n.</div>
            <h3>S∆° ƒê·ªì Minh H·ªça: So S√°nh IPv4 V√† IPv6</h3>
            <canvas id="ipv6Canvas" width="600" height="300"></canvas>
            <div class="interactive">
                <h3>T∆∞∆°ng T√°c 8: R√∫t G·ªçn ƒê·ªãa Ch·ªâ IPv6</h3>
                <p>IPv6 cho ph√©p r√∫t g·ªçn b·∫±ng c√°ch b·ªè c√°c s·ªë 0 ƒë·ª©ng ƒë·∫ßu trong m·ªói kh·ªëi v√† thay th·∫ø m·ªôt chu·ªói s·ªë 0 li√™n ti·∫øp d√†i nh·∫•t b·∫±ng `::`.</p>
                <input type="text" id="ipv6ToCompress" placeholder="VD: 2001:0db8:0000:0000:1234:0000:0000:5678" aria-label="IPv6 to compress"/>
                <button onclick="compressIpv6()" aria-label="Compress IPv6">R√∫t G·ªçn</button>
                <div id="ipv6CompressedResult" class="result-box"></div>
            </div>
        </div>
        <div class="section" id="step11">
            <h2>B∆∞·ªõc 11: NAT - Network Address Translation</h2>
            <p>NAT cho ph√©p nhi·ªÅu thi·∫øt b·ªã d√πng IP private chia s·∫ª m·ªôt IP public ƒë·ªÉ ra internet.</p>
            <h3>C√°c lo·∫°i NAT</h3>
            <ul>
                <li><strong>SNAT (Source NAT):</strong> Thay ƒë·ªïi ƒë·ªãa ch·ªâ IP ngu·ªìn c·ªßa g√≥i tin ƒëi ra ngo√†i. ƒê√¢y l√† lo·∫°i NAT ph·ªï bi·∫øn nh·∫•t cho m·∫°ng gia ƒë√¨nh/vƒÉn ph√≤ng.</li>
                <li><strong>DNAT (Destination NAT) / Port Forwarding:</strong> Thay ƒë·ªïi ƒë·ªãa ch·ªâ IP ƒë√≠ch c·ªßa g√≥i tin ƒëi v√†o. D√πng ƒë·ªÉ public m·ªôt d·ªãch v·ª• n·ªôi b·ªô (nh∆∞ web server) ra internet.</li>
                <li><strong>PAT (Port Address Translation):</strong> M·ªôt d·∫°ng SNAT, map nhi·ªÅu IP private ra m·ªôt IP public duy nh·∫•t b·∫±ng c√°ch s·ª≠ d·ª•ng c√°c port kh√°c nhau. V√≠ d·ª•: `192.168.1.10:12345` v√† `192.168.1.11:54321` ƒë·ªÅu ƒë∆∞·ª£c map ra `203.0.113.1` nh∆∞ng v·ªõi c√°c port ngu·ªìn kh√°c nhau.</li>
            </ul>
            <div class="analogy"><strong>V√≠ D·ª• ƒê·ªùi Th∆∞·ªùng:</strong> Nh∆∞ m·ªôt ng∆∞·ªùi ƒë·∫°i di·ªán (router) nh·∫≠n th∆∞ t·ª´ b√™n ngo√†i v√† ph√¢n ph√°t cho c√°c ph√≤ng trong nh√†.</div>
            <h3>S∆° ƒê·ªì Minh H·ªça: NAT Trong M·∫°ng Gia ƒê√¨nh</h3>
            <canvas id="natCanvas" width="600" height="400"></canvas>
        </div>
        <div class="section" id="step12">
            <h2>B∆∞·ªõc 12: DHCP - Dynamic Host Configuration Protocol (G√°n IP T·ª± ƒê·ªông)</h2>
            <p>DHCP t·ª± ƒë·ªông g√°n IP, subnet mask, gateway cho thi·∫øt b·ªã khi k·∫øt n·ªëi m·∫°ng. Qu√° tr√¨nh n√†y g·ªçi l√† <strong>DORA</strong>: Discover, Offer, Request, Acknowledge.</p>
            <p>IP ƒë∆∞·ª£c c·∫•p trong m·ªôt kho·∫£ng th·ªùi gian g·ªçi l√† <strong>Lease Time</strong>. H·∫øt n·ª≠a th·ªùi gian, client s·∫Ω c·ªë g·∫Øng gia h·∫°n (renew). N·∫øu th·∫•t b·∫°i, n√≥ s·∫Ω th·ª≠ l·∫°i khi c√≤n 87.5% th·ªùi gian (rebinding).</p>
            <div class="analogy"><strong>V√≠ D·ª• ƒê·ªùi Th∆∞·ªùng:</strong> Nh∆∞ qu·∫ßy l·ªÖ t√¢n kh√°ch s·∫°n t·ª± ƒë·ªông g√°n ph√≤ng khi b·∫°n check-in, thay v√¨ ch·ªçn ph√≤ng th·ªß c√¥ng.</div>
            <h3>S∆° ƒê·ªì Minh H·ªça: Qu√° Tr√¨nh DHCP</h3>
            <canvas id="dhcpCanvas" width="600" height="300"></canvas>
            <div class="interactive">
                <h3>T∆∞∆°ng T√°c 9: M√¥ Ph·ªèng Y√™u C·∫ßu IP T·ª´ DHCP</h3>
                <p>Nh·∫≠p "MAC Address" (gi·∫£, b·∫•t k·ª≥) v√† nh·∫•n ƒë·ªÉ xem qu√° tr√¨nh c·∫•p ph√°t IP t·ª± ƒë·ªông t·ª´ pool 192.168.1.0/24.</p>
                <input type="text" id="macInput" placeholder="MAC: 00:11:22:33:44:55" aria-label="Simulated MAC Address"/>
                <label for="leaseTimeSlider">Lease Time (gi√¢y): <span id="leaseTimeValue">86400</span></label>
                <input type="range" id="leaseTimeSlider" min="60" max="604800" value="86400" step="60" oninput="document.getElementById('leaseTimeValue').textContent = this.value" aria-label="Lease Time Slider" />
                <button onclick="requestDhcpIp()" aria-label="Request DHCP IP">Y√™u C·∫ßu IP</button>
                <div id="dhcpResult" class="result-box"></div>
            </div>
        </div>
        <div class="section" id="step13">
            <h2>B∆∞·ªõc 13: DNS - Domain Name System (Chuy·ªÉn T√™n Mi·ªÅn Sang IP)</h2>
            <p>DNS nh∆∞ s·ªï danh b·∫°, chuy·ªÉn t√™n mi·ªÅn (v√≠ d·ª• google.com) th√†nh IP ƒë·ªÉ m√°y t√≠nh k·∫øt n·ªëi. C√≥ nhi·ªÅu lo·∫°i b·∫£n ghi (record) DNS:</p>
            <ul>
                <li><strong>A Record:</strong> Map t√™n mi·ªÅn sang ƒë·ªãa ch·ªâ IPv4.</li>
                <li><strong>AAAA Record:</strong> Map t√™n mi·ªÅn sang ƒë·ªãa ch·ªâ IPv6.</li>
                <li><strong>CNAME Record (Canonical Name):</strong> T·∫°o b√≠ danh cho m·ªôt t√™n mi·ªÅn kh√°c.</li>
                <li><strong>MX Record (Mail Exchange):</strong> Ch·ªâ ƒë·ªãnh m√°y ch·ªß email cho t√™n mi·ªÅn.</li>
                <li><strong>TXT Record:</strong> Ch·ª©a th√¥ng tin d·∫°ng vƒÉn b·∫£n, th∆∞·ªùng d√πng ƒë·ªÉ x√°c th·ª±c.</li>
            </ul>
            <div class="analogy"><strong>V√≠ D·ª• ƒê·ªùi Th∆∞·ªùng:</strong> G·ªçi t√™n b·∫°n b√® thay v√¨ s·ªë ƒëi·ªán tho·∫°i, DNS t√¨m s·ªë cho b·∫°n.</div>
            <h3>S∆° ƒê·ªì Minh H·ªça: Qu√° Tr√¨nh Resolve DNS</h3>
            <canvas id="dnsCanvas" width="600" height="300"></canvas>
            <div class="interactive">
                <h3>T∆∞∆°ng T√°c 10: M√¥ Ph·ªèng Resolve T√™n Mi·ªÅn</h3>
                <p>Ch·ªçn lo·∫°i b·∫£n ghi, nh·∫≠p t√™n mi·ªÅn v√† xem k·∫øt qu·∫£ (gi·∫£).</p>
                <select id="dnsRecordType" aria-label="DNS Record Type">
                    <option value="A">A (IPv4)</option>
                    <option value="AAAA">AAAA (IPv6)</option>
                    <option value="MX">MX (Mail)</option>
                    <option value="CNAME">CNAME (Alias)</option>
                    <option value="TXT">TXT (Text)</option>
                </select>
                <input type="text" id="domainInput" placeholder="T√™n mi·ªÅn: example.com" aria-label="Domain name to resolve"/>
                <button onclick="resolveDnsRecord()" aria-label="Resolve Domain">Resolve</button>
                <div id="dnsRecordResult" class="result-box"></div>
            </div>
        </div>
        <div class="section" id="step14">
            <h2>B∆∞·ªõc 14: Routing C∆° B·∫£n (ƒê·ªãnh Tuy·∫øn D·ªØ Li·ªáu)</h2>
            <p>Routing l√† c√°ch d·ªØ li·ªáu ƒëi t·ª´ m·∫°ng n√†y sang m·∫°ng kh√°c, qua router d·ª±a tr√™n b·∫£ng ƒë·ªãnh tuy·∫øn.</p>
             <h3>Default Gateway l√† g√¨?</h3>
            <p>Default Gateway (c·ªïng m·∫∑c ƒë·ªãnh) l√† m·ªôt kh√°i ni·ªám c·ª±c k·ª≥ quan tr·ªçng. N√≥ ch√≠nh l√† ƒë·ªãa ch·ªâ IP c·ªßa Router trong m·∫°ng LAN, l√† c·ª≠a ng√µ ƒë·ªÉ c√°c thi·∫øt b·ªã trong m·∫°ng c√≥ th·ªÉ k·∫øt n·ªëi ra c√°c m·∫°ng kh√°c, bao g·ªìm c·∫£ Internet. Khi DHCP c·∫•p ph√°t IP, n√≥ c≈©ng s·∫Ω cung c·∫•p ƒë·ªãa ch·ªâ Default Gateway n√†y cho c√°c thi·∫øt b·ªã.</p>
            <h3>Static vs. Dynamic Routing</h3>
            <ul>
                <li><strong>Static Routing:</strong> Ng∆∞·ªùi qu·∫£n tr·ªã ph·∫£i c·∫•u h√¨nh ƒë∆∞·ªùng ƒëi th·ªß c√¥ng. Ph√π h·ª£p cho m·∫°ng nh·ªè, ƒë∆°n gi·∫£n. V√≠ d·ª• l·ªánh tr√™n router Cisco: `ip route 0.0.0.0 0.0.0.0 192.168.1.1` (g·ª≠i m·ªçi traffic kh√¥ng x√°c ƒë·ªãnh ƒë·∫øn gateway 192.168.1.1).</li>
                <li><strong>Dynamic Routing:</strong> C√°c router t·ª± ƒë·ªông chia s·∫ª th√¥ng tin v√† t√¨m ƒë∆∞·ªùng ƒëi t·ªët nh·∫•t b·∫±ng c√°c giao th·ª©c nh∆∞ OSPF, BGP. Ph√π h·ª£p cho m·∫°ng l·ªõn, ph·ª©c t·∫°p.</li>
            </ul>
            <div class="analogy"><strong>V√≠ D·ª• ƒê·ªùi Th∆∞·ªùng:</strong> Nh∆∞ b·∫£n ƒë·ªì GPS h∆∞·ªõng d·∫´n ƒë∆∞·ªùng ƒëi t·ª´ nh√† b·∫°n ƒë·∫øn nh√† b·∫°n b√®, qua c√°c ng√£ r·∫Ω (router).</div>
            <h3>S∆° ƒê·ªì Minh H·ªça: ƒê·ªãnh Tuy·∫øn Gi·ªØa C√°c M·∫°ng</h3>
            <canvas id="routingCanvas" width="600" height="400"></canvas>
            <div class="interactive">
                <h3>T∆∞∆°ng T√°c 11: Ki·ªÉm Tra N·∫øu C·∫ßn Router</h3>
                <p>Nh·∫≠p IP ngu·ªìn, IP ƒë√≠ch, subnet mask ƒë·ªÉ xem n·∫øu c√πng m·∫°ng hay c·∫ßn router.</p>
                <input type="text" id="sourceIp" placeholder="IP ngu·ªìn: 192.168.1.10" aria-label="Source IP for routing check"/>
                <input type="text" id="destIp" placeholder="IP ƒë√≠ch: 192.168.2.20" aria-label="Destination IP for routing check"/>
                <input type="text" id="maskInput" placeholder="Subnet Mask: 255.255.255.0" aria-label="Subnet Mask for routing check"/>
                <button onclick="checkRouting()" aria-label="Check Routing">Ki·ªÉm Tra</button>
                <div id="routingResult" class="result-box"></div>
            </div>
        </div>
        <div class="section" id="step15">
            <h2>B∆∞·ªõc 15: Firewall V√† B·∫£o M·∫≠t M·∫°ng</h2>
            <p>Firewall nh∆∞ t∆∞·ªùng l·ª≠a, ki·ªÉm so√°t l∆∞u l∆∞·ª£ng d·ªØ li·ªáu v√†o/ra m·∫°ng, ch·∫∑n c√°c k·∫øt n·ªëi nguy hi·ªÉm d·ª±a tr√™n quy t·∫Øc (IP, port).</p>
            <h3>Stateful vs. Stateless Firewall</h3>
            <ul>
                <li><strong>Stateless:</strong> Ki·ªÉm tra t·ª´ng g√≥i tin m·ªôt c√°ch ƒë·ªôc l·∫≠p, kh√¥ng nh·ªõ c√°c k·∫øt n·ªëi tr∆∞·ªõc ƒë√≥. Nhanh nh∆∞ng k√©m an to√†n.</li>
                <li><strong>Stateful:</strong> Theo d√µi tr·∫°ng th√°i c·ªßa c√°c k·∫øt n·ªëi (v√≠ d·ª•: TCP handshake). Ch·ªâ cho ph√©p c√°c g√≥i tin thu·ªôc m·ªôt k·∫øt n·ªëi h·ª£p l·ªá ƒëi qua. An to√†n h∆°n nh∆∞ng t·ªën t√†i nguy√™n h∆°n.</li>
            </ul>
            <p><strong>Th·ª© t·ª± lu·∫≠t r·∫•t quan tr·ªçng:</strong> Firewall x·ª≠ l√Ω lu·∫≠t t·ª´ tr√™n xu·ªëng d∆∞·ªõi v√† d·ª´ng l·∫°i ·ªü lu·∫≠t ƒë·∫ßu ti√™n kh·ªõp. Th∆∞·ªùng c√≥ m·ªôt lu·∫≠t "Default Deny" ·ªü cu·ªëi c√πng ƒë·ªÉ ch·∫∑n m·ªçi th·ª© kh√¥ng ƒë∆∞·ª£c cho ph√©p r√µ r√†ng.</p>
            <div class="analogy"><strong>V√≠ D·ª• ƒê·ªùi Th∆∞·ªùng:</strong> Nh∆∞ b·∫£o v·ªá c·ª≠a nh√†, ch·ªâ cho ng∆∞·ªùi quen v√†o, ch·∫∑n k·∫ª l·∫°.</div>
            <h3>S∆° ƒê·ªì Minh H·ªça ƒê·ªông: M√¥ Ph·ªèng Firewall Ch·∫∑n K·∫øt N·ªëi</h3>
            <canvas id="firewallCanvas" width="600" height="400"></canvas>
            <div class="interactive">
                <h3>T∆∞∆°ng T√°c 12: Thi·∫øt L·∫≠p Quy T·∫Øc Firewall (JSON)</h3>
                <p>So·∫°n th·∫£o m·ªôt m·∫£ng c√°c quy t·∫Øc b·∫±ng JSON. Nh·∫≠p IP ngu·ªìn v√† port ƒë·ªÉ ki·ªÉm tra.</p>
                <textarea id="firewallRules" aria-label="Firewall rules in JSON format">[
{ "action": "allow", "protocol": "tcp", "port": 443, "description": "Allow HTTPS" },
{ "action": "allow", "source_ip": "192.168.1.100", "description": "Allow Admin PC" },
{ "action": "deny", "source_ip": "10.0.0.0/8", "description": "Block internal network" },
{ "action": "deny", "protocol": "any", "description": "Default Deny" }
]</textarea>
                <input type="text" id="firewallCheckIp" placeholder="IP ngu·ªìn ƒë·ªÉ ki·ªÉm tra: 10.1.2.3" aria-label="Source IP for firewall check" />
                 <input type="number" id="firewallCheckPort" placeholder="Port ƒë·ªÉ ki·ªÉm tra: 443" aria-label="Port for firewall check" />
                <button onclick="checkFirewallRules()" aria-label="Check Firewall Rule">Ki·ªÉm Tra V·ªõi Lu·∫≠t JSON</button>
                <div id="firewallJsonResult" class="result-box"></div>
            </div>
        </div>
        <div class="section" id="step16">
            <h2>B∆∞·ªõc 16: VPN - Virtual Private Network (M·∫°ng Ri√™ng ·∫¢o)</h2>
            <p>VPN t·∫°o ƒë∆∞·ªùng h·∫ßm an to√†n qua internet, m√£ h√≥a d·ªØ li·ªáu, cho ph√©p truy c·∫≠p m·∫°ng t·ª´ xa nh∆∞ ƒëang ·ªü vƒÉn ph√≤ng.</p>
             <h3>C√°c Lo·∫°i VPN</h3>
            <ul>
                <li><strong>Remote-Access VPN:</strong> Cho ph√©p ng∆∞·ªùi d√πng c√° nh√¢n k·∫øt n·ªëi v√†o m·∫°ng c√¥ng ty.</li>
                <li><strong>Site-to-Site VPN:</strong> K·∫øt n·ªëi hai ho·∫∑c nhi·ªÅu m·∫°ng vƒÉn ph√≤ng v·ªõi nhau qua Internet.</li>
                <li><strong>Giao th·ª©c:</strong> IPsec l√† m·ªôt b·ªô giao th·ª©c m·∫°nh m·∫Ω, th∆∞·ªùng d√πng cho site-to-site. SSL/TLS VPN th∆∞·ªùng d·ªÖ s·ª≠ d·ª•ng h∆°n, ch·∫°y qua tr√¨nh duy·ªát ho·∫∑c client, ph√π h·ª£p cho remote-access.</li>
            </ul>
            <div class="analogy"><strong>V√≠ D·ª• ƒê·ªùi Th∆∞·ªùng:</strong> Nh∆∞ ƒë∆∞·ªùng h·∫ßm b√≠ m·∫≠t k·∫øt n·ªëi nh√† b·∫°n v·ªõi c√¥ng ty, an to√†n kh·ªèi k·∫ª x·∫•u ngo√†i ƒë∆∞·ªùng.</div>
            <h3>S∆° ƒê·ªì Minh H·ªça ƒê·ªông: K·∫øt N·ªëi VPN</h3>
            <canvas id="vpnCanvas" width="600" height="300"></canvas>
            <div class="interactive">
                <h3>T∆∞∆°ng T√°c 13: M√¥ Ph·ªèng K·∫øt N·ªëi VPN</h3>
                <p>Nh·∫≠p "Server VPN" v√† "User IP", nh·∫•n ƒë·ªÉ "k·∫øt n·ªëi" v√† xem ƒë·ªãa ch·ªâ thay ƒë·ªïi (gi·∫£).</p>
                <div style="text-align: center; margin-bottom: 10px;">
                    <label><input type="radio" name="vpnType" value="IPsec" checked> IPsec VPN</label>
                    <label><input type="radio" name="vpnType" value="SSL" style="margin-left: 20px;"> SSL VPN</label>
                </div>
                <input type="text" id="vpnServer" placeholder="Server VPN: vpn.example.com" aria-label="VPN Server Address"/>
                <input type="text" id="userIp" placeholder="User IP: 192.168.1.10" aria-label="User IP for VPN"/>
                <button onclick="connectVpn()" aria-label="Connect VPN">K·∫øt N·ªëi VPN</button>
                <div id="vpnResult" class="result-box"></div>
            </div>
        </div>
        <div class="section" id="step17">
            <h2>B∆∞·ªõc 17: Wi-Fi V√† M·∫°ng Kh√¥ng D√¢y</h2>
            <p>Wi-Fi d√πng s√≥ng radio ƒë·ªÉ k·∫øt n·ªëi thi·∫øt b·ªã kh√¥ng d√¢y. B·∫£o m·∫≠t l√† y·∫øu t·ªë quan tr·ªçng nh·∫•t.</p>
             <h3>C√°c Chu·∫©n B·∫£o M·∫≠t Wi-Fi</h3>
            <ul>
                <li><strong>WEP (Wired Equivalent Privacy):</strong> C≈© v√† r·∫•t y·∫øu, kh√¥ng n√™n s·ª≠ d·ª•ng.</li>
                <li><strong>WPA (Wi-Fi Protected Access):</strong> T·ªët h∆°n WEP nh∆∞ng v·∫´n c√≥ l·ªó h·ªïng.</li>
                <li><strong>WPA2:</strong> Chu·∫©n ph·ªï bi·∫øn v√† an to√†n trong nhi·ªÅu nƒÉm, s·ª≠ d·ª•ng m√£ h√≥a AES m·∫°nh.</li>
                <li><strong>WPA3:</strong> Th·∫ø h·ªá m·ªõi nh·∫•t, tƒÉng c∆∞·ªùng b·∫£o m·∫≠t, ch·ªëng l·∫°i c√°c cu·ªôc t·∫•n c√¥ng Brute-force.</li>
            </ul>
            <p>Lu√¥n s·ª≠ d·ª•ng WPA2 ho·∫∑c WPA3 v·ªõi m·ªôt m·∫≠t kh·∫©u m·∫°nh (d√†i, ph·ª©c t·∫°p, bao g·ªìm ch·ªØ hoa, ch·ªØ th∆∞·ªùng, s·ªë v√† k√Ω t·ª± ƒë·∫∑c bi·ªát).</p>
            <div class="analogy"><strong>V√≠ D·ª• ƒê·ªùi Th∆∞·ªùng:</strong> Nh∆∞ radio FM, b·∫°n ch·ªçn k√™nh (SSID) v√† m·∫≠t kh·∫©u ƒë·ªÉ nghe ri√™ng.</div>
            <h3>S∆° ƒê·ªì Minh H·ªça ƒê·ªông: K·∫øt N·ªëi Wi-Fi</h3>
            <canvas id="wifiCanvas" width="600" height="400"></canvas>
            <div class="interactive">
                <h3>T∆∞∆°ng T√°c 14: M√¥ Ph·ªèng K·∫øt N·ªëi Wi-Fi</h3>
                <p>Nh·∫≠p SSID v√† m·∫≠t kh·∫©u (gi·∫£: SSID 'MyWiFi', m·∫≠t kh·∫©u '12345678'), nh·∫•n ƒë·ªÉ k·∫øt n·ªëi.</p>
                <input type="text" id="ssidInput" placeholder="SSID: MyWiFi" aria-label="Wi-Fi SSID"/>
                <input type="password" id="wifiPass" placeholder="M·∫≠t kh·∫©u" aria-label="Wi-Fi Password" oninput="checkPasswordStrength(this.value)"/>
                <div class="strength-bar"><div id="passwordStrength"></div></div>
                <button onclick="connectWifi()" aria-label="Connect to Wi-Fi">K·∫øt N·ªëi</button>
                <div id="wifiResult" class="result-box"></div>
            </div>
        </div>
        <div class="section" id="step18">
            <h2>B∆∞·ªõc 18: Quiz Cu·ªëi C√πng</h2>
            <p>Th·ª≠ quiz ƒë·ªÉ √¥n l·∫°i to√†n b·ªô ki·∫øn th·ª©c!</p>
            <div class="interactive">
                <p>C√¢u 1: Firewall l√†m g√¨?</p>
                <select id="quiz6" aria-label="Final quiz question 1"><option value="">Ch·ªçn...</option><option value="ch·∫∑n">Ch·∫∑n l∆∞u l∆∞·ª£ng nguy hi·ªÉm</option><option value="g√°n ip">G√°n IP t·ª± ƒë·ªông</option><option value="resolve">Resolve t√™n mi·ªÅn</option></select>
                <p>C√¢u 2: VPN d√πng ƒë·ªÉ?</p>
                <select id="quiz7" aria-label="Final quiz question 2"><option value="">Ch·ªçn...</option><option value="m√£ h√≥a">M√£ h√≥a k·∫øt n·ªëi an to√†n</option><option value="chia subnet">Chia subnet</option><option value="k·∫øt n·ªëi kh√¥ng d√¢y">K·∫øt n·ªëi kh√¥ng d√¢y</option></select>
                <p>C√¢u 3: Chu·∫©n b·∫£o m·∫≠t Wi-Fi n√†o n√™n d√πng hi·ªán nay?</p>
                <select id="quiz8" aria-label="Final quiz question 3"><option value="">Ch·ªçn...</option><option value="wpa23">WPA2 ho·∫∑c WPA3</option><option value="wep">WEP</option><option value="wpa">WPA</option></select>
                <button onclick="checkFinalQuiz()" aria-label="Check Final Quiz Answers">Ki·ªÉm Tra</button>
                <div id="finalQuizResult" class="result-box"></div>
            </div>
        </div>
        <div class="section" id="step19">
            <h2>B∆∞·ªõc 19: Port V√† Socket (C·ª≠a V√†o Ra D·ªØ Li·ªáu)</h2>
            <p>Port nh∆∞ s·ªë ph√≤ng trong t√≤a nh√† (IP l√† ƒë·ªãa ch·ªâ t√≤a nh√†). Socket l√† k·∫øt h·ª£p IP + Port, gi√∫p d·ªØ li·ªáu ƒë·∫øn ƒë√∫ng ·ª©ng d·ª•ng (web port 80, email port 25).</p>
            <h3>C√°c D·∫£i Port</h3>
            <ul>
                <li><strong>0-1023 (Well-known Ports):</strong> ƒê∆∞·ª£c d√†nh ri√™ng cho c√°c d·ªãch v·ª• h·ªá th·ªëng (HTTP: 80, FTP: 21, SSH: 22).</li>
                <li><strong>1024-49151 (Registered Ports):</strong> D√†nh cho c√°c ·ª©ng d·ª•ng c·ªßa ng∆∞·ªùi d√πng ƒë√£ ƒëƒÉng k√Ω.</li>
                <li><strong>49152-65535 (Dynamic/Private/Ephemeral Ports):</strong> ƒê∆∞·ª£c h·ªá ƒëi·ªÅu h√†nh s·ª≠ d·ª•ng cho c√°c k·∫øt n·ªëi ƒëi ra ngo√†i (client-side).</li>
            </ul>
            <div class="analogy"><strong>V√≠ D·ª• ƒê·ªùi Th∆∞·ªùng:</strong> IP l√† ƒë·ªãa ch·ªâ nh√†, port l√† s·ªë ph√≤ng, socket l√† "nh√† + ph√≤ng" ƒë·ªÉ g·ª≠i th∆∞ ƒë√∫ng ng∆∞·ªùi.</div>
            <h3>S∆° ƒê·ªì Minh H·ªça ƒê·ªông: D·ªØ Li·ªáu ƒêi Qua Port</h3>
            <canvas id="portCanvas" width="600" height="300"></canvas>
            <div class="interactive">
                <h3>T∆∞∆°ng T√°c 15: Ki·ªÉm Tra D·ªãch V·ª• Port</h3>
                <p>Nh·∫≠p s·ªë port (0-65535), xem d·ªãch v·ª• ph·ªï bi·∫øn.</p>
                <input type="number" id="portInput" placeholder="Port: 80" min="0" max="65535" aria-label="Port number to check"/>
                <button onclick="checkPort()" aria-label="Check Port Service">Ki·ªÉm Tra</button>
                <div id="portResult" class="result-box"></div>
            </div>
        </div>
        <div class="section" id="step20">
            <h2>B∆∞·ªõc 20: TCP vs UDP - Giao Th·ª©c Truy·ªÅn D·ªØ Li·ªáu</h2>
            <p>TCP an to√†n, ƒë√°ng tin c·∫≠y (nh∆∞ g·ªçi ƒëi·ªán x√°c nh·∫≠n), UDP nhanh, kh√¥ng x√°c nh·∫≠n (nh∆∞ g·ª≠i th∆∞ th∆∞·ªùng, d√πng cho video/game).</p>
            <p>Ngo√†i ra c√≤n c√≥ c√°c giao th·ª©c m·ªõi h∆°n nh∆∞ <strong>QUIC</strong> (d√πng b·ªüi HTTP/3), k·∫øt h·ª£p t·ªëc ƒë·ªô c·ªßa UDP v√† ƒë·ªô tin c·∫≠y c·ªßa TCP; v√† <strong>SCTP</strong>, d√πng cho vi·ªÖn th√¥ng (signaling).</p>
            <div class="analogy"><strong>V√≠ D·ª• ƒê·ªùi Th∆∞·ªùng:</strong> TCP nh∆∞ chuy·ªÉn ph√°t nhanh c√≥ bi√™n nh·∫≠n, UDP nh∆∞ ph√°t t·ªù r∆°i nhanh nh∆∞ng c√≥ th·ªÉ m·∫•t.</div>
            <h3>S∆° ƒê·ªì Minh H·ªça ƒê·ªông: So S√°nh TCP/UDP</h3>
            <canvas id="tcpUdpCanvas" width="600" height="400"></canvas>
            <div class="interactive">
                <h3>T∆∞∆°ng T√°c 16: Ch·ªçn Giao Th·ª©c Cho ·ª®ng D·ª•ng</h3>
                <p>Nh·∫≠p ·ª©ng d·ª•ng (web, video, email, game, voice call), xem n√™n d√πng TCP, UDP hay QUIC.</p>
                <input type="text" id="appInput" placeholder="·ª®ng d·ª•ng: video call" aria-label="Application type to suggest protocol"/>
                <button onclick="suggestProtocol()" aria-label="Suggest Protocol">G·ª£i √ù</button>
                <div id="protocolResult" class="result-box"></div>
            </div>
        </div>
        <div class="section" id="step21">
            <h2>B∆∞·ªõc 21: M√¥ H√¨nh OSI - C√°c T·∫ßng M·∫°ng</h2>
            <p>OSI c√≥ 7 t·∫ßng, t·ª´ Physical (c√°p) ƒë·∫øn Application (app). Gi√∫p hi·ªÉu d·ªØ li·ªáu ƒëi t·ª´ t·∫ßng n√†y sang t·∫ßng kh√°c.</p>
            <h3>Mapping Giao Th·ª©c L√™n C√°c T·∫ßng</h3>
            <ul>
                <li><strong>Layer 7 (Application):</strong> HTTP, FTP, SMTP, DNS</li>
                <li><strong>Layer 4 (Transport):</strong> TCP, UDP, QUIC</li>
                <li><strong>Layer 3 (Network):</strong> IP, ICMP</li>
                <li><strong>Layer 2 (Data Link):</strong> Ethernet, MAC Address, ARP</li>
                <li><strong>Layer 1 (Physical):</strong> C√°p ƒë·ªìng, c√°p quang, s√≥ng radio</li>
            </ul>
            <div class="analogy"><strong>V√≠ D·ª• ƒê·ªùi Th∆∞·ªùng:</strong> Nh∆∞ g·ª≠i th∆∞: vi·∫øt th∆∞ (Application), ƒë√≥ng g√≥i (Presentation), ƒë·ªãa ch·ªâ (Session), v·∫≠n chuy·ªÉn (Transport), ƒë∆∞·ªùng ƒëi (Network), xe ch·ªü (Data Link), ƒë∆∞·ªùng ph·ªë (Physical).</div>
            <h3>S∆° ƒê·ªì Minh H·ªça ƒê·ªông: C√°c T·∫ßng OSI</h3>
            <canvas id="osiCanvas" width="600" height="500"></canvas>
            <div class="interactive">
                <h3>T∆∞∆°ng T√°c 17: Kh√°m Ph√° T·∫ßng OSI</h3>
                <p>Ch·ªçn m·ªôt giao th·ª©c, xem n√≥ n·∫±m ·ªü t·∫ßng n√†o.</p>
                <select id="osiProtocolSelect" aria-label="OSI Protocol selector">
                    <option value="">Ch·ªçn giao th·ª©c...</option>
                    <option value="7">HTTP</option><option value="7">DNS</option>
                    <option value="4">TCP</option><option value="4">UDP</option>
                    <option value="3">IP</option><option value="3">ICMP</option>
                    <option value="2">Ethernet (MAC)</option><option value="2">ARP</option>
                </select>
                <button onclick="highlightOsiLayer()" aria-label="Highlight OSI Layer">Highlight T·∫ßng</button>
                <div id="osiResult" class="result-box"></div>
            </div>
        </div>
        <div class="section" id="step22">
            <h2>B∆∞·ªõc 22: Quiz T·ªïng H·ª£p</h2>
            <p>Th·ª≠ quiz ƒë·ªÉ ki·ªÉm tra ki·∫øn th·ª©c t·ª´ b∆∞·ªõc 15-21! K·∫øt qu·∫£ s·∫Ω ƒë∆∞·ª£c l∆∞u l·∫°i ƒë·ªÉ b·∫°n theo d√µi ti·∫øn ƒë·ªô.</p>
            <div class="interactive">
                <p>C√¢u 1: Port 80 d√πng cho g√¨?</p>
                <select id="quiz9" aria-label="Comprehensive quiz question 1"><option value="">Ch·ªçn...</option><option value="http">HTTP (Web)</option><option value="email">Email</option><option value="ftp">FTP</option></select>
                <p>C√¢u 2: TCP hay UDP cho video streaming?</p>
                <select id="quiz10" aria-label="Comprehensive quiz question 2"><option value="">Ch·ªçn...</option><option value="udp">UDP (Nhanh)</option><option value="tcp">TCP (An to√†n)</option></select>
                <p>C√¢u 3: T·∫ßng 3 OSI l√† g√¨?</p>
                <select id="quiz11" aria-label="Comprehensive quiz question 3"><option value="">Ch·ªçn...</option><option value="network">Network (IP)</option><option value="physical">Physical</option><option value="application">Application</option></select>
                <button onclick="checkTotalQuiz()" aria-label="Check Comprehensive Quiz Answers">Ki·ªÉm Tra</button>
                <div id="totalQuizResult" class="result-box"></div>
                <div id="scoreHistoryChart"></div>
            </div>
        </div>
        
        <div class="section" id="further-reading">
            <h2>ƒê·ªçc Th√™m v√† T√†i Li·ªáu Tham Kh·∫£o</h2>
            <p>Ki·∫øn th·ª©c l√† v√¥ t·∫≠n. N·∫øu b·∫°n mu·ªën t√¨m hi·ªÉu s√¢u h∆°n, ƒë√¢y l√† m·ªôt s·ªë t√†i li·ªáu tham kh·∫£o h·ªØu √≠ch:</p>
            <ul>
                <li><a href="https://en.wikipedia.org/wiki/Subnetwork" target="_blank" rel="noopener noreferrer">Wikipedia: Subnetwork</a> - Gi·∫£i th√≠ch chi ti·∫øt v·ªÅ subnetting.</li>
                <li><a href="https://docs.microsoft.com/en-us/windows-server/networking/technologies/dhcp/dhcp-top" target="_blank" rel="noopener noreferrer">Microsoft Docs: DHCP</a> - T√†i li·ªáu ch√≠nh th·ª©c v·ªÅ DHCP t·ª´ Microsoft.</li>
                <li><a href="https://www.cloudflare.com/learning/dns/dns-records/" target="_blank" rel="noopener noreferrer">Cloudflare: DNS Records</a> - Gi·∫£i th√≠ch c√°c lo·∫°i b·∫£n ghi DNS.</li>
                 <li><a href="https://www.ciscopress.com/topics/networking" target="_blank" rel="noopener noreferrer">Cisco Press Networking</a> - Ngu·ªìn t√†i li·ªáu chuy√™n s√¢u t·ª´ Cisco.</li>
            </ul>
        </div>
    </div>

    <!-- Modal for Quiz Results -->
    <div id="quizModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeModalButton" aria-label="Close">&times;</span>
            <div id="modal-body"></div>
        </div>
    </div>
    
<script>
// --- NEW UI/UX AND INTERACTIVITY SCRIPT ---

// --- Core UI Elements ---
const progressBar = document.getElementById('progressBar');
const sidebar = document.getElementById('sidebar');
const sections = document.querySelectorAll('.section');
const sidebarLinks = document.querySelectorAll('.sidebar a');
const themeToggle = document.getElementById('theme-toggle');
const quizModal = document.getElementById('quizModal');
const closeModalButton = document.getElementById('closeModalButton');
const modalBody = document.getElementById('modal-body');
const sidebarToggle = document.getElementById('sidebarToggle');
const sidebarOverlay = document.getElementById('sidebarOverlay');

// --- Progress Bar & Sidebar Active State ---
function updateScrollProgress() {
    const scrollTop = document.documentElement.scrollTop;
    const scrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
    const scrollProgress = (scrollTop / scrollHeight) * 100;
    progressBar.style.width = scrollProgress + '%';

    let currentSection = '';
    sections.forEach(section => {
        const sectionTop = section.offsetTop;
        if (scrollTop >= sectionTop - 100) {
            currentSection = section.getAttribute('id');
        }
    });
    
    sidebarLinks.forEach(link => {
        link.classList.remove('active');
        if(link.getAttribute('href') === `#${currentSection}`) {
            link.classList.add('active');
        }
    });
}

// --- Theme Management ---
function applyTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
    themeToggle.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
    localStorage.setItem('theme', theme);
    // Redraw canvases on theme change
    redrawAllCanvases();
}

function toggleTheme() {
    const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
    const newTheme = currentTheme === 'light' ? 'dark' : 'light';
    applyTheme(newTheme);
}

// --- Mobile Sidebar ---
function toggleSidebar() {
    sidebar.classList.toggle('show');
    sidebarOverlay.style.display = sidebar.classList.contains('show') ? 'block' : 'none';
}

// --- Modal ---
function showModal(content) {
    modalBody.innerHTML = content;
    quizModal.style.display = 'flex';
}

function closeModal() {
    quizModal.style.display = 'none';
}

// --- Progress Saving ---
function saveProgress(sectionId) {
    let completedSections = JSON.parse(localStorage.getItem('completedSections')) || [];
    if (!completedSections.includes(sectionId)) {
        completedSections.push(sectionId);
        localStorage.setItem('completedSections', JSON.stringify(completedSections));
        updateProgressUI();
    }
}

function updateProgressUI() {
    let completedSections = JSON.parse(localStorage.getItem('completedSections')) || [];
    completedSections.forEach(sectionId => {
        const sectionEl = document.getElementById(sectionId);
        const navEl = document.getElementById(`nav-${sectionId}`);
        if(sectionEl) sectionEl.classList.add('done');
        if(navEl) navEl.classList.add('done');
    });
}


// --- Event Listeners ---
window.addEventListener('scroll', updateScrollProgress);
themeToggle.addEventListener('click', toggleTheme);
closeModalButton.addEventListener('click', closeModal);
window.addEventListener('click', (event) => {
    if (event.target === quizModal) {
        closeModal();
    }
});
sidebarToggle.addEventListener('click', toggleSidebar);
sidebarOverlay.addEventListener('click', toggleSidebar);
sidebarLinks.forEach(link => {
    link.addEventListener('click', () => {
        if (window.innerWidth <= 992) {
            toggleSidebar();
        }
    });
});
window.addEventListener('resize', redrawAllCanvases);


// --- UTILITY FUNCTIONS ---
function numToIp(num) {
    return [(num >>> 24) & 255, (num >>> 16) & 255, (num >>> 8) & 255, num & 255].join('.');
}
function ipToNum(ip) {
    return ip.split('.').map(Number).reduce((acc, octet) => (acc << 8) | octet, 0) >>> 0;
}
function isIpInCidr(ip, cidrStr) {
    try {
        const [cidrIp, cidrPrefixStr] = cidrStr.split('/');
        const prefix = parseInt(cidrPrefixStr, 10);
        if(isNaN(prefix) || prefix < 0 || prefix > 32) return false;

        const mask = prefix === 0 ? 0 : (~0 << (32 - prefix)) >>> 0;
        const ipNum = ipToNum(ip);
        const cidrIpNum = ipToNum(cidrIp);
        
        return (ipNum & mask) === (cidrIpNum & mask);
    } catch(e) {
        return false;
    }
}
function resizeCanvas(canvas) {
    const { width, height } = canvas.getBoundingClientRect();
    canvas.width = width;
    canvas.height = height || width * 0.5; // fallback height
}
function getThemeColors() {
    const style = getComputedStyle(document.documentElement);
    return {
        bg: style.getPropertyValue('--card-bg'),
        text: style.getPropertyValue('--text-color-light'),
        primary: style.getPropertyValue('--primary-color').trim(),
        success: style.getPropertyValue('--success-color').trim(),
        danger: style.getPropertyValue('--danger-color').trim(),
        warning: style.getPropertyValue('--warning-color').trim(),
        info: style.getPropertyValue('--info-color').trim(),
        secondary: style.getPropertyValue('--secondary-color').trim(),
    };
}


// --- INTERACTIVE FUNCTIONS ---

// Step 1
function convertToBinary() {
    const ip = document.getElementById('ipInputBinary').value.trim();
    const resultDiv = document.getElementById('binaryResult');
    const parts = ip.split('.').map(Number);
    if (parts.length !== 4 || parts.some(p => isNaN(p) || p < 0 || p > 255)) {
        resultDiv.innerHTML = '<p style="color:red;">IP sai r·ªìi, th·ª≠ l·∫°i nh√©! (V√≠ d·ª•: 192.168.1.1)</p>';
        return;
    }
    const binary = parts.map(p => p.toString(2).padStart(8, '0')).join(' . ');
    resultDiv.innerHTML = `<p>Nh·ªã Ph√¢n: <strong>${binary}</strong></p><p>ƒê√¢y l√† c√°ch m√°y t√≠nh ƒë·ªçc IP ƒë·∫•y!</p>`;
    saveProgress('step1');
}

// Step 2
function updateCidr() {
    const cidr = document.getElementById('cidrSlider').value;
    document.getElementById('cidrValue').textContent = cidr;
    const bitBar = document.getElementById('bitBar');
    bitBar.innerHTML = '';
    for (let i = 0; i < 32; i++) {
        const bitDiv = document.createElement('div');
        bitDiv.className = 'bit ' + (i < cidr ? 'network-bit' : 'host-bit');
        bitDiv.title = i < cidr ? 'Network Bit' : 'Host Bit';
        bitDiv.textContent = i < cidr ? 'N' : 'H';
        bitBar.appendChild(bitDiv);
    }
    const hosts = Math.pow(2, 32 - cidr);
    const availableHosts = (hosts > 2) ? hosts - 2 : 0;
    document.getElementById('hostCount').textContent = availableHosts.toLocaleString();
    if(parseInt(cidr) !== 24) saveProgress('step2');
    drawAddressRange(cidr);
}

// Step 3
function calculateSubnet() {
    let ip = document.getElementById('ipInputSubnet').value.trim();
    let cidrStr = document.getElementById('cidrInputSubnet').value.trim();
    const resultDiv = document.getElementById('subnetResult');
    
    if (ip.includes('/')) {
        const parts = ip.split('/');
        ip = parts[0];
        if (!cidrStr) cidrStr = `/${parts[1]}`;
    }

    if (!ip || !cidrStr) {
        resultDiv.innerHTML = '<p style="color:red;">Vui l√≤ng nh·∫≠p IP v√† CIDR!</p>';
        return;
    }
    const cidr = parseInt(cidrStr.replace('/', ''));
    if (isNaN(cidr) || cidr < 0 || cidr > 32) {
        resultDiv.innerHTML = '<p style="color:red;">CIDR kh√¥ng h·ª£p l·ªá! (0-32)</p>';
        return;
    }
    const ipParts = ip.split('.').map(Number);
    if (ipParts.length !== 4 || ipParts.some(p => isNaN(p) || p < 0 || p > 255)) {
        resultDiv.innerHTML = '<p style="color:red;">IP kh√¥ng h·ª£p l·ªá!</p>';
        return;
    }

    const ipNum = ipToNum(ip);
    const mask = cidr === 0 ? 0 : (~0 << (32 - cidr)) >>> 0;
    const networkNum = ipNum & mask;
    const broadcastNum = networkNum | (~mask >>> 0);
    const numHosts = Math.pow(2, 32 - cidr);
    const availableHosts = numHosts > 2 ? numHosts - 2 : 0;
    
    resultDiv.innerHTML = `
        <p><strong>ƒê·ªãa ch·ªâ m·∫°ng (Network Address):</strong> ${numToIp(networkNum)}/${cidr}</p>
        <p><strong>ƒê·ªãa ch·ªâ qu·∫£ng b√° (Broadcast Address):</strong> ${numToIp(broadcastNum)}</p>
        <p><strong>Host ƒë·∫ßu ti√™n:</strong> ${cidr < 31 ? numToIp(networkNum + 1) : 'N/A'}</p>
        <p><strong>Host cu·ªëi c√πng:</strong> ${cidr < 31 ? numToIp(broadcastNum - 1) : 'N/A'}</p>
        <p><strong>S·ªë Host kh·∫£ d·ª•ng:</strong> ${availableHosts.toLocaleString()}</p>
    `;
    saveProgress('step3');
}

function checkIpInSubnet() {
    const networkStr = document.getElementById('networkInput').value.trim();
    const checkIp = document.getElementById('checkIpInput').value.trim();
    const resultDiv = document.getElementById('checkResult');
    if (!networkStr || !checkIp) {
        resultDiv.innerHTML = '<p style="color:red;">Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß!</p>';
        return;
    }
    if (!networkStr.includes('/')) {
        resultDiv.innerHTML = '<p style="color:red;">ƒê·ªãnh d·∫°ng Network sai (v√≠ d·ª•: 192.168.1.0/24)</p>';
        return;
    }
    
    const isIn = isIpInCidr(checkIp, networkStr);
    resultDiv.innerHTML = `<p style="color:${isIn ? 'green' : 'red'}; font-weight: bold;">${isIn ? '‚úîÔ∏è C√≥, IP n√†y thu·ªôc subnet.' : '‚ùå Kh√¥ng, IP n√†y kh√¥ng thu·ªôc subnet.'}</p>`;
}

// Step 4
function checkQuiz() {
    const ans1 = document.getElementById('quiz1').value;
    const ans2 = document.getElementById('quiz2').value;
    const ans3 = document.getElementById('quiz3').value;
    let score = 0;
    let feedback = '<ul>';
    if (ans1 === '32') { score++; feedback += '<li style="color:green;">C√¢u 1 ƒë√∫ng!</li>'; } else { feedback += '<li style="color:red;">C√¢u 1 sai: IP IPv4 c√≥ 32 bit (4 nh√≥m 8 bit).</li>'; }
    if (ans2 === '24') { score++; feedback += '<li style="color:green;">C√¢u 2 ƒë√∫ng!</li>'; } else { feedback += '<li style="color:red;">C√¢u 2 sai: /24 c√≥ 24 bit cho network.</li>'; }
    if (ans3 === '254') { score++; feedback += '<li style="color:green;">C√¢u 3 ƒë√∫ng!</li>'; } else { feedback += '<li style="color:red;">C√¢u 3 sai: S·ªë host l√† 2^(32-24) - 2 = 254.</li>'; }
    feedback += '</ul>';
    const resultMessage = `<h3>K·∫øt qu·∫£: B·∫°n ƒë√∫ng ${score}/3 c√¢u!</h3> ${feedback}`;
    showModal(resultMessage);
    if (score === 3) saveProgress('step4');
}

// Step 6
function calculateSubnets() {
    const baseStr = document.getElementById('baseNetwork').value.trim();
    const numSubnets = parseInt(document.getElementById('numSubnets').value);
    const resultDiv = document.getElementById('subnettingResult');
    if (!baseStr || isNaN(numSubnets) || numSubnets < 2) {
        resultDiv.innerHTML = '<p style="color:red;">Nh·∫≠p ƒë√∫ng network v√† s·ªë subnet (l·ªõn h∆°n 1)!</p>';
        return;
    }
    const [baseIp, baseCidrStr] = baseStr.split('/');
    if (!baseIp || !baseCidrStr) {
        resultDiv.innerHTML = '<p style="color:red;">ƒê·ªãnh d·∫°ng Network sai (v√≠ d·ª•: 192.168.1.0/24)</p>';
        return;
    }

    const baseCidr = parseInt(baseCidrStr);
    const baseNum = ipToNum(baseIp);
    const bitsNeeded = Math.ceil(Math.log2(numSubnets));
    const newCidr = baseCidr + bitsNeeded;
    if (newCidr > 32) {
        resultDiv.innerHTML = '<p style="color:red;">Kh√¥ng ƒë·ªß bit ƒë·ªÉ chia!</p>';
        return;
    }
    const subnetSize = Math.pow(2, 32 - newCidr);
    let output = '<p>C√°c Subnet:</p><ul>';
    for (let i = 0; i < numSubnets; i++) {
        const subnetNum = baseNum + i * subnetSize;
        const network = numToIp(subnetNum);
        const broadcast = numToIp(subnetNum + subnetSize - 1);
        output += `<li><strong>Subnet ${i+1}:</strong> ${network}/${newCidr} (Broadcast: ${broadcast})</li>`;
    }
    output += '</ul>';
    resultDiv.innerHTML = output;
    document.getElementById('useForVlsmBtn').style.display = 'inline-block';
    saveProgress('step6');
}

function populateVlsm() {
    const baseNetwork = document.getElementById('baseNetwork').value;
    const vlsmNetworkInput = document.getElementById('vlsmNetwork');
    vlsmNetworkInput.value = baseNetwork;
    vlsmNetworkInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
    document.getElementById('vlsmHosts').focus();
}

// Step 7
function checkIpType() {
    const ip = document.getElementById('ipTypeInput').value.trim();
    const resultDiv = document.getElementById('ipTypeResult');
    const parts = ip.split('.').map(Number);
    if (parts.length !== 4 || parts.some(p => isNaN(p) || p < 0 || p > 255)) {
        resultDiv.innerHTML = '<p style="color:red;">IP kh√¥ng h·ª£p l·ªá!</p>';
        return;
    }
    let type = 'Public';
    if ((parts[0] === 10) || (parts[0] === 172 && parts[1] >= 16 && parts[1] <= 31) || (parts[0] === 192 && parts[1] === 168)) {
        type = 'Private (RFC 1918)';
    } else if (parts[0] === 169 && parts[1] === 254) {
        type = 'APIPA/Link-Local';
    } else if (parts[0] === 127) {
        type = 'Loopback';
    }
    resultDiv.innerHTML = `<p style="font-weight: bold;">ƒê√¢y l√† IP <strong>${type}</strong></p>`;
    saveProgress('step7');
}

// Step 8
function checkAdvancedQuiz() {
    const ans4 = document.getElementById('quiz4').value;
    const ans5 = document.getElementById('quiz5').value;
    let score = 0;
    let feedback = '<ul>';
    if (ans4 === '30') { score++; feedback += '<li style="color:green;">C√¢u 1 ƒë√∫ng!</li>'; } else { feedback += '<li style="color:red;">C√¢u 1 sai: V·ªõi /27, c√≥ 32-27=5 bit host. S·ªë host l√† 2^5 - 2 = 30.</li>'; }
    if (ans5 === 'private') { score++; feedback += '<li style="color:green;">C√¢u 2 ƒë√∫ng!</li>'; } else { feedback += '<li style="color:red;">C√¢u 2 sai: IP 10.x.x.x l√† IP Private.</li>'; }
    feedback += '</ul>';
    const resultMessage = `<h3>K·∫øt qu·∫£: B·∫°n ƒë√∫ng ${score}/2 c√¢u!</h3> ${feedback}`;
    showModal(resultMessage);
    if (score === 2) saveProgress('step8');
}

// Step 9
function calculateVLSM() {
    const baseStr = document.getElementById('vlsmNetwork').value.trim();
    const hostsStr = document.getElementById('vlsmHosts').value.trim();
    const resultDiv = document.getElementById('vlsmResult');
    if (!baseStr || !hostsStr) {
        resultDiv.innerHTML = '<p style="color:red;">Nh·∫≠p ƒë·∫ßy ƒë·ªß!</p>';
        return;
    }
    const [baseIp, baseCidrStr] = baseStr.split('/');
    if(!baseIp || !baseCidrStr) {
        resultDiv.innerHTML = '<p style="color:red;">Network g·ªëc kh√¥ng h·ª£p l·ªá!</p>';
        return;
    }
    const baseCidr = parseInt(baseCidrStr);
    if (isNaN(baseCidr)) {
        resultDiv.innerHTML = '<p style="color:red;">Network g·ªëc kh√¥ng h·ª£p l·ªá!</p>';
        return;
    }
    const baseNum = ipToNum(baseIp);
    let hosts = hostsStr.split(',').map(Number).filter(n => n > 0).sort((a,b) => b - a);
    if(hosts.some(isNaN)) {
         resultDiv.innerHTML = '<p style="color:red;">S·ªë host kh√¥ng h·ª£p l·ªá!</p>';
        return;
    }
    let currentNum = baseNum;
    let output = '<p>C√°c Subnet ƒë√£ chia (s·∫Øp x·∫øp t·ª´ l·ªõn ƒë·∫øn nh·ªè):</p><ul>';
    let error = false;
    hosts.forEach(hostReq => {
        if(error) return;
        const bitsNeeded = Math.ceil(Math.log2(hostReq + 2));
        const newCidr = 32 - bitsNeeded;
        if(newCidr < baseCidr) {
            output += `<li style="color:red;">L·ªói: Y√™u c·∫ßu ${hostReq} host qu√° l·ªõn cho m·∫°ng g·ªëc!</li>`;
            error = true;
            return;
        }
        const subnetSize = Math.pow(2, bitsNeeded);
        const network = numToIp(currentNum);
        const broadcast = numToIp(currentNum + subnetSize - 1);
        output += `<li>Cho <strong>${hostReq} hosts</strong>: C·∫ßn ${hostReq+2} IPs -> D√πng /${newCidr}.<br><strong>Network: ${network}/${newCidr}</strong> (Broadcast: ${broadcast})</li>`;
        currentNum += subnetSize;
    });
    output += '</ul>';
    resultDiv.innerHTML = output;
    saveProgress('step9');
}

// Step 10
function compressIpv6() {
    let ip = document.getElementById('ipv6ToCompress').value.trim();
    const resultDiv = document.getElementById('ipv6CompressedResult');
    if (!ip) {
        resultDiv.innerHTML = '<p style="color:red;">Vui l√≤ng nh·∫≠p ƒë·ªãa ch·ªâ IPv6.</p>';
        return;
    }
    let compressed = ip.replace(/(^|:)0+([0-9a-fA-F])/g, '$1$2'); // remove leading zeros
    compressed = compressed.replace(/((^|:)0){2,}/g, (match, p1) => {
        return p1 === ':' ? '::' : ':';
    });
    // A bit of a simplified compression, but good for demo
    // Proper one is much more complex
    let parts = ip.split(':');
    if (parts.length !== 8) {
         resultDiv.innerHTML = `<p style="color:red">ƒê·ªãa ch·ªâ IPv6 kh√¥ng h·ª£p l·ªá.</p>`;
         return;
    }
    // Step 1: remove leading zeros in each block
    let cleaned = parts.map(part => part.replace(/^0+/, '') || '0').join(':');

    // Step 2: find the longest sequence of zeros and replace with '::'
    let longest_sequence_start = -1, longest_sequence_length = 0;
    let current_sequence_start = -1, current_sequence_length = 0;
    let cleanedParts = cleaned.split(':');
    for (let i = 0; i < cleanedParts.length; i++) {
        if (cleanedParts[i] === '0') {
            if (current_sequence_start === -1) current_sequence_start = i;
            current_sequence_length++;
        } else {
            if (current_sequence_length > longest_sequence_length) {
                longest_sequence_start = current_sequence_start;
                longest_sequence_length = current_sequence_length;
            }
            current_sequence_start = -1;
            current_sequence_length = 0;
        }
    }
    if (current_sequence_length > longest_sequence_length) {
        longest_sequence_start = current_sequence_start;
        longest_sequence_length = current_sequence_length;
    }

    if (longest_sequence_length > 1) {
        cleanedParts.splice(longest_sequence_start, longest_sequence_length, '');
        cleaned = cleanedParts.join(':').replace(':::', '::');
    }

    resultDiv.innerHTML = `<p>ƒê·ªãa ch·ªâ r√∫t g·ªçn: <strong>${cleaned}</strong></p>`;
    saveProgress('step10');
}

// Step 12
async function requestDhcpIp() {
    const mac = document.getElementById('macInput').value.trim() || '00:11:22:33:44:55';
    const leaseTime = document.getElementById('leaseTimeSlider').value;
    const resultDiv = document.getElementById('dhcpResult');
    resultDiv.innerHTML = '';
    
    const sleep = ms => new Promise(res => setTimeout(res, ms));

    resultDiv.innerHTML += '<p>Client: G·ª≠i DHCP Discover (Broadcast)...</p>';
    await sleep(1000);

    const offeredIp = '192.168.1.' + Math.floor(Math.random() * 253 + 2);
    resultDiv.innerHTML += `<p style="text-align:right;">Server: Nh·∫≠n Discover, g·ª≠i DHCP Offer (IP: ${offeredIp})...</p>`;
    await sleep(1000);
    
    resultDiv.innerHTML += `<p>Client: Nh·∫≠n Offer, g·ª≠i DHCP Request (ch·∫•p nh·∫≠n IP ${offeredIp})...</p>`;
    await sleep(1000);

    resultDiv.innerHTML += `<p style="text-align:right;">Server: Nh·∫≠n Request, g·ª≠i DHCP Acknowledge. C·∫•p ph√°t th√†nh c√¥ng!</p>`;
    await sleep(500);

    resultDiv.innerHTML += `<hr><p style="color:var(--success-color); font-weight:bold;">MAC ${mac} ƒë√£ nh·∫≠n IP: ${offeredIp}. Th·ªùi gian thu√™: ${leaseTime} gi√¢y.</p>`;
    saveProgress('step12');
}

// Step 13
function resolveDnsRecord() {
    const domain = document.getElementById('domainInput').value.trim() || 'example.com';
    const type = document.getElementById('dnsRecordType').value;
    const resultDiv = document.getElementById('dnsRecordResult');
    let result = '';
    switch(type) {
        case 'A': result = Math.floor(Math.random() * 256) + '.' + Math.floor(Math.random() * 256) + '.' + Math.floor(Math.random() * 256) + '.' + Math.floor(Math.random() * 254 + 1); break;
        case 'AAAA': result = '2001:db8::' + Math.floor(Math.random() * 65535).toString(16); break;
        case 'MX': result = '10 mail.example.com'; break;
        case 'CNAME': result = 'real.server.com'; break;
        case 'TXT': result = '"v=spf1 include:_spf.google.com ~all"'; break;
    }
    resultDiv.innerHTML = `<p><strong>[${type}] ${domain}</strong> -> <strong>${result}</strong></p>`;
    saveProgress('step13');
}

// Step 14
function checkRouting() {
    const source = document.getElementById('sourceIp').value.trim();
    const dest = document.getElementById('destIp').value.trim();
    const maskStr = document.getElementById('maskInput').value.trim();
    const resultDiv = document.getElementById('routingResult');
    if (!source || !dest || !maskStr) {
        resultDiv.innerHTML = '<p style="color:red;">Nh·∫≠p ƒë·∫ßy ƒë·ªß!</p>';
        return;
    }
    try {
        const sourceNum = ipToNum(source);
        const destNum = ipToNum(dest);
        const maskNum = ipToNum(maskStr);
        const sameNetwork = (sourceNum & maskNum) === (destNum & maskNum);
        resultDiv.innerHTML = `<p style="font-weight:bold;">${sameNetwork ? 'C√πng m·∫°ng, kh√¥ng c·∫ßn router.' : 'Kh√°c m·∫°ng, c·∫ßn router.'}</p>`;
        saveProgress('step14');
    } catch {
        resultDiv.innerHTML = '<p style="color:red;">Format IP ho·∫∑c Mask sai!</p>';
    }
}

// Step 15
function checkFirewallRules() {
    const resultDiv = document.getElementById('firewallJsonResult');
    try {
        const rules = JSON.parse(document.getElementById('firewallRules').value);
        const ipStr = document.getElementById('firewallCheckIp').value;
        const port = parseInt(document.getElementById('firewallCheckPort').value);
        
        for (const rule of rules) {
            let ipMatch = !rule.source_ip;
            let portMatch = !rule.port || isNaN(port) || rule.port === port;
            
            if (rule.source_ip) {
                if (rule.source_ip.includes('/')) {
                    ipMatch = isIpInCidr(ipStr, rule.source_ip);
                } else {
                    ipMatch = (ipStr === rule.source_ip);
                }
            }

            if (ipMatch && portMatch) {
                const color = rule.action === 'allow' ? 'var(--success-color)' : 'var(--danger-color)';
                resultDiv.innerHTML = `<p style="color:${color}; font-weight:bold;">H√†nh ƒë·ªông: ${rule.action.toUpperCase()}. L√Ω do: ${rule.description}</p>`;
                saveProgress('step15');
                return;
            }
        }
         resultDiv.innerHTML = `<p>Kh√¥ng c√≥ lu·∫≠t n√†o kh·ªõp.</p>`;
    } catch(e) {
        resultDiv.innerHTML = `<p style="color:red;">L·ªói JSON kh√¥ng h·ª£p l·ªá!</p>`;
    }
}

// Step 16
function connectVpn() {
    const server = document.getElementById('vpnServer').value.trim() || 'vpn.example.com';
    const ip = document.getElementById('userIp').value.trim() || '192.168.1.10';
    const vpnType = document.querySelector('input[name="vpnType"]:checked').value;
    document.getElementById('vpnResult').innerHTML = `<p>K·∫øt n·ªëi ƒë·∫øn <strong>${server}</strong> t·ª´ <strong>${ip}</strong> qua <strong>${vpnType} VPN</strong> th√†nh c√¥ng!</p>`;
    saveProgress('step16');
}

// Step 17
function checkPasswordStrength(password) {
    const strengthDiv = document.getElementById('passwordStrength');
    let score = 0;
    if (password.length >= 8) score++;
    if (/[A-Z]/.test(password)) score++;
    if (/[a-z]/.test(password)) score++;
    if (/[0-9]/.test(password)) score++;
    if (/[^A-Za-z0-9]/.test(password)) score++;
    
    let width = (score / 5) * 100;
    const colors = getThemeColors();
    let color = colors.danger; // Y·∫øu
    if (score >= 3) color = colors.warning; // Trung b√¨nh
    if (score >= 4) color = colors.success; // M·∫°nh
    
    strengthDiv.style.width = width + '%';
    strengthDiv.style.backgroundColor = color;
}
function connectWifi() {
    const ssid = document.getElementById('ssidInput').value.trim() || 'MyWiFi';
    const pass = document.getElementById('wifiPass').value.trim();
    if(pass){
        document.getElementById('wifiResult').innerHTML = `<p>ƒêang th·ª≠ k·∫øt n·ªëi ƒë·∫øn SSID <strong>${ssid}</strong>...</p>`;
        saveProgress('step17');
    } else {
         document.getElementById('wifiResult').innerHTML = `<p style="color:var(--danger-color)">Vui l√≤ng nh·∫≠p m·∫≠t kh·∫©u cho SSID <strong>${ssid}</strong>!</p>`;
    }
}

// Step 18
function checkFinalQuiz() {
    const ans6 = document.getElementById('quiz6').value;
    const ans7 = document.getElementById('quiz7').value;
    const ans8 = document.getElementById('quiz8').value;
    let score = 0;
    let feedback = '<ul>';
    if (ans6 === 'ch·∫∑n') { score++; feedback += '<li style="color:green;">C√¢u 1 ƒë√∫ng!</li>'; } else { feedback += '<li style="color:red;">C√¢u 1 sai: Firewall l·ªçc v√† ch·∫∑n l∆∞u l∆∞·ª£ng nguy hi·ªÉm.</li>'; }
    if (ans7 === 'm√£ h√≥a') { score++; feedback += '<li style="color:green;">C√¢u 2 ƒë√∫ng!</li>'; } else { feedback += '<li style="color:red;">C√¢u 2 sai: VPN t·∫°o k·∫øt n·ªëi m√£ h√≥a an to√†n qua internet.</li>'; }
    if (ans8 === 'wpa23') { score++; feedback += '<li style="color:green;">C√¢u 3 ƒë√∫ng!</li>'; } else { feedback += '<li style="color:red;">C√¢u 3 sai: N√™n d√πng WPA2 ho·∫∑c WPA3 ƒë·ªÉ b·∫£o m·∫≠t Wi-Fi.</li>'; }
    feedback += '</ul>';
    const resultMessage = `<h3>K·∫øt qu·∫£: B·∫°n ƒë√∫ng ${score}/3 c√¢u!</h3> ${feedback}`;
    showModal(resultMessage);
    if (score === 3) saveProgress('step18');
}

// Step 19
function checkPort() {
    const port = parseInt(document.getElementById('portInput').value);
    const resultDiv = document.getElementById('portResult');
    let service = 'Unknown';
    let range = '';

    if(port >= 0 && port <= 1023) range = 'Well-known Port';
    else if(port >= 1024 && port <= 49151) range = 'Registered Port';
    else if(port >= 49152 && port <= 65535) range = 'Dynamic/Private Port';
    else {
        resultDiv.innerHTML = `<p style="color:red">Port kh√¥ng h·ª£p l·ªá</p>`;
        return;
    }

    if (port === 80) service = 'HTTP (Web)';
    else if (port === 443) service = 'HTTPS (Secure Web)';
    else if (port === 21) service = 'FTP (File Transfer)';
    else if (port === 22) service = 'SSH (Secure Shell)';
    else if (port === 25) service = 'SMTP (Email)';
    else if (port === 53) service = 'DNS (Domain Name System)';
    resultDiv.innerHTML = `<p>Port <strong>${port}</strong> thu·ªôc d·∫£i <strong>${range}</strong>. D·ªãch v·ª• ph·ªï bi·∫øn: ${service}</p>`;
    saveProgress('step19');
}

// Step 20
function suggestProtocol() {
    const app = document.getElementById('appInput').value.trim().toLowerCase();
    let protocol = 'TCP';
    let reason = 'c·∫ßn ƒë·ªô tin c·∫≠y cao (web, email, file transfer).';
    if (app.includes('video') || app.includes('game') || app.includes('stream') || app.includes('voice')) {
        protocol = 'UDP';
        reason = '∆∞u ti√™n t·ªëc ƒë·ªô h∆°n ƒë·ªô tin c·∫≠y.';
    }
    if (app.includes('video') || app.includes('voice')) {
         protocol = 'UDP ho·∫∑c QUIC';
         reason = '∆∞u ti√™n ƒë·ªô tr·ªÖ th·∫•p. QUIC l√† m·ªôt l·ª±a ch·ªçn hi·ªán ƒë·∫°i.';
    }
    document.getElementById('protocolResult').innerHTML = `<p>·ª®ng d·ª•ng <strong>${app}</strong> n√™n d√πng <strong>${protocol}</strong> v√¨ n√≥ ${reason}</p>`;
    saveProgress('step20');
}

// Step 21
function highlightOsiLayer() {
    const select = document.getElementById('osiProtocolSelect');
    const layer = select.value;
    const protocolName = select.options[select.selectedIndex].text;
    if(!layer) {
        drawOsi(-1);
        return;
    }
    drawOsi(parseInt(layer));
    document.getElementById('osiResult').innerHTML = `<p>Giao th·ª©c <strong>${protocolName}</strong> ho·∫°t ƒë·ªông ·ªü <strong>T·∫ßng ${layer}</strong>.</p>`;
    saveProgress('step21');
}

// Step 22
function renderScoreChart(quizId) {
    const history = JSON.parse(localStorage.getItem(quizId) || '[]');
    const chartDiv = document.getElementById('scoreHistoryChart');
    if (!history.length || !chartDiv) return;

    const maxScore = 3; 
    const barWidth = 100 / history.length;
    let svgContent = `<svg viewBox="0 0 100 ${maxScore}" preserveAspectRatio="none">`;
    history.forEach((score, index) => {
        const height = score.score;
        const x = index * barWidth;
        svgContent += `<rect class="bar" x="${x}%" y="${maxScore - height}" width="${barWidth - 2}%" height="${height}"><title>ƒêi·ªÉm: ${score.score}/${maxScore} - Ng√†y: ${new Date(score.date).toLocaleString()}</title></rect>`;
    });
    svgContent += '</svg>';
    chartDiv.innerHTML = `<h4>L·ªãch s·ª≠ Quiz:</h4>${svgContent}`;
}

function checkTotalQuiz() {
    const ans9 = document.getElementById('quiz9').value;
    const ans10 = document.getElementById('quiz10').value;
    const ans11 = document.getElementById('quiz11').value;
    let score = 0;
    let feedback = '<ul>';
    if (ans9 === 'http') { score++; feedback += '<li style="color:green;">C√¢u 1 ƒë√∫ng!</li>'; } else { feedback += '<li style="color:red;">C√¢u 1 sai: Port 80 l√† c·ªïng m·∫∑c ƒë·ªãnh cho HTTP (Web).</li>'; }
    if (ans10 === 'udp') { score++; feedback += '<li style="color:green;">C√¢u 2 ƒë√∫ng!</li>'; } else { feedback += '<li style="color:red;">C√¢u 2 sai: Video streaming ∆∞u ti√™n t·ªëc ƒë·ªô n√™n d√πng UDP.</li>'; }
    if (ans11 === 'network') { score++; feedback += '<li style="color:green;">C√¢u 3 ƒë√∫ng!</li>'; } else { feedback += '<li style="color:red;">C√¢u 3 sai: T·∫ßng 3 (Network) x·ª≠ l√Ω ƒë·ªãa ch·ªâ IP v√† ƒë·ªãnh tuy·∫øn.</li>'; }
    feedback += '</ul>';
    
    // Save score
    const quizId = 'totalQuizHistory';
    const history = JSON.parse(localStorage.getItem(quizId) || '[]');
    history.push({ score: score, date: new Date() });
    if(history.length > 10) history.shift(); // keep last 10 scores
    localStorage.setItem(quizId, JSON.stringify(history));

    const resultMessage = `<h3>K·∫øt qu·∫£: B·∫°n ƒë√∫ng ${score}/3 c√¢u!</h3> ${feedback}`;
    showModal(resultMessage);
    if (score === 3) saveProgress('step22');
    renderScoreChart(quizId);
}


// --- CANVAS DRAWING FUNCTIONS (RESPONSIVE) ---
function drawIpHouse() {
    const canvas = document.getElementById('ipHouseCanvas');
    if (!canvas?.getContext) return;
    resizeCanvas(canvas);
    const ctx = canvas.getContext('2d');
    const { w, h, colors } = { w: canvas.width, h: canvas.height, colors: getThemeColors() };
    
    ctx.fillStyle = colors.bg;
    ctx.fillRect(0, 0, w, h);
    ctx.fillStyle = colors.warning;
    ctx.fillRect(w * 0.1, h * 0.5, w * 0.8, h * 0.4);
    ctx.fillStyle = colors.text;
    ctx.font = `${Math.min(w*0.04, 20)}px Arial`;
    ctx.textAlign = 'center';
    ctx.fillText('Th√†nh Ph·ªë Internet', w / 2, h * 0.65);
    
    ctx.fillStyle = colors.success;
    const houseW = w * 0.2;
    const houseH = h * 0.3;
    const houseX = w / 2 - houseW / 2;
    const houseY = h * 0.2;
    ctx.beginPath();
    ctx.moveTo(houseX, houseY);
    ctx.lineTo(houseX + houseW / 2, h * 0.05);
    ctx.lineTo(houseX + houseW, houseY);
    ctx.closePath();
    ctx.fill();
    ctx.fillRect(houseX, houseY, houseW, houseH);
    ctx.fillStyle = colors.primary;
    ctx.font = `${Math.min(w*0.03, 16)}px Arial`;
    ctx.fillText('IP: 192.168.1.1', w / 2, h * 0.8);
    ctx.fillStyle = colors.text;
    ctx.fillText('Ph·∫ßn ƒë·∫ßu: Network', w * 0.25, h * 0.95);
    ctx.fillText('Ph·∫ßn sau: Host', w * 0.75, h * 0.95);
}

function drawSubnetCity() {
    const canvas = document.getElementById('subnetCityCanvas');
    if (!canvas?.getContext) return;
    resizeCanvas(canvas);
    const ctx = canvas.getContext('2d');
    const { w, h, colors } = { w: canvas.width, h: canvas.height, colors: getThemeColors() };

    ctx.fillStyle = colors.bg;
    ctx.fillRect(0, 0, w, h);
    ctx.strokeStyle = colors.danger;
    ctx.lineWidth = 3;
    ctx.strokeRect(w * 0.1, h * 0.1, w * 0.8, h * 0.8);
    ctx.fillStyle = colors.text;
    ctx.font = `${Math.min(w*0.04, 20)}px Arial`;
    ctx.textAlign = 'center';
    ctx.fillText('Th√†nh Ph·ªë L·ªõn (M·∫°ng Ch√≠nh)', w / 2, h * 0.08);

    ctx.strokeStyle = colors.primary;
    ctx.strokeRect(w * 0.2, h * 0.25, w * 0.6, h * 0.5);
    ctx.fillText('Khu Ph·ªë Con (Subnet)', w / 2, h * 0.8);

    for (let i = 0; i < 3; i++) {
        ctx.fillStyle = colors.success;
        ctx.fillRect(w * 0.3 + i * w * 0.15, h * 0.4, w * 0.1, w * 0.1);
    }
}

function drawAddressRange(cidr = 24) {
    const canvas = document.getElementById('addressRangeCanvas');
    if (!canvas?.getContext) return;
    resizeCanvas(canvas);
    const ctx = canvas.getContext('2d');
    const { w, h, colors } = { w: canvas.width, h: canvas.height, colors: getThemeColors() };

    ctx.fillStyle = colors.bg;
    ctx.fillRect(0, 0, w, h);
    
    ctx.fillStyle = '#e9ecef';
    ctx.fillRect(w * 0.1, h * 0.4, w * 0.8, h * 0.2);
    ctx.fillStyle = colors.primary;
    ctx.fillRect(w * 0.1, h * 0.4, (cidr / 32) * w * 0.8, h * 0.2);
    ctx.fillStyle = colors.success;
    ctx.fillRect(w * 0.1 + (cidr / 32) * w * 0.8, h * 0.4, ((32 - cidr) / 32) * w * 0.8, h * 0.2);

    ctx.fillStyle = colors.text;
    ctx.font = `${Math.min(w*0.04, 16)}px Arial`;
    ctx.textAlign = 'center';
    ctx.fillText('D·∫£i ƒê·ªãa Ch·ªâ To√†n B·ªô (32 bit)', w / 2, h * 0.2);
    ctx.textAlign = 'left';
    ctx.fillText('Network', w * 0.1, h * 0.75);
    ctx.textAlign = 'right';
    ctx.fillText('Host', w * 0.9, h * 0.75);
}

function drawNetworkSimulation() {
    const canvas = document.getElementById('networkSimulationCanvas');
    if (!canvas?.getContext) return;
    resizeCanvas(canvas);
    const ctx = canvas.getContext('2d');
    const { w, h, colors } = { w: canvas.width, h: canvas.height, colors: getThemeColors() };

    ctx.fillStyle = colors.bg;
    ctx.fillRect(0, 0, w, h);
    ctx.fillStyle = colors.primary;
    const routerR = Math.min(w * 0.08, 50);
    ctx.beginPath();
    ctx.arc(w / 2, h * 0.2, routerR, 0, 2 * Math.PI);
    ctx.fill();
    ctx.fillStyle = 'white';
    ctx.font = `${Math.min(w*0.03, 20)}px Arial`;
    ctx.textAlign = 'center';
    ctx.fillText('Router', w / 2, h * 0.2 + 5);
    ctx.fillStyle = colors.text;
    ctx.fillText('192.168.1.1/24', w / 2, h * 0.2 + routerR + 20);

    const hosts = [
        { x: w * 0.2, y: h * 0.7, ip: '1.10' }, 
        { x: w * 0.5, y: h * 0.7, ip: '1.20' }, 
        { x: w * 0.8, y: h * 0.7, ip: '1.30' }
    ];
    const hostR = Math.min(w * 0.07, 40);
    hosts.forEach(host => {
        ctx.fillStyle = colors.success;
        ctx.beginPath();
        ctx.arc(host.x, host.y, hostR, 0, 2 * Math.PI);
        ctx.fill();
        ctx.fillStyle = colors.text;
        ctx.font = `${Math.min(w*0.025, 12)}px Arial`;
        ctx.fillText(`192.168.${host.ip}`, host.x, host.y + hostR + 15);
        ctx.strokeStyle = colors.secondary;
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(w / 2, h * 0.2 + routerR);
        ctx.lineTo(host.x, host.y - hostR);
        ctx.stroke();
    });
}

function drawSubnetting() {
    const canvas = document.getElementById('subnettingCanvas');
    if (!canvas?.getContext) return;
    resizeCanvas(canvas);
    const ctx = canvas.getContext('2d');
    const { w, h, colors } = { w: canvas.width, h: canvas.height, colors: getThemeColors() };
    
    ctx.fillStyle = colors.bg;
    ctx.fillRect(0, 0, w, h);
    ctx.fillStyle = colors.text;
    ctx.font = `${Math.min(w*0.04, 20)}px Arial`;
    ctx.textAlign = 'center';

    ctx.strokeStyle = colors.danger;
    ctx.lineWidth = 3;
    ctx.strokeRect(w*0.1, h*0.1, w*0.8, h*0.2);
    ctx.fillText('M·∫°ng G·ªëc /24', w/2, h*0.08);

    for (let i = 0; i < 4; i++) {
        ctx.strokeStyle = colors.primary;
        ctx.strokeRect(w*0.05 + i * w*0.23, h*0.5, w*0.2, h*0.3);
        ctx.font = `${Math.min(w*0.03, 16)}px Arial`;
        ctx.fillText(`Subnet ${i + 1} /26`, w*0.15 + i*w*0.23, h*0.85);
        ctx.strokeStyle = colors.secondary;
        ctx.beginPath();
        ctx.moveTo(w/2, h*0.3);
        ctx.lineTo(w*0.15 + i*w*0.23, h*0.5);
        ctx.stroke();
    }
}

function drawPublicPrivate() {
    const canvas = document.getElementById('publicPrivateCanvas');
    if (!canvas?.getContext) return;
    resizeCanvas(canvas);
    const ctx = canvas.getContext('2d');
    const { w, h, colors } = { w: canvas.width, h: canvas.height, colors: getThemeColors() };
    ctx.fillStyle = colors.bg;
    ctx.fillRect(0, 0, w, h);
    ctx.fillStyle = colors.success;
    ctx.fillRect(w * 0.1, h * 0.3, w * 0.3, h * 0.4);
    ctx.fillStyle = 'white';
    ctx.font = `${Math.min(w*0.03, 16)}px Arial`;
    ctx.textAlign = 'center';
    ctx.fillText('Private Network', w * 0.25, h / 2);

    ctx.fillStyle = colors.primary;
    ctx.beginPath();
    ctx.arc(w * 0.8, h / 2, w*0.1, 0, 2 * Math.PI);
    ctx.fill();
    ctx.fillStyle = 'white';
    ctx.fillText('Internet', w * 0.8, h / 2);

    ctx.strokeStyle = colors.danger;
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(w * 0.4, h / 2);
    ctx.lineTo(w * 0.7, h / 2);
    ctx.stroke();
    ctx.fillStyle = colors.text;
    ctx.fillText('Router (NAT)', w * 0.55, h*0.5 + 20);
}

function drawVlsm() {
    const canvas = document.getElementById('vlsmCanvas');
    if (!canvas?.getContext) return;
    resizeCanvas(canvas);
    const ctx = canvas.getContext('2d');
    const { w, h, colors } = { w: canvas.width, h: canvas.height, colors: getThemeColors() };

    ctx.fillStyle = colors.bg;
    ctx.fillRect(0, 0, w, h);
    ctx.textAlign = 'center';
    ctx.strokeStyle = colors.danger;
    ctx.lineWidth = 3;
    ctx.strokeRect(w*0.1, h*0.1, w*0.8, h*0.15);
    ctx.fillStyle = colors.text;
    ctx.font = `${Math.min(w*0.04, 20)}px Arial`;
    ctx.fillText('M·∫°ng G·ªëc /16', w/2, h*0.08);

    ctx.textAlign = 'left';
    ctx.font = `${Math.min(w*0.03, 16)}px Arial`;
    ctx.strokeStyle = colors.primary;
    ctx.strokeRect(w*0.1, h*0.4, w*0.6, h*0.15);
    ctx.fillText('Subnet for 100 hosts (/25)', w*0.12, h*0.5);
    ctx.strokeStyle = colors.success;
    ctx.strokeRect(w*0.1, h*0.6, w*0.3, h*0.15);
    ctx.fillText('Subnet for 50 hosts (/26)', w*0.12, h*0.7);
    ctx.strokeStyle = colors.warning;
    ctx.strokeRect(w*0.45, h*0.6, w*0.2, h*0.15);
    ctx.fillText('Subnet for 20 hosts (/27)', w*0.47, h*0.7);
}

function drawIpv6() {
    const canvas = document.getElementById('ipv6Canvas');
    if (!canvas?.getContext) return;
    resizeCanvas(canvas);
    const ctx = canvas.getContext('2d');
    const { w, h, colors } = { w: canvas.width, h: canvas.height, colors: getThemeColors() };
    
    ctx.fillStyle = colors.bg;
    ctx.fillRect(0, 0, w, h);
    ctx.font = `${Math.min(w*0.04, 18)}px Arial`;
    ctx.textAlign = 'center';

    ctx.fillStyle = colors.primary;
    ctx.fillRect(w*0.1, h*0.2, w*0.4, h*0.2);
    ctx.fillStyle = 'white';
    ctx.fillText('IPv4: 32 bit', w*0.3, h*0.3);
    
    ctx.fillStyle = colors.success;
    ctx.fillRect(w*0.1, h*0.6, w*0.8, h*0.2);
    ctx.fillStyle = 'white';
    ctx.fillText('IPv6: 128 bit', w*0.5, h*0.7);
}

function drawNat() {
    const canvas = document.getElementById('natCanvas');
    if (!canvas?.getContext) return;
    resizeCanvas(canvas);
    const ctx = canvas.getContext('2d');
    const { w, h, colors } = { w: canvas.width, h: canvas.height, colors: getThemeColors() };
    
    ctx.fillStyle = colors.bg;
    ctx.fillRect(0, 0, w, h);
    ctx.textAlign = 'center';
    
    const routerR = Math.min(w * 0.08, 50);
    ctx.fillStyle = colors.primary;
    ctx.beginPath();
    ctx.arc(w/2, h*0.3, routerR, 0, 2 * Math.PI);
    ctx.fill();
    ctx.fillStyle = 'white';
    ctx.font = `${Math.min(w*0.03, 16)}px Arial`;
    ctx.fillText('NAT Router', w/2, h*0.3);
    ctx.fillStyle = colors.text;
    ctx.fillText('Public: 203.0.113.1', w/2, h*0.3 + routerR + 20);

    ctx.fillStyle = colors.danger;
    const internetR = Math.min(w * 0.1, 60);
    ctx.beginPath();
    ctx.arc(w*0.85, h*0.3, internetR, 0, 2*Math.PI);
    ctx.fill();
    ctx.fillStyle = 'white';
    ctx.fillText('Internet', w*0.85, h*0.3);

    ctx.strokeStyle = colors.secondary;
    ctx.beginPath();
    ctx.moveTo(w/2 + routerR, h*0.3);
    ctx.lineTo(w*0.85 - internetR, h*0.3);
    ctx.stroke();

    for (let i = 0; i < 3; i++) {
        const hostX = w*0.2 + i * w*0.3;
        const hostY = h*0.7;
        ctx.fillStyle = colors.success;
        ctx.fillRect(hostX - w*0.07, hostY - h*0.1, w*0.14, h*0.2);
        ctx.fillStyle = colors.text;
        ctx.fillText('192.168.1.' + (10+i), hostX, hostY+h*0.15);
        
        ctx.beginPath();
        ctx.moveTo(hostX, hostY - h*0.1);
        ctx.lineTo(w/2, h*0.3 + routerR);
        ctx.stroke();
    }
}

function drawDhcp() {
    const canvas = document.getElementById('dhcpCanvas');
    if (!canvas?.getContext) return;
    resizeCanvas(canvas);
    const ctx = canvas.getContext('2d');
    const { w, h, colors } = { w: canvas.width, h: canvas.height, colors: getThemeColors() };

    ctx.fillStyle = colors.bg;
    ctx.fillRect(0, 0, w, h);
    ctx.textAlign = 'center';
    ctx.font = `${Math.min(w*0.03, 16)}px Arial`;
    
    ctx.fillStyle = colors.success;
    ctx.fillRect(w*0.1, h*0.3, w*0.2, h*0.4);
    ctx.fillStyle = 'white';
    ctx.fillText('Client', w*0.2, h*0.5);

    ctx.fillStyle = colors.primary;
    ctx.fillRect(w*0.7, h*0.3, w*0.2, h*0.4);
    ctx.fillStyle = 'white';
    ctx.fillText('DHCP Server', w*0.8, h*0.5);
    
    ctx.fillStyle = colors.text;
    ctx.fillText('1. Discover ‚ûî', w/2, h*0.3);
    ctx.fillText('ü†ê 2. Offer', w/2, h*0.45);
    ctx.fillText('3. Request ‚ûî', w/2, h*0.6);
    ctx.fillText('ü†ê 4. ACK', w/2, h*0.75);
}

function drawDns() {
    const canvas = document.getElementById('dnsCanvas');
    if (!canvas?.getContext) return;
    resizeCanvas(canvas);
    const ctx = canvas.getContext('2d');
    const { w, h, colors } = { w: canvas.width, h: canvas.height, colors: getThemeColors() };
    
    ctx.fillStyle = colors.bg;
    ctx.fillRect(0, 0, w, h);
    ctx.textAlign = 'center';
    ctx.font = `${Math.min(w*0.03, 16)}px Arial`;

    ctx.fillStyle = colors.success;
    ctx.fillRect(w*0.1, h*0.3, w*0.2, h*0.4);
    ctx.fillStyle = 'white';
    ctx.fillText('Client', w*0.2, h*0.5);
    
    ctx.fillStyle = colors.primary;
    ctx.fillRect(w*0.7, h*0.3, w*0.2, h*0.4);
    ctx.fillStyle = 'white';
    ctx.fillText('DNS Server', w*0.8, h*0.5);

    ctx.fillStyle = colors.text;
    ctx.fillText('Query: "example.com"? ‚ûî', w/2, h*0.4);
    ctx.fillText('ü†ê Response: "93.184.216.34"', w/2, h*0.6);
}

function drawRouting() {
    const canvas = document.getElementById('routingCanvas');
    if (!canvas?.getContext) return;
    resizeCanvas(canvas);
    const ctx = canvas.getContext('2d');
    const { w, h, colors } = { w: canvas.width, h: canvas.height, colors: getThemeColors() };
    
    ctx.fillStyle = colors.bg;
    ctx.fillRect(0, 0, w, h);
    ctx.textAlign = 'center';
    ctx.font = `${Math.min(w*0.03, 16)}px Arial`;
    
    ctx.strokeStyle = colors.success;
    ctx.strokeRect(w*0.05, h*0.2, w*0.3, h*0.6);
    ctx.fillText('M·∫°ng 1: 192.168.1.0/24', w*0.2, h*0.15);
    
    ctx.fillStyle = colors.primary;
    ctx.beginPath();
    ctx.arc(w/2, h/2, w*0.08, 0, 2*Math.PI);
    ctx.fill();
    ctx.fillStyle = 'white';
    ctx.fillText('Router', w/2, h/2);
    
    ctx.strokeStyle = colors.danger;
    ctx.strokeRect(w*0.65, h*0.2, w*0.3, h*0.6);
    ctx.fillStyle = colors.text;
    ctx.fillText('M·∫°ng 2: 192.168.2.0/24', w*0.8, h*0.15);
    
    ctx.strokeStyle = colors.secondary;
    ctx.beginPath();
    ctx.moveTo(w*0.35, h/2);
    ctx.lineTo(w/2-w*0.08, h/2);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(w/2+w*0.08, h/2);
    ctx.lineTo(w*0.65, h/2);
    ctx.stroke();
}

function drawFirewall(packetX, status) {
    const canvas = document.getElementById('firewallCanvas');
     if (!canvas?.getContext) return;
    resizeCanvas(canvas);
    const ctx = canvas.getContext('2d');
    const { w, h, colors } = { w: canvas.width, h: canvas.height, colors: getThemeColors() };

    ctx.fillStyle = colors.bg;
    ctx.fillRect(0, 0, w, h);
    ctx.textAlign = 'center';
    ctx.font = `${Math.min(w*0.03, 16)}px Arial`;

    ctx.fillStyle = colors.success;
    ctx.fillRect(w*0.1, h*0.3, w*0.25, h*0.4);
    ctx.fillStyle = 'white';
    ctx.fillText('M·∫°ng N·ªôi B·ªô', w*0.225, h/2);
    
    ctx.fillStyle = colors.danger;
    ctx.fillRect(w/2 - w*0.02, h*0.2, w*0.04, h*0.6);
    
    ctx.fillStyle = colors.primary;
    ctx.beginPath();
    ctx.arc(w*0.8, h/2, w*0.1, 0, 2 * Math.PI);
    ctx.fill();
    ctx.fillStyle = 'white';
    ctx.fillText('Internet', w*0.8, h/2);
    
    if (packetX) {
        ctx.fillStyle = status === 'blocked' ? colors.danger : colors.success;
        ctx.beginPath();
        ctx.arc(packetX, h/2, w*0.02, 0, 2 * Math.PI);
        ctx.fill();

        if (status) {
            ctx.font = `${Math.min(w*0.04, 20)}px Arial`;
            ctx.fillStyle = status === 'blocked' ? colors.danger : colors.success;
            ctx.fillText(status === 'blocked' ? 'Ch·∫∑n!' : 'Cho ph√©p!', w*0.6, h*0.3);
        }
    }
}
let firewallAnimationId;
function animateFirewall() {
    cancelAnimationFrame(firewallAnimationId);
    const canvas = document.getElementById('firewallCanvas');
    if (!canvas?.getContext) return;
    let x = canvas.width * 0.7;
    const isBlocked = Math.random() > 0.5;
    const firewallEdge = canvas.width/2 + canvas.width*0.02;
    const allowedDest = canvas.width * 0.3;
    function animate() {
        if ((isBlocked && x <= firewallEdge) || (!isBlocked && x <= allowedDest)) {
            drawFirewall(x, isBlocked ? 'blocked' : 'allowed');
            return;
        }
        drawFirewall(x);
        x -= 5;
        firewallAnimationId = requestAnimationFrame(animate);
    }
    animate();
}

function drawVpn(packetX) {
    const canvas = document.getElementById('vpnCanvas');
    if (!canvas?.getContext) return;
    resizeCanvas(canvas);
    const ctx = canvas.getContext('2d');
    const { w, h, colors } = { w: canvas.width, h: canvas.height, colors: getThemeColors() };

    ctx.fillStyle = colors.bg;
    ctx.fillRect(0, 0, w, h);
    ctx.textAlign = 'center';
    ctx.font = `${Math.min(w*0.03, 16)}px Arial`;
    
    ctx.fillStyle = colors.success;
    ctx.fillRect(w*0.1, h*0.3, w*0.2, h*0.4);
    ctx.fillStyle = 'white';
    ctx.fillText('User', w*0.2, h/2);
    
    ctx.fillStyle = colors.primary;
    ctx.fillRect(w*0.7, h*0.3, w*0.2, h*0.4);
    ctx.fillStyle = 'white';
    ctx.fillText('VPN Server', w*0.8, h/2);

    ctx.fillStyle = 'rgba(220, 53, 69, 0.5)';
    ctx.fillRect(w*0.3, h*0.4, w*0.4, h*0.2);
    ctx.fillStyle = colors.text;
    ctx.fillText('Encrypted Tunnel', w/2, h*0.65);
    
    if (packetX) {
        ctx.fillStyle = colors.warning;
        ctx.beginPath();
        ctx.arc(packetX, h/2, w*0.02, 0, 2*Math.PI);
        ctx.fill();
    }
}
let vpnAnimationId;
function animateVpn() {
    cancelAnimationFrame(vpnAnimationId);
    const canvas = document.getElementById('vpnCanvas');
    if (!canvas?.getContext) return;
    let x = canvas.width * 0.3;
    const dest = canvas.width * 0.7;
    function animate() {
        if(x >= dest) {
            drawVpn();
            const { w, h, colors } = { w: canvas.width, h: canvas.height, colors: getThemeColors() };
            ctx.fillStyle = colors.success;
            ctx.font = `${Math.min(w*0.04, 20)}px Arial`;
            ctx.fillText('Connected!', w*0.8, h*0.25);
            return;
        }
        drawVpn(x);
        x += 5;
        vpnAnimationId = requestAnimationFrame(animate);
    }
    animate();
}

function drawWifi(radius) {
    const canvas = document.getElementById('wifiCanvas');
    if (!canvas?.getContext) return;
    resizeCanvas(canvas);
    const ctx = canvas.getContext('2d');
    const { w, h, colors } = { w: canvas.width, h: canvas.height, colors: getThemeColors() };
    
    ctx.fillStyle = colors.bg;
    ctx.fillRect(0, 0, w, h);
    
    const routerR = Math.min(w*0.05, 30);
    ctx.fillStyle = colors.primary;
    ctx.beginPath();
    ctx.arc(w/2, h/2, routerR, 0, 2 * Math.PI);
    ctx.fill();
    
    for (let i = 1; i <= 3; i++) {
        ctx.strokeStyle = colors.primary;
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.arc(w/2, h/2, routerR + i * w*0.04, -Math.PI/3, Math.PI/3);
        ctx.stroke();
    }

    if (radius) {
         ctx.strokeStyle = colors.warning;
         ctx.lineWidth = 4;
         ctx.beginPath();
         ctx.arc(w/2, h/2, radius, 0, 2 * Math.PI);
         ctx.stroke();
    }
}
let wifiAnimationId;
function animateWifi() {
    cancelAnimationFrame(wifiAnimationId);
    const canvas = document.getElementById('wifiCanvas');
    if (!canvas?.getContext) return;
    let radius = Math.min(w*0.05, 30);
    const maxRadius = canvas.width * 0.4;
    function animate() {
        if (radius > maxRadius) {
             drawWifi();
             return;
        }
        drawWifi(radius);
        radius += 5;
        wifiAnimationId = requestAnimationFrame(animate);
    }
    animate();
}

function drawPort(packetY) {
    const canvas = document.getElementById('portCanvas');
    if (!canvas?.getContext) return;
    resizeCanvas(canvas);
    const ctx = canvas.getContext('2d');
    const { w, h, colors } = { w: canvas.width, h: canvas.height, colors: getThemeColors() };
    
    ctx.fillStyle = colors.bg;
    ctx.fillRect(0, 0, w, h);
    ctx.font = `${Math.min(w*0.03, 16)}px Arial`;
    ctx.textAlign = 'center';
    
    ctx.fillStyle = colors.secondary;
    ctx.fillRect(w*0.3, h*0.25, w*0.4, h*0.6);
    ctx.fillStyle = colors.text;
    ctx.fillText('Server IP', w/2, h*0.2);

    const ports = [{num: 80}, {num: 443}, {num: 21}];
    ports.forEach((port, i) => {
        ctx.fillStyle = colors.primary;
        ctx.fillRect(w*0.35 + i*w*0.1, h*0.5, w*0.08, h*0.1);
        ctx.fillStyle = 'white';
        ctx.fillText('P:' + port.num, w*0.39 + i*w*0.1, h*0.57);
    });
    
    if (packetY) {
        ctx.fillStyle = colors.danger;
        ctx.beginPath();
        ctx.arc(w*0.39, packetY, w*0.02, 0, 2*Math.PI);
        ctx.fill();
    }
}
let portAnimationId;
function animatePort() {
    cancelAnimationFrame(portAnimationId);
    const canvas = document.getElementById('portCanvas');
    if (!canvas?.getContext) return;
    let y = canvas.height * 0.1;
    const dest = canvas.height * 0.5;
    function animate() {
        if(y > dest) {
            drawPort();
            return;
        }
        drawPort(y);
        y += 5;
        portAnimationId = requestAnimationFrame(animate);
    }
    animate();
}

function drawTcpUdp(tcpX, udpX) {
    const canvas = document.getElementById('tcpUdpCanvas');
    if (!canvas?.getContext) return;
    resizeCanvas(canvas);
    const ctx = canvas.getContext('2d');
    const { w, h, colors } = { w: canvas.width, h: canvas.height, colors: getThemeColors() };
    
    ctx.fillStyle = colors.bg;
    ctx.fillRect(0, 0, w, h);
    ctx.font = `${Math.min(w*0.03, 16)}px Arial`;
    ctx.textAlign = 'center';

    ctx.fillStyle = colors.primary;
    ctx.fillRect(w*0.1, h*0.2, w*0.3, h*0.4);
    ctx.fillStyle = 'white';
    ctx.fillText('TCP: Tin c·∫≠y', w*0.25, h*0.3);
    
    ctx.fillStyle = colors.danger;
    ctx.fillRect(w*0.6, h*0.2, w*0.3, h*0.4);
    ctx.fillStyle = 'white';
    ctx.fillText('UDP: Nhanh', w*0.75, h*0.3);
    
    if (tcpX) {
        ctx.fillStyle = colors.success;
        ctx.beginPath();
        ctx.arc(tcpX, h*0.8, w*0.02, 0, 2*Math.PI);
        ctx.fill();
        if(tcpX > w*0.25){ // ACK
             ctx.fillStyle = colors.warning;
             ctx.beginPath();
             ctx.arc(tcpX-w*0.1, h*0.8, w*0.015, 0, 2*Math.PI);
             ctx.stroke();
        }
    }
    if (udpX) {
        ctx.fillStyle = colors.success;
        ctx.beginPath();
        ctx.arc(udpX, h*0.8, w*0.02, 0, 2*Math.PI);
        ctx.fill();
    }
}
let tcpUdpAnimationId;
function animateTcpUdp() {
    cancelAnimationFrame(tcpUdpAnimationId);
    const canvas = document.getElementById('tcpUdpCanvas');
    if (!canvas?.getContext) return;
    const { w, h } = canvas;
    let tcpX = w*0.25, udpX = w*0.75;
    const dest = w;

    function animate() {
        let tcpDone = tcpX > dest;
        let udpDone = udpX > dest;
        if(tcpDone && udpDone) {
            drawTcpUdp();
            return;
        }
        drawTcpUdp(tcpX, udpX);
        if(!tcpDone) tcpX += 2;
        if(!udpDone) udpX += 5;
        tcpUdpAnimationId = requestAnimationFrame(animate);
    }
    animate();
}

function drawOsi(highlightLayer = -1) {
    const canvas = document.getElementById('osiCanvas');
    if (!canvas?.getContext) return;
    resizeCanvas(canvas);
    const ctx = canvas.getContext('2d');
    const { w, h, colors } = { w: canvas.width, h: canvas.height, colors: getThemeColors() };
    
    ctx.fillStyle = colors.bg;
    ctx.fillRect(0, 0, w, h);
    ctx.textAlign = 'center';
    
    const layers = ['7. Application', '6. Presentation', '5. Session', '4. Transport', '3. Network', '2. Data Link', '1. Physical'];
    const layerHeight = h*0.12;
    for (let i = 0; i < 7; i++) {
        if (i === (7-highlightLayer)) {
            ctx.fillStyle = colors.warning;
        } else {
            ctx.fillStyle = `hsl(${i*50}, 70%, 50%)`;
        }
        ctx.fillRect(w*0.1, h*0.05 + i * layerHeight, w*0.8, layerHeight * 0.9);
        ctx.fillStyle = 'white';
        ctx.font = `${Math.min(w*0.03, 18)}px Arial`;
        ctx.fillText(layers[i], w/2, h*0.05 + i * layerHeight + layerHeight*0.5);
    }
}


const animatedCanvases = [
    { id: 'firewallCanvas', func: animateFirewall },
    { id: 'vpnCanvas', func: animateVpn },
    { id: 'wifiCanvas', func: animateWifi },
    { id: 'portCanvas', func: animatePort },
    { id: 'tcpUdpCanvas', func: animateTcpUdp }
];

const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            const canvasId = entry.target.id;
            const anim = animatedCanvases.find(c => c.id === canvasId);
            if (anim) {
                anim.func();
                observer.unobserve(entry.target);
            }
        }
    });
}, { threshold: 0.5 });


function redrawAllCanvases() {
    drawIpHouse();
    drawSubnetCity();
    updateCidr();
    drawNetworkSimulation();
    drawSubnetting();
    drawPublicPrivate();
    drawVlsm();
    drawIpv6();
    drawNat();
    drawDhcp();
    drawDns();
    drawRouting();
    drawFirewall();
    drawVpn();
    drawWifi();
    drawPort();
    drawTcpUdp();
    drawOsi();
}

// Initial setup on page load
window.onload = () => {
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);
    themeToggle.textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';

    updateProgressUI();
    
    redrawAllCanvases();

    renderScoreChart('totalQuizHistory');

    updateScrollProgress();

    animatedCanvases.forEach(item => {
        const el = document.getElementById(item.id);
        if(el) observer.observe(el);
    });
};
</script>
</body>
</html>
