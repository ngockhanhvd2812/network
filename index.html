
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>M√¥ H√¨nh H√≥a IP v√† Subnet Mask</title>
    <style>
        :root {
            --primary-color: #007bff;
            --primary-hover: #0056b3;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --light-bg: #f8f9fa;
            --dark-bg: #343a40;
            --text-color-light: #333;
            --text-color-dark: #f8f9fa;
            --border-color: #dee2e6;
            --card-bg: white;
            --card-shadow: 0 4px 8px rgba(0,0,0,0.1);
            --font-family: Arial, sans-serif;
            --sidebar-width: 280px;
        }

        html[data-theme='dark'] {
            --light-bg: #212529;
            --dark-bg: #f8f9fa;
            --text-color-light: #f8f9fa;
            --text-color-dark: #343a40;
            --border-color: #495057;
            --card-bg: #343a40;
            --card-shadow: 0 4px 12px rgba(0,0,0,0.4);
        }

        html {
            scroll-behavior: smooth;
            scroll-padding-top: 60px; /* Account for fixed header */
        }

        body {
            font-family: var(--font-family);
            margin: 0;
            padding-left: var(--sidebar-width); /* Space for sidebar */
            background-color: var(--light-bg);
            color: var(--text-color-light);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }

        .main-content {
            padding: 20px 40px;
        }

        h1, h2, h3 {
            color: var(--primary-color);
        }

        .section {
            margin-bottom: 40px;
            padding: 25px;
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
            transition: background-color 0.3s, border-color 0.3s;
        }
        
        .section.done {
            border-left: 5px solid var(--success-color);
        }

        .interactive {
            border: 1px solid var(--primary-color);
            padding: 20px;
            border-radius: 10px;
            background-color: color-mix(in srgb, var(--primary-color) 10%, transparent);
            margin-top: 20px;
        }

        canvas {
            display: block;
            margin: 20px auto;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            max-width: 100%;
            height: auto;
        }

        input, button, select {
            padding: 12px;
            margin: 10px 5px;
            font-size: 16px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            background-color: var(--card-bg);
            color: var(--text-color-light);
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px color-mix(in srgb, var(--primary-color) 30%, transparent);
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }

        button:hover {
            background-color: var(--primary-hover);
            transform: translateY(-2px);
        }

        .result-box {
            margin-top: 20px;
            padding: 15px;
            background-color: color-mix(in srgb, var(--success-color) 10%, transparent);
            border-radius: 6px;
            color: var(--text-color-light);
            font-size: 16px;
            min-height: 50px;
            border-left: 4px solid var(--success-color);
        }

        .bit-bar {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px 0;
        }

        .bit {
            width: 25px; height: 25px; line-height: 25px;
            text-align: center; border: 1px solid var(--text-color-light);
            margin: 2px; font-size: 14px; font-weight: bold;
            color: white; transition: transform 0.3s;
        }

        .bit:hover { transform: scale(1.2); }
        .network-bit { background-color: var(--primary-color); }
        .host-bit { background-color: var(--success-color); }

        .analogy {
            background-color: color-mix(in srgb, var(--warning-color) 20%, transparent);
            padding: 15px; border-radius: 8px;
            margin: 20px 0; font-style: italic;
            border-left: 4px solid var(--warning-color);
        }
        
        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: var(--sidebar-width);
            height: 100vh;
            background-color: var(--card-bg);
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            padding: 20px;
            overflow-y: auto;
            border-right: 1px solid var(--border-color);
            z-index: 1000;
        }
        .sidebar h2 { margin-top: 0; }
        .sidebar ul { list-style: none; padding: 0; margin: 0; }
        .sidebar li a {
            display: block;
            padding: 10px 15px;
            color: var(--text-color-light);
            text-decoration: none;
            border-radius: 5px;
            margin-bottom: 5px;
            transition: background-color 0.2s;
        }
        .sidebar li a:hover { background-color: color-mix(in srgb, var(--primary-color) 10%, transparent); }
        .sidebar li a.active { background-color: var(--primary-color); color: white; font-weight: bold; }
        .sidebar li a.done::before { content: '‚úî '; color: var(--success-color); }

        /* Progress Bar */
        .progress-container {
            width: calc(100% - var(--sidebar-width));
            background-color: var(--border-color);
            position: fixed;
            top: 0;
            left: var(--sidebar-width);
            z-index: 999;
        }
        .progress-bar {
            height: 8px;
            width: 0%;
            background-color: var(--primary-color);
            transition: width 0.1s linear;
        }

        /* Theme Toggle */
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 40px; height: 40px;
            cursor: pointer; font-size: 20px;
            display: flex; align-items: center; justify-content: center;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed; z-index: 2000;
            left: 0; top: 0; width: 100%; height: 100%;
            overflow: auto; background-color: rgba(0,0,0,0.5);
            align-items: center; justify-content: center;
        }
        .modal-content {
            background-color: var(--card-bg);
            margin: auto; padding: 30px;
            border: 1px solid var(--border-color);
            width: 80%; max-width: 500px;
            border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            position: relative;
            animation: fadeIn 0.3s;
        }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .close-button {
            color: var(--secondary-color);
            position: absolute; top: 10px; right: 20px;
            font-size: 28px; font-weight: bold;
            cursor: pointer;
        }
        .close-button:hover { color: var(--danger-color); }
        
        /* Responsive */
        @media (max-width: 992px) {
            body { padding-left: 0; }
            .sidebar { transform: translateX(calc(-1 * var(--sidebar-width))); }
            .progress-container { width: 100%; left: 0; }
            .main-content { padding: 20px; }
        }
    </style>
</head>
<body>
    <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
    </div>

    <nav class="sidebar" id="sidebar">
        <h2>B√†i H·ªçc</h2>
        <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode">üåô</button>
        <ul>
            <li><a href="#step1" id="nav-step1">B∆∞·ªõc 1: IP Address l√† g√¨?</a></li>
            <li><a href="#step2" id="nav-step2">B∆∞·ªõc 2: Subnet Mask l√† g√¨?</a></li>
            <li><a href="#step3" id="nav-step3">B∆∞·ªõc 3: T√≠nh to√°n Subnet</a></li>
            <li><a href="#step4" id="nav-step4">B∆∞·ªõc 4: Quiz c∆° b·∫£n</a></li>
            <li><a href="#step5" id="nav-step5">B∆∞·ªõc 5: M√¥ ph·ªèng m·∫°ng</a></li>
            <li><a href="#step6" id="nav-step6">B∆∞·ªõc 6: Subnetting n√¢ng cao</a></li>
            <li><a href="#step7" id="nav-step7">B∆∞·ªõc 7: IP Public & Private</a></li>
            <li><a href="#step8" id="nav-step8">B∆∞·ªõc 8: Quiz n√¢ng cao</a></li>
            <li><a href="#step9" id="nav-step9">B∆∞·ªõc 9: VLSM</a></li>
            <li><a href="#step10" id="nav-step10">B∆∞·ªõc 10: IPv6</a></li>
            <li><a href="#step11" id="nav-step11">B∆∞·ªõc 11: NAT</a></li>
            <li><a href="#step12" id="nav-step12">B∆∞·ªõc 12: DHCP</a></li>
            <li><a href="#step13" id="nav-step13">B∆∞·ªõc 13: DNS</a></li>
            <li><a href="#step14" id="nav-step14">B∆∞·ªõc 14: Routing</a></li>
            <li><a href="#step15" id="nav-step15">B∆∞·ªõc 15: Firewall</a></li>
            <li><a href="#step16" id="nav-step16">B∆∞·ªõc 16: VPN</a></li>
            <li><a href="#step17" id="nav-step17">B∆∞·ªõc 17: Wi-Fi</a></li>
            <li><a href="#step18" id="nav-step18">B∆∞·ªõc 18: Quiz cu·ªëi c√πng</a></li>
            <li><a href="#step19" id="nav-step19">B∆∞·ªõc 19: Port & Socket</a></li>
            <li><a href="#step20" id="nav-step20">B∆∞·ªõc 20: TCP vs UDP</a></li>
            <li><a href="#step21" id="nav-step21">B∆∞·ªõc 21: M√¥ h√¨nh OSI</a></li>
            <li><a href="#step22" id="nav-step22">B∆∞·ªõc 22: Quiz t·ªïng h·ª£p</a></li>
        </ul>
    </nav>
    
    <div class="main-content">
        <h1>M√¥ H√¨nh H√≥a IP v√† Subnet Mask</h1>
        <div class="section" id="step1">
            <h2>B∆∞·ªõc 1: IP Address L√† G√¨? (Gi·ªëng Nh∆∞ ƒê·ªãa Ch·ªâ Nh√†)</h2>
            <p>H√£y t∆∞·ªüng t∆∞·ª£ng internet nh∆∞ m·ªôt th√†nh ph·ªë kh·ªïng l·ªì. M·ªói m√°y t√≠nh, ƒëi·ªán tho·∫°i l√† m·ªôt ng√¥i nh√†. ƒê·ªÉ g·ª≠i th∆∞ (d·ªØ li·ªáu), c·∫ßn ƒë·ªãa ch·ªâ nh√† ch√≠nh x√°c. ƒê√≥ l√† IP!</p>
            <p>IP IPv4 gi·ªëng nh∆∞: <strong>S·ªë nh√†. ƒê∆∞·ªùng. Ph∆∞·ªùng. Qu·∫≠n</strong> - Nh∆∞ng d√πng s·ªë: xxx.xxx.xxx.xxx (m·ªói xxx t·ª´ 0-255). V√≠ d·ª•: 192.168.1.1.</p>
            <div class="analogy"><strong>V√≠ D·ª• ƒê·ªùi Th∆∞·ªùng:</strong> IP 192.168.1.1 gi·ªëng nh∆∞ "S·ªë 1, Ng√µ 1, Ph·ªë 168, Qu·∫≠n 192". Ph·∫ßn ƒë·∫ßu l√† khu v·ª±c l·ªõn, ph·∫ßn sau l√† nh√† c·ª• th·ªÉ.</div>
            <h3>S∆° ƒê·ªì Minh H·ªça: C·∫•u Tr√∫c IP Nh∆∞ M·ªôt Ng√¥i Nh√†</h3>
            <canvas id="ipHouseCanvas" width="600" height="300"></canvas>
            <div class="interactive">
                <h3>T∆∞∆°ng T√°c 1: Th·ª≠ Nh·∫≠p IP V√† Xem N√≥ Sang S·ªë Nh·ªã Ph√¢n (0 v√† 1)</h3>
                <p>M√°y t√≠nh hi·ªÉu IP b·∫±ng 32 con s·ªë 0 ho·∫∑c 1 (bit). H√£y th·ª≠ nh·∫≠p IP ƒë·ªÉ xem!</p>
                <input type="text" id="ipInputBinary" placeholder="Nh·∫≠p IP: 192.168.1.1" aria-label="IP to Binary Input" />
                <button onclick="convertToBinary()" aria-label="Convert IP to Binary">Chuy·ªÉn Sang Nh·ªã Ph√¢n</button>
                <div id="binaryResult" class="result-box"></div>
            </div>
        </div>
        <div class="section" id="step2">
            <h2>B∆∞·ªõc 2: Subnet Mask L√† G√¨? (Gi·ªëng Nh∆∞ Ranh Gi·ªõi Khu Ph·ªë)</h2>
            <p>N·∫øu th√†nh ph·ªë qu√° l·ªõn, ta chia th√†nh c√°c khu ph·ªë nh·ªè (subnet) ƒë·ªÉ d·ªÖ qu·∫£n l√Ω. Subnet Mask l√† "ranh gi·ªõi" n√≥i r·∫±ng ph·∫ßn n√†o l√† khu ph·ªë (network), ph·∫ßn n√†o l√† nh√† ri√™ng (host).</p>
            <p>V√≠ d·ª•: Subnet Mask 255.255.255.0 (ho·∫∑c /24) nghƒ©a l√† 24 bit ƒë·∫ßu l√† khu ph·ªë, 8 bit sau l√† nh√† (c√≥ th·ªÉ c√≥ 256 nh√†, nh∆∞ng tr·ª´ 2 n√™n 254 nh√† d√πng ƒë∆∞·ª£c).</p>
            <div class="analogy"><strong>V√≠ D·ª• ƒê·ªùi Th∆∞·ªùng:</strong> Subnet Mask nh∆∞ bi·ªÉn b√°o "Khu ph·ªë t·ª´ s·ªë 1 ƒë·∫øn 255". N·∫øu v∆∞·ª£t ra, th∆∞ s·∫Ω kh√¥ng ƒë·∫øn ƒë√∫ng khu.</div>
            <h3>S∆° ƒê·ªì Minh H·ªça: Chia Khu Ph·ªë V·ªõi Subnet</h3>
            <canvas id="subnetCityCanvas" width="600" height="400"></canvas>
            <div class="interactive">
                <h3>T∆∞∆°ng T√°c 2: K√©o Slider ƒê·ªÉ Thay ƒê·ªïi K√≠ch Th∆∞·ªõc Khu Ph·ªë</h3>
                <p>K√©o thanh tr∆∞·ª£t ƒë·ªÉ thay ƒë·ªïi /CIDR (s·ªë bit cho khu ph·ªë). Xem s·ªë nh√† (host) thay ƒë·ªïi th·∫ø n√†o!</p>
                <label for="cidrSlider">CIDR (/prefix): <span id="cidrValue">24</span></label>
                <input type="range" id="cidrSlider" min="0" max="32" value="24" oninput="updateCidr()" aria-label="CIDR Slider" />
                <div id="bitBar" class="bit-bar"></div>
                <p>M√†u xanh d∆∞∆°ng: Khu ph·ªë (Network). M√†u xanh l√°: Nh√† ri√™ng (Host).</p>
                <p>S·ªë nh√† kh·∫£ d·ª•ng trong khu: <span id="hostCount">254</span> (c√†ng nhi·ªÅu bit khu ph·ªë, khu nh·ªè h∆°n, √≠t nh√† h∆°n).</p>
            </div>
        </div>
        <div class="section" id="step3">
            <h2>B∆∞·ªõc 3: T√≠nh To√°n Subnet (Xem Khu Ph·ªë C·ª• Th·ªÉ)</h2>
            <p>B√¢y gi·ªù, v·ªõi IP v√† Subnet, ta t√≠nh ƒë∆∞·ª£c: ƒê·ªãa ch·ªâ khu ph·ªë ƒë·∫ßu (Network), ƒë·ªãa ch·ªâ cu·ªëi (Broadcast - g·ª≠i cho t·∫•t c·∫£), v√† d·∫£i nh√† d√πng ƒë∆∞·ª£c.</p>
            <div class="analogy"><strong>V√≠ D·ª• ƒê·ªùi Th∆∞·ªùng:</strong> V·ªõi ƒë·ªãa ch·ªâ "S·ªë 10, Ng√µ 1, Ph·ªë 168, Qu·∫≠n 192" v√† ranh gi·ªõi /24, khu ph·ªë l√† t·ª´ s·ªë 1 ƒë·∫øn 255 ·ªü Ng√µ 1, Ph·ªë 168, Qu·∫≠n 192.</div>
            <h3>S∆° ƒê·ªì Minh H·ªça: D·∫£i ƒê·ªãa Ch·ªâ Trong Khu Ph·ªë</h3>
            <canvas id="addressRangeCanvas" width="600" height="200"></canvas>
            <div class="interactive">
                <h3>T∆∞∆°ng T√°c 3: Nh·∫≠p IP V√† CIDR ƒê·ªÉ T√≠nh To√°n</h3>
                <input type="text" id="ipInputSubnet" placeholder="IP: 192.168.1.10" aria-label="IP for Subnet Calculation" />
                <input type="text" id="cidrInputSubnet" placeholder="CIDR: /24" aria-label="CIDR for Subnet Calculation" />
                <button onclick="calculateSubnet()" aria-label="Calculate Subnet">T√≠nh V√† Minh H·ªça</button>
                <div id="subnetResult" class="result-box"></div>
            </div>
            <div class="interactive">
                <h3>T∆∞∆°ng T√°c 4: Ki·ªÉm Tra IP C√≥ Thu·ªôc Khu Ph·ªë Kh√¥ng?</h3>
                <p>Nh·∫≠p Network (v√≠ d·ª• 192.168.1.0/24) v√† m·ªôt IP ƒë·ªÉ ki·ªÉm tra.</p>
                <input type="text" id="networkInput" placeholder="Network: 192.168.1.0/24" aria-label="Network address to check against" />
                <input type="text" id="checkIpInput" placeholder="IP c·∫ßn ki·ªÉm tra: 192.168.1.50" aria-label="IP to check" />
                <button onclick="checkIpInSubnet()" aria-label="Check if IP is in Subnet">Ki·ªÉm Tra</button>
                <div id="checkResult" class="result-box"></div>
            </div>
        </div>
        <div class="section" id="step4">
            <h2>B∆∞·ªõc 4: Quiz ƒê·ªÉ Ki·ªÉm Tra V√† H·ªçc Th√™m</h2>
            <p>Th·ª≠ quiz n√†y ƒë·ªÉ xem b·∫°n hi·ªÉu ƒë·∫øn ƒë√¢u. C√≥ g·ª£i √Ω n·∫øu sai!</p>
            <div class="interactive">
                <p>C√¢u 1: IP IPv4 c√≥ bao nhi√™u bit?</p>
                <select id="quiz1" aria-label="Quiz question 1"><option value="">Ch·ªçn...</option><option value="32">32 bit (4 nh√≥m 8 bit)</option><option value="64">64 bit</option><option value="16">16 bit</option></select>
                <p>C√¢u 2: Subnet /24 c√≥ bao nhi√™u bit cho khu ph·ªë (network)?</p>
                <select id="quiz2" aria-label="Quiz question 2"><option value="">Ch·ªçn...</option><option value="24">24 bit</option><option value="8">8 bit</option><option value="32">32 bit</option></select>
                <p>C√¢u 3: V·ªõi /24, s·ªë nh√† (host) kh·∫£ d·ª•ng l√† bao nhi√™u?</p>
                <select id="quiz3" aria-label="Quiz question 3"><option value="">Ch·ªçn...</option><option value="254">254 (2^8 - 2)</option><option value="256">256</option><option value="128">128</option></select>
                <button onclick="checkQuiz()" aria-label="Check Basic Quiz Answers">Ki·ªÉm Tra ƒê√°p √Ån</button>
                <div id="quizResult" class="result-box"></div>
            </div>
        </div>
        <div class="section" id="step5">
            <h2>B∆∞·ªõc 5: M√¥ Ph·ªèng M·∫°ng ƒê∆°n Gi·∫£n</h2>
            <p>Xem m·ªôt m·∫°ng v·ªõi router v√† c√°c m√°y t√≠nh k·∫øt n·ªëi, m·ªói c√°i c√≥ IP trong subnet.</p>
            <canvas id="networkSimulationCanvas" width="800" height="400"></canvas>
        </div>
        <div class="section" id="step6">
            <h2>B∆∞·ªõc 6: Subnetting N√¢ng Cao - Chia M·∫°ng Con</h2>
            <p>B√¢y gi·ªù, ch√∫ng ta h·ªçc c√°ch chia m·ªôt m·∫°ng l·ªõn th√†nh nhi·ªÅu m·∫°ng con nh·ªè h∆°n. V√≠ d·ª•, t·ª´ m·ªôt m·∫°ng /24 (256 ƒë·ªãa ch·ªâ), chia th√†nh 4 m·∫°ng con /26 (m·ªói c√°i 64 ƒë·ªãa ch·ªâ).</p>
            <div class="analogy"><strong>V√≠ D·ª• ƒê·ªùi Th∆∞·ªùng:</strong> B·∫°n c√≥ m·ªôt khu ƒë·∫•t l·ªõn, chia th√†nh 4 khu nh·ªè ƒë·ªÉ b√°n. M·ªói khu nh·ªè c√≥ ranh gi·ªõi ri√™ng.</div>
            <h3>S∆° ƒê·ªì Minh H·ªça: Chia M·∫°ng Th√†nh C√°c Subnet</h3>
            <canvas id="subnettingCanvas" width="600" height="400"></canvas>
            <div class="interactive">
                <h3>T∆∞∆°ng T√°c 5: Chia Subnet</h3>
                <p>Nh·∫≠p network g·ªëc v√† s·ªë subnet c·∫ßn chia.</p>
                <input type="text" id="baseNetwork" placeholder="Network g·ªëc: 192.168.1.0/24" aria-label="Base network for subnetting"/>
                <input type="number" id="numSubnets" placeholder="S·ªë subnet: 4" min="2" max="128" aria-label="Number of subnets to create"/>
                <button onclick="calculateSubnets()" aria-label="Calculate Subnets">Chia Subnet</button>
                <div id="subnettingResult" class="result-box"></div>
            </div>
        </div>
        <div class="section" id="step7">
            <h2>B∆∞·ªõc 7: IP Public V√† Private - Internet Th·ª±c T·∫ø</h2>
            <p>IP Private (nh∆∞ 192.168.x.x) d√πng trong nh√†/m·∫°ng n·ªôi b·ªô, kh√¥ng ra internet. IP Public l√† ƒë·ªãa ch·ªâ th·∫≠t tr√™n internet, do ISP cung c·∫•p.</p>
            <div class="analogy"><strong>V√≠ D·ª• ƒê·ªùi Th∆∞·ªùng:</strong> IP Private nh∆∞ s·ªë ph√≤ng trong nh√† b·∫°n. IP Public nh∆∞ ƒë·ªãa ch·ªâ nh√† ngo√†i ƒë∆∞·ªùng l·ªõn.</div>
            <h3>S∆° ƒê·ªì Minh H·ªça: M·∫°ng N·ªôi B·ªô V√† Internet</h3>
            <canvas id="publicPrivateCanvas" width="600" height="300"></canvas>
            <div class="interactive">
                <h3>T∆∞∆°ng T√°c 6: Ki·ªÉm Tra IP L√† Public Hay Private</h3>
                <input type="text" id="ipTypeInput" placeholder="Nh·∫≠p IP: 192.168.1.1" aria-label="IP to check type" />
                <button onclick="checkIpType()" aria-label="Check IP Type">Ki·ªÉm Tra</button>
                <div id="ipTypeResult" class="result-box"></div>
            </div>
        </div>
        <div class="section" id="step8">
            <h2>B∆∞·ªõc 8: Quiz N√¢ng Cao</h2>
            <p>Th·ª≠ quiz ƒë·ªÉ ki·ªÉm tra ki·∫øn th·ª©c n√¢ng cao!</p>
            <div class="interactive">
                <p>C√¢u 1: V·ªõi /27, s·ªë host kh·∫£ d·ª•ng l√† bao nhi√™u?</p>
                <select id="quiz4" aria-label="Advanced quiz question 1"><option value="">Ch·ªçn...</option><option value="30">30 (2^5 - 2)</option><option value="32">32</option><option value="62">62</option></select>
                <p>C√¢u 2: IP 10.0.0.1 l√† lo·∫°i g√¨?</p>
                <select id="quiz5" aria-label="Advanced quiz question 2"><option value="">Ch·ªçn...</option><option value="private">Private</option><option value="public">Public</option></select>
                <button onclick="checkAdvancedQuiz()" aria-label="Check Advanced Quiz Answers">Ki·ªÉm Tra</button>
                <div id="advancedQuizResult" class="result-box"></div>
            </div>
        </div>
        <div class="section" id="step9">
            <h2>B∆∞·ªõc 9: VLSM - Variable Length Subnet Mask (Subnet Linh Ho·∫°t)</h2>
            <p>VLSM cho ph√©p chia subnet v·ªõi k√≠ch th∆∞·ªõc kh√°c nhau, ti·∫øt ki·ªám ƒë·ªãa ch·ªâ IP. Thay v√¨ chia ƒë·ªÅu, b·∫°n c√≥ th·ªÉ c√≥ subnet l·ªõn nh·ªè t√πy nhu c·∫ßu.</p>
            <div class="analogy"><strong>V√≠ D·ª• ƒê·ªùi Th∆∞·ªùng:</strong> Chia khu ƒë·∫•t th√†nh c√°c ph·∫ßn: m·ªôt ph·∫ßn l·ªõn cho c√¥ng vi√™n, ph·∫ßn nh·ªè cho nh√† ·ªü, t√πy theo nhu c·∫ßu.</div>
            <h3>S∆° ƒê·ªì Minh H·ªça: VLSM V·ªõi C√°c Subnet K√≠ch Th∆∞·ªõc Kh√°c Nhau</h3>
            <canvas id="vlsmCanvas" width="600" height="400"></canvas>
            <div class="interactive">
                <h3>T∆∞∆°ng T√°c 7: T√≠nh VLSM</h3>
                <p>Nh·∫≠p network g·ªëc v√† c√°c k√≠ch th∆∞·ªõc host c·∫ßn (c√°ch nhau b·ªüi d·∫•u ph·∫©y, v√≠ d·ª•: 100,50,20).</p>
                <input type="text" id="vlsmNetwork" placeholder="Network g·ªëc: 192.168.0.0/16" aria-label="Base network for VLSM"/>
                <input type="text" id="vlsmHosts" placeholder="Host c·∫ßn: 100,50,20" aria-label="Required host counts for VLSM"/>
                <button onclick="calculateVLSM()" aria-label="Calculate VLSM">T√≠nh VLSM</button>
                <div id="vlsmResult" class="result-box"></div>
            </div>
        </div>
        <div class="section" id="step10">
            <h2>B∆∞·ªõc 10: IPv6 - Th·∫ø H·ªá IP M·ªõi</h2>
            <p>IPv4 s·∫Øp h·∫øt ƒë·ªãa ch·ªâ, IPv6 d√πng 128 bit, d·∫°ng hex (v√≠ d·ª•: 2001:0db8:85a3:0000:0000:8a2e:0370:7334). N√≥ gi·∫£i quy·∫øt thi·∫øu h·ª•t ƒë·ªãa ch·ªâ.</p>
            <div class="analogy"><strong>V√≠ D·ª• ƒê·ªùi Th∆∞·ªùng:</strong> IPv4 nh∆∞ s·ªë ƒëi·ªán tho·∫°i 10 ch·ªØ s·ªë s·∫Øp h·∫øt, IPv6 nh∆∞ s·ªë d√†i h∆°n ƒë·ªÉ c√≥ nhi·ªÅu h∆°n.</div>
            <h3>S∆° ƒê·ªì Minh H·ªça: So S√°nh IPv4 V√† IPv6</h3>
            <canvas id="ipv6Canvas" width="600" height="300"></canvas>
            <div class="interactive">
                <h3>T∆∞∆°ng T√°c 8: Chuy·ªÉn IPv4 Sang IPv6 (Mapped)</h3>
                <input type="text" id="ipv4ToIpv6" placeholder="Nh·∫≠p IPv4: 192.168.1.1" aria-label="IPv4 to map to IPv6"/>
                <button onclick="mapIpv4ToIpv6()" aria-label="Map IPv4 to IPv6">Chuy·ªÉn Sang IPv6</button>
                <div id="ipv6Result" class="result-box"></div>
            </div>
        </div>
        <div class="section" id="step11">
            <h2>B∆∞·ªõc 11: NAT - Network Address Translation</h2>
            <p>NAT cho ph√©p nhi·ªÅu thi·∫øt b·ªã d√πng IP private chia s·∫ª m·ªôt IP public ƒë·ªÉ ra internet.</p>
            <div class="analogy"><strong>V√≠ D·ª• ƒê·ªùi Th∆∞·ªùng:</strong> Nh∆∞ m·ªôt ng∆∞·ªùi ƒë·∫°i di·ªán (router) nh·∫≠n th∆∞ t·ª´ b√™n ngo√†i v√† ph√¢n ph√°t cho c√°c ph√≤ng trong nh√†.</div>
            <h3>S∆° ƒê·ªì Minh H·ªça: NAT Trong M·∫°ng Gia ƒê√¨nh</h3>
            <canvas id="natCanvas" width="600" height="400"></canvas>
        </div>
        <div class="section" id="step12">
            <h2>B∆∞·ªõc 12: DHCP - Dynamic Host Configuration Protocol (G√°n IP T·ª± ƒê·ªông)</h2>
            <p>DHCP t·ª± ƒë·ªông g√°n IP, subnet mask, gateway cho thi·∫øt b·ªã khi k·∫øt n·ªëi m·∫°ng, thay v√¨ g√°n th·ªß c√¥ng.</p>
            <div class="analogy"><strong>V√≠ D·ª• ƒê·ªùi Th∆∞·ªùng:</strong> Nh∆∞ qu·∫ßy l·ªÖ t√¢n kh√°ch s·∫°n t·ª± ƒë·ªông g√°n ph√≤ng khi b·∫°n check-in, thay v√¨ ch·ªçn ph√≤ng th·ªß c√¥ng.</div>
            <h3>S∆° ƒê·ªì Minh H·ªça: Qu√° Tr√¨nh DHCP</h3>
            <canvas id="dhcpCanvas" width="600" height="300"></canvas>
            <div class="interactive">
                <h3>T∆∞∆°ng T√°c 9: M√¥ Ph·ªèng Y√™u C·∫ßu IP T·ª´ DHCP</h3>
                <p>Nh·∫≠p "MAC Address" (gi·∫£, b·∫•t k·ª≥) v√† nh·∫•n ƒë·ªÉ nh·∫≠n IP t·ª± ƒë·ªông t·ª´ pool 192.168.1.0/24.</p>
                <input type="text" id="macInput" placeholder="MAC: 00:11:22:33:44:55" aria-label="Simulated MAC Address"/>
                <button onclick="requestDhcpIp()" aria-label="Request DHCP IP">Y√™u C·∫ßu IP</button>
                <div id="dhcpResult" class="result-box"></div>
            </div>
        </div>
        <div class="section" id="step13">
            <h2>B∆∞·ªõc 13: DNS - Domain Name System (Chuy·ªÉn T√™n Mi·ªÅn Sang IP)</h2>
            <p>DNS nh∆∞ s·ªï danh b·∫°, chuy·ªÉn t√™n mi·ªÅn (v√≠ d·ª• google.com) th√†nh IP ƒë·ªÉ m√°y t√≠nh k·∫øt n·ªëi.</p>
            <div class="analogy"><strong>V√≠ D·ª• ƒê·ªùi Th∆∞·ªùng:</strong> G·ªçi t√™n b·∫°n b√® thay v√¨ s·ªë ƒëi·ªán tho·∫°i, DNS t√¨m s·ªë cho b·∫°n.</div>
            <h3>S∆° ƒê·ªì Minh H·ªça: Qu√° Tr√¨nh Resolve DNS</h3>
            <canvas id="dnsCanvas" width="600" height="300"></canvas>
            <div class="interactive">
                <h3>T∆∞∆°ng T√°c 10: M√¥ Ph·ªèng Resolve T√™n Mi·ªÅn</h3>
                <p>Nh·∫≠p t√™n mi·ªÅn (gi·∫£), nh·∫≠n IP ng·∫´u nhi√™n.</p>
                <input type="text" id="domainInput" placeholder="T√™n mi·ªÅn: example.com" aria-label="Domain name to resolve"/>
                <button onclick="resolveDns()" aria-label="Resolve Domain">Resolve</button>
                <div id="dnsResult" class="result-box"></div>
            </div>
        </div>
        <div class="section" id="step14">
            <h2>B∆∞·ªõc 14: Routing C∆° B·∫£n (ƒê·ªãnh Tuy·∫øn D·ªØ Li·ªáu)</h2>
            <p>Routing l√† c√°ch d·ªØ li·ªáu ƒëi t·ª´ m·∫°ng n√†y sang m·∫°ng kh√°c, qua router d·ª±a tr√™n b·∫£ng ƒë·ªãnh tuy·∫øn.</p>
            <div class="analogy"><strong>V√≠ D·ª• ƒê·ªùi Th∆∞·ªùng:</strong> Nh∆∞ b·∫£n ƒë·ªì GPS h∆∞·ªõng d·∫´n ƒë∆∞·ªùng ƒëi t·ª´ nh√† b·∫°n ƒë·∫øn nh√† b·∫°n b√®, qua c√°c ng√£ r·∫Ω (router).</div>
            <h3>S∆° ƒê·ªì Minh H·ªça: ƒê·ªãnh Tuy·∫øn Gi·ªØa C√°c M·∫°ng</h3>
            <canvas id="routingCanvas" width="600" height="400"></canvas>
            <div class="interactive">
                <h3>T∆∞∆°ng T√°c 11: Ki·ªÉm Tra N·∫øu C·∫ßn Router</h3>
                <p>Nh·∫≠p IP ngu·ªìn, IP ƒë√≠ch, subnet mask ƒë·ªÉ xem n·∫øu c√πng m·∫°ng hay c·∫ßn router.</p>
                <input type="text" id="sourceIp" placeholder="IP ngu·ªìn: 192.168.1.10" aria-label="Source IP for routing check"/>
                <input type="text" id="destIp" placeholder="IP ƒë√≠ch: 192.168.2.20" aria-label="Destination IP for routing check"/>
                <input type="text" id="maskInput" placeholder="Subnet Mask: 255.255.255.0" aria-label="Subnet Mask for routing check"/>
                <button onclick="checkRouting()" aria-label="Check Routing">Ki·ªÉm Tra</button>
                <div id="routingResult" class="result-box"></div>
            </div>
        </div>
        <div class="section" id="step15">
            <h2>B∆∞·ªõc 15: Firewall V√† B·∫£o M·∫≠t M·∫°ng</h2>
            <p>Firewall nh∆∞ t∆∞·ªùng l·ª≠a, ki·ªÉm so√°t l∆∞u l∆∞·ª£ng d·ªØ li·ªáu v√†o/ra m·∫°ng, ch·∫∑n c√°c k·∫øt n·ªëi nguy hi·ªÉm d·ª±a tr√™n quy t·∫Øc (IP, port).</p>
            <div class="analogy"><strong>V√≠ D·ª• ƒê·ªùi Th∆∞·ªùng:</strong> Nh∆∞ b·∫£o v·ªá c·ª≠a nh√†, ch·ªâ cho ng∆∞·ªùi quen v√†o, ch·∫∑n k·∫ª l·∫°.</div>
            <h3>S∆° ƒê·ªì Minh H·ªça ƒê·ªông: M√¥ Ph·ªèng Firewall Ch·∫∑n K·∫øt N·ªëi</h3>
            <canvas id="firewallCanvas" width="600" height="400"></canvas>
            <button onclick="animateFirewall()" aria-label="Run Firewall Animation">Ch·∫°y Minh H·ªça ƒê·ªông</button>
            <div class="interactive">
                <h3>T∆∞∆°ng T√°c 12: Thi·∫øt L·∫≠p Quy T·∫Øc Firewall</h3>
                <p>Nh·∫≠p IP ngu·ªìn v√† port, xem firewall cho ph√©p hay ch·∫∑n (quy t·∫Øc gi·∫£: ch·∫∑n IP b·∫Øt ƒë·∫ßu b·∫±ng 10., port 80).</p>
                <input type="text" id="fwIp" placeholder="IP ngu·ªìn: 10.0.0.1" aria-label="Source IP for firewall check" />
                <input type="number" id="fwPort" placeholder="Port: 80" aria-label="Port for firewall check"/>
                <button onclick="checkFirewall()" aria-label="Check Firewall Rule">Ki·ªÉm Tra</button>
                <div id="fwResult" class="result-box"></div>
            </div>
        </div>
        <div class="section" id="step16">
            <h2>B∆∞·ªõc 16: VPN - Virtual Private Network (M·∫°ng Ri√™ng ·∫¢o)</h2>
            <p>VPN t·∫°o ƒë∆∞·ªùng h·∫ßm an to√†n qua internet, m√£ h√≥a d·ªØ li·ªáu, cho ph√©p truy c·∫≠p m·∫°ng t·ª´ xa nh∆∞ ƒëang ·ªü vƒÉn ph√≤ng.</p>
            <div class="analogy"><strong>V√≠ D·ª• ƒê·ªùi Th∆∞·ªùng:</strong> Nh∆∞ ƒë∆∞·ªùng h·∫ßm b√≠ m·∫≠t k·∫øt n·ªëi nh√† b·∫°n v·ªõi c√¥ng ty, an to√†n kh·ªèi k·∫ª x·∫•u ngo√†i ƒë∆∞·ªùng.</div>
            <h3>S∆° ƒê·ªì Minh H·ªça ƒê·ªông: K·∫øt N·ªëi VPN</h3>
            <canvas id="vpnCanvas" width="600" height="300"></canvas>
            <button onclick="animateVpn()" aria-label="Run VPN Animation">Ch·∫°y Minh H·ªça ƒê·ªông</button>
            <div class="interactive">
                <h3>T∆∞∆°ng T√°c 13: M√¥ Ph·ªèng K·∫øt N·ªëi VPN</h3>
                <p>Nh·∫≠p "Server VPN" v√† "User IP", nh·∫•n ƒë·ªÉ "k·∫øt n·ªëi" v√† xem ƒë·ªãa ch·ªâ thay ƒë·ªïi (gi·∫£).</p>
                <input type="text" id="vpnServer" placeholder="Server VPN: vpn.example.com" aria-label="VPN Server Address"/>
                <input type="text" id="userIp" placeholder="User IP: 192.168.1.10" aria-label="User IP for VPN"/>
                <button onclick="connectVpn()" aria-label="Connect VPN">K·∫øt N·ªëi VPN</button>
                <div id="vpnResult" class="result-box"></div>
            </div>
        </div>
        <div class="section" id="step17">
            <h2>B∆∞·ªõc 17: Wi-Fi V√† M·∫°ng Kh√¥ng D√¢y</h2>
            <p>Wi-Fi d√πng s√≥ng radio ƒë·ªÉ k·∫øt n·ªëi thi·∫øt b·ªã kh√¥ng d√¢y, v·ªõi SSID (t√™n m·∫°ng) v√† m·∫≠t kh·∫©u ƒë·ªÉ b·∫£o m·∫≠t.</p>
            <div class="analogy"><strong>V√≠ D·ª• ƒê·ªùi Th∆∞·ªùng:</strong> Nh∆∞ radio FM, b·∫°n ch·ªçn k√™nh (SSID) v√† m·∫≠t kh·∫©u ƒë·ªÉ nghe ri√™ng.</div>
            <h3>S∆° ƒê·ªì Minh H·ªça ƒê·ªông: K·∫øt N·ªëi Wi-Fi</h3>
            <canvas id="wifiCanvas" width="600" height="400"></canvas>
            <button onclick="animateWifi()" aria-label="Run Wi-Fi Animation">Ch·∫°y Minh H·ªça ƒê·ªông</button>
            <div class="interactive">
                <h3>T∆∞∆°ng T√°c 14: M√¥ Ph·ªèng K·∫øt N·ªëi Wi-Fi</h3>
                <p>Nh·∫≠p SSID v√† m·∫≠t kh·∫©u (gi·∫£: SSID 'MyWiFi', m·∫≠t kh·∫©u '123456'), nh·∫•n ƒë·ªÉ k·∫øt n·ªëi.</p>
                <input type="text" id="ssidInput" placeholder="SSID: MyWiFi" aria-label="Wi-Fi SSID"/>
                <input type="password" id="wifiPass" placeholder="M·∫≠t kh·∫©u: 123456" aria-label="Wi-Fi Password"/>
                <button onclick="connectWifi()" aria-label="Connect to Wi-Fi">K·∫øt N·ªëi</button>
                <div id="wifiResult" class="result-box"></div>
            </div>
        </div>
        <div class="section" id="step18">
            <h2>B∆∞·ªõc 18: Quiz Cu·ªëi C√πng</h2>
            <p>Th·ª≠ quiz ƒë·ªÉ √¥n l·∫°i to√†n b·ªô ki·∫øn th·ª©c!</p>
            <div class="interactive">
                <p>C√¢u 1: Firewall l√†m g√¨?</p>
                <select id="quiz6" aria-label="Final quiz question 1"><option value="">Ch·ªçn...</option><option value="ch·∫∑n">Ch·∫∑n l∆∞u l∆∞·ª£ng nguy hi·ªÉm</option><option value="g√°n ip">G√°n IP t·ª± ƒë·ªông</option><option value="resolve">Resolve t√™n mi·ªÅn</option></select>
                <p>C√¢u 2: VPN d√πng ƒë·ªÉ?</p>
                <select id="quiz7" aria-label="Final quiz question 2"><option value="">Ch·ªçn...</option><option value="m√£ h√≥a">M√£ h√≥a k·∫øt n·ªëi an to√†n</option><option value="chia subnet">Chia subnet</option><option value="k·∫øt n·ªëi kh√¥ng d√¢y">K·∫øt n·ªëi kh√¥ng d√¢y</option></select>
                <p>C√¢u 3: Wi-Fi c·∫ßn g√¨ ƒë·ªÉ k·∫øt n·ªëi an to√†n?</p>
                <select id="quiz8" aria-label="Final quiz question 3"><option value="">Ch·ªçn...</option><option value="ssid pass">SSID v√† m·∫≠t kh·∫©u</option><option value="ip public">IP public</option><option value="cidr">CIDR</option></select>
                <button onclick="checkFinalQuiz()" aria-label="Check Final Quiz Answers">Ki·ªÉm Tra</button>
                <div id="finalQuizResult" class="result-box"></div>
            </div>
        </div>
        <div class="section" id="step19">
            <h2>B∆∞·ªõc 19: Port V√† Socket (C·ª≠a V√†o Ra D·ªØ Li·ªáu)</h2>
            <p>Port nh∆∞ s·ªë ph√≤ng trong t√≤a nh√† (IP l√† ƒë·ªãa ch·ªâ t√≤a nh√†). Socket l√† k·∫øt h·ª£p IP + Port, gi√∫p d·ªØ li·ªáu ƒë·∫øn ƒë√∫ng ·ª©ng d·ª•ng (web port 80, email port 25).</p>
            <div class="analogy"><strong>V√≠ D·ª• ƒê·ªùi Th∆∞·ªùng:</strong> IP l√† ƒë·ªãa ch·ªâ nh√†, port l√† s·ªë ph√≤ng, socket l√† "nh√† + ph√≤ng" ƒë·ªÉ g·ª≠i th∆∞ ƒë√∫ng ng∆∞·ªùi.</div>
            <h3>S∆° ƒê·ªì Minh H·ªça ƒê·ªông: D·ªØ Li·ªáu ƒêi Qua Port</h3>
            <canvas id="portCanvas" width="600" height="300"></canvas>
            <button onclick="animatePort()" aria-label="Run Port Animation">Ch·∫°y Minh H·ªça ƒê·ªông</button>
            <div class="interactive">
                <h3>T∆∞∆°ng T√°c 15: Ki·ªÉm Tra D·ªãch V·ª• Port</h3>
                <p>Nh·∫≠p s·ªë port (0-65535), xem d·ªãch v·ª• ph·ªï bi·∫øn (gi·∫£).</p>
                <input type="number" id="portInput" placeholder="Port: 80" min="0" max="65535" aria-label="Port number to check"/>
                <button onclick="checkPort()" aria-label="Check Port Service">Ki·ªÉm Tra</button>
                <div id="portResult" class="result-box"></div>
            </div>
        </div>
        <div class="section" id="step20">
            <h2>B∆∞·ªõc 20: TCP vs UDP - Giao Th·ª©c Truy·ªÅn D·ªØ Li·ªáu</h2>
            <p>TCP an to√†n, ƒë√°ng tin c·∫≠y (nh∆∞ g·ªçi ƒëi·ªán x√°c nh·∫≠n), UDP nhanh, kh√¥ng x√°c nh·∫≠n (nh∆∞ g·ª≠i th∆∞ th∆∞·ªùng, d√πng cho video/game).</p>
            <div class="analogy"><strong>V√≠ D·ª• ƒê·ªùi Th∆∞·ªùng:</strong> TCP nh∆∞ chuy·ªÉn ph√°t nhanh c√≥ bi√™n nh·∫≠n, UDP nh∆∞ ph√°t t·ªù r∆°i nhanh nh∆∞ng c√≥ th·ªÉ m·∫•t.</div>
            <h3>S∆° ƒê·ªì Minh H·ªça ƒê·ªông: So S√°nh TCP/UDP</h3>
            <canvas id="tcpUdpCanvas" width="600" height="400"></canvas>
            <button onclick="animateTcpUdp()" aria-label="Run TCP vs UDP Animation">Ch·∫°y Minh H·ªça ƒê·ªông</button>
            <div class="interactive">
                <h3>T∆∞∆°ng T√°c 16: Ch·ªçn Giao Th·ª©c Cho ·ª®ng D·ª•ng</h3>
                <p>Nh·∫≠p ·ª©ng d·ª•ng (web, video, email), xem n√™n d√πng TCP hay UDP.</p>
                <input type="text" id="appInput" placeholder="·ª®ng d·ª•ng: web" aria-label="Application type to suggest protocol"/>
                <button onclick="suggestProtocol()" aria-label="Suggest Protocol">G·ª£i √ù</button>
                <div id="protocolResult" class="result-box"></div>
            </div>
        </div>
        <div class="section" id="step21">
            <h2>B∆∞·ªõc 21: M√¥ H√¨nh OSI - C√°c T·∫ßng M·∫°ng</h2>
            <p>OSI c√≥ 7 t·∫ßng, t·ª´ Physical (c√°p) ƒë·∫øn Application (app). Gi√∫p hi·ªÉu d·ªØ li·ªáu ƒëi t·ª´ t·∫ßng n√†y sang t·∫ßng kh√°c.</p>
            <div class="analogy"><strong>V√≠ D·ª• ƒê·ªùi Th∆∞·ªùng:</strong> Nh∆∞ g·ª≠i th∆∞: vi·∫øt th∆∞ (Application), ƒë√≥ng g√≥i (Presentation), ƒë·ªãa ch·ªâ (Session), v·∫≠n chuy·ªÉn (Transport), ƒë∆∞·ªùng ƒëi (Network), xe ch·ªü (Data Link), ƒë∆∞·ªùng ph·ªë (Physical).</div>
            <h3>S∆° ƒê·ªì Minh H·ªça ƒê·ªông: C√°c T·∫ßng OSI</h3>
            <canvas id="osiCanvas" width="600" height="500"></canvas>
            <button onclick="animateOsi()" aria-label="Run OSI Model Animation">Ch·∫°y Minh H·ªça ƒê·ªông</button>
            <div class="interactive">
                <h3>T∆∞∆°ng T√°c 17: Kh√°m Ph√° T·∫ßng OSI</h3>
                <p>Ch·ªçn t·∫ßng (1-7), xem m√¥ t·∫£ v√† v√≠ d·ª•.</p>
                <select id="osiLayer" aria-label="OSI Layer selector"><option value="">Ch·ªçn t·∫ßng...</option><option value="1">1: Physical</option><option value="2">2: Data Link</option><option value="3">3: Network</option><option value="4">4: Transport</option><option value="5">5: Session</option><option value="6">6: Presentation</option><option value="7">7: Application</option></select>
                <button onclick="describeOsiLayer()" aria-label="Describe OSI Layer">M√¥ T·∫£</button>
                <div id="osiResult" class="result-box"></div>
            </div>
        </div>
        <div class="section" id="step22">
            <h2>B∆∞·ªõc 22: Quiz T·ªïng H·ª£p</h2>
            <p>Th·ª≠ quiz ƒë·ªÉ ki·ªÉm tra ki·∫øn th·ª©c t·ª´ b∆∞·ªõc 15-21!</p>
            <div class="interactive">
                <p>C√¢u 1: Port 80 d√πng cho g√¨?</p>
                <select id="quiz9" aria-label="Comprehensive quiz question 1"><option value="">Ch·ªçn...</option><option value="http">HTTP (Web)</option><option value="email">Email</option><option value="ftp">FTP</option></select>
                <p>C√¢u 2: TCP hay UDP cho video streaming?</p>
                <select id="quiz10" aria-label="Comprehensive quiz question 2"><option value="">Ch·ªçn...</option><option value="udp">UDP (Nhanh)</option><option value="tcp">TCP (An to√†n)</option></select>
                <p>C√¢u 3: T·∫ßng 3 OSI l√† g√¨?</p>
                <select id="quiz11" aria-label="Comprehensive quiz question 3"><option value="">Ch·ªçn...</option><option value="network">Network (IP)</option><option value="physical">Physical</option><option value="application">Application</option></select>
                <button onclick="checkTotalQuiz()" aria-label="Check Comprehensive Quiz Answers">Ki·ªÉm Tra</button>
                <div id="totalQuizResult" class="result-box"></div>
            </div>
        </div>
    </div>

    <!-- Modal for Quiz Results -->
    <div id="quizModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeModalButton" aria-label="Close">&times;</span>
            <div id="modal-body"></div>
        </div>
    </div>
    
<script>
// --- NEW UI/UX AND INTERACTIVITY SCRIPT ---

// --- Core UI Elements ---
const progressBar = document.getElementById('progressBar');
const sidebar = document.getElementById('sidebar');
const sections = document.querySelectorAll('.section');
const sidebarLinks = document.querySelectorAll('.sidebar a');
const themeToggle = document.getElementById('theme-toggle');
const quizModal = document.getElementById('quizModal');
const closeModalButton = document.getElementById('closeModalButton');
const modalBody = document.getElementById('modal-body');

// --- Progress Bar & Sidebar Active State ---
function updateScrollProgress() {
    const scrollTop = document.documentElement.scrollTop;
    const scrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
    const scrollProgress = (scrollTop / scrollHeight) * 100;
    progressBar.style.width = scrollProgress + '%';

    // Highlight active sidebar link
    let currentSection = '';
    sections.forEach(section => {
        const sectionTop = section.offsetTop;
        if (scrollTop >= sectionTop - 100) {
            currentSection = section.getAttribute('id');
        }
    });
    
    sidebarLinks.forEach(link => {
        link.classList.remove('active');
        if(link.getAttribute('href') === `#${currentSection}`) {
            link.classList.add('active');
        }
    });
}

// --- Theme Management ---
function applyTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
    themeToggle.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
    localStorage.setItem('theme', theme);
}

function toggleTheme() {
    const currentTheme = localStorage.getItem('theme') || 'light';
    const newTheme = currentTheme === 'light' ? 'dark' : 'light';
    applyTheme(newTheme);
}

// --- Modal ---
function showModal(content) {
    modalBody.innerHTML = content;
    quizModal.style.display = 'flex';
}

function closeModal() {
    quizModal.style.display = 'none';
}

// --- Progress Saving ---
function saveProgress(sectionId) {
    let completedSections = JSON.parse(localStorage.getItem('completedSections')) || [];
    if (!completedSections.includes(sectionId)) {
        completedSections.push(sectionId);
        localStorage.setItem('completedSections', JSON.stringify(completedSections));
        updateProgressUI();
    }
}

function updateProgressUI() {
    let completedSections = JSON.parse(localStorage.getItem('completedSections')) || [];
    completedSections.forEach(sectionId => {
        document.getElementById(sectionId)?.classList.add('done');
        document.getElementById(`nav-${sectionId}`)?.classList.add('done');
    });
}


// --- Event Listeners ---
window.addEventListener('scroll', updateScrollProgress);
themeToggle.addEventListener('click', toggleTheme);
closeModalButton.addEventListener('click', closeModal);
window.addEventListener('click', (event) => {
    if (event.target === quizModal) {
        closeModal();
    }
});


// --- OLD SCRIPT (MODIFIED FOR MODAL AND PROGRESS) ---

// Helper function to convert number to IP string
function numToIp(num) {
    return [(num >>> 24) & 255, (num >>> 16) & 255, (num >>> 8) & 255, num & 255].join('.');
}

// V·∫Ω IP nh∆∞ nh√†
function drawIpHouse() {
    const canvas = document.getElementById('ipHouseCanvas');
    if (!canvas?.getContext) return;
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#f8f9fa';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    // V·∫Ω th√†nh ph·ªë
    ctx.fillStyle = '#ffc107';
    ctx.fillRect(50, 150, 500, 100);
    ctx.fillStyle = '#343a40';
    ctx.font = '20px Arial';
    ctx.fillText('Th√†nh Ph·ªë Internet', 200, 180);
    // V·∫Ω nh√†
    ctx.fillStyle = '#28a745';
    ctx.beginPath();
    ctx.moveTo(250, 100);
    ctx.lineTo(300, 50);
    ctx.lineTo(350, 100);
    ctx.closePath();
    ctx.fill();
    ctx.fillRect(250, 100, 100, 100);
    ctx.fillStyle = 'white';
    ctx.fillText('Nh√† (Host)', 260, 150);
    ctx.fillStyle = '#007bff';
    ctx.font = '16px Arial';
    ctx.fillText('IP: 192.168.1.1', 240, 220);
    // Ch√∫ th√≠ch
    ctx.fillStyle = '#333';
    ctx.font = '14px Arial';
    ctx.fillText('Ph·∫ßn ƒë·∫ßu: Qu·∫≠n/Ph∆∞·ªùng (Network)', 50, 270);
    ctx.fillText('Ph·∫ßn sau: S·ªë nh√† (Host)', 350, 270);
}

// Chuy·ªÉn IP sang binary
function convertToBinary() {
    const ip = document.getElementById('ipInputBinary').value.trim();
    const resultDiv = document.getElementById('binaryResult');
    const parts = ip.split('.').map(Number);
    if (parts.length !== 4 || parts.some(p => isNaN(p) || p < 0 || p > 255)) {
        resultDiv.innerHTML = '<p style="color:red;">IP sai r·ªìi, th·ª≠ l·∫°i nh√©! (V√≠ d·ª•: 192.168.1.1)</p>';
        return;
    }
    const binary = parts.map(p => p.toString(2).padStart(8, '0')).join(' . ');
    resultDiv.innerHTML = `<p>Nh·ªã Ph√¢n: <strong>${binary}</strong></p><p>ƒê√¢y l√† c√°ch m√°y t√≠nh ƒë·ªçc IP ƒë·∫•y!</p>`;
}

// V·∫Ω subnet nh∆∞ khu ph·ªë
function drawSubnetCity() {
    const canvas = document.getElementById('subnetCityCanvas');
    if (!canvas?.getContext) return;
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#f8f9fa';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    // V·∫Ω khu ph·ªë l·ªõn
    ctx.strokeStyle = '#dc3545';
    ctx.lineWidth = 3;
    ctx.strokeRect(50, 50, 500, 300);
    ctx.fillStyle = '#343a40';
    ctx.font = '20px Arial';
    ctx.fillText('Th√†nh Ph·ªë L·ªõn (M·∫°ng Ch√≠nh)', 150, 40);
    // V·∫Ω subnet nh·ªè
    ctx.strokeStyle = '#007bff';
    ctx.strokeRect(100, 100, 200, 200);
    ctx.fillText('Khu Ph·ªë Con (Subnet)', 110, 320);
    // V·∫Ω nh√† trong subnet
    for (let i = 0; i < 3; i++) {
        ctx.fillStyle = '#28a745';
        ctx.fillRect(120 + i * 60, 150, 40, 40);
        ctx.fillStyle = 'white';
        ctx.font = '12px Arial';
        ctx.fillText('Nh√†', 125 + i * 60, 170);
    }
    // Ch√∫ th√≠ch
    ctx.fillStyle = '#333';
    ctx.font = '14px Arial';
    ctx.fillText('Subnet Mask chia khu l·ªõn th√†nh nh·ªè, d·ªÖ qu·∫£n l√Ω h∆°n.', 50, 370);
}

// C·∫≠p nh·∫≠t CIDR
function updateCidr() {
    const cidr = document.getElementById('cidrSlider').value;
    document.getElementById('cidrValue').textContent = cidr;
    const bitBar = document.getElementById('bitBar');
    bitBar.innerHTML = '';
    for (let i = 0; i < 32; i++) {
        const bitDiv = document.createElement('div');
        bitDiv.className = 'bit ' + (i < cidr ? 'network-bit' : 'host-bit');
        bitDiv.title = i < cidr ? 'Network Bit' : 'Host Bit';
        bitDiv.textContent = i < cidr ? 'N' : 'H';
        bitBar.appendChild(bitDiv);
    }
    const hosts = Math.pow(2, 32 - cidr);
    const availableHosts = (hosts > 2) ? hosts - 2 : 0;
    document.getElementById('hostCount').textContent = availableHosts.toLocaleString();
    drawAddressRange(cidr);
}

// V·∫Ω d·∫£i ƒë·ªãa ch·ªâ
function drawAddressRange(cidr) {
    const canvas = document.getElementById('addressRangeCanvas');
    if (!canvas?.getContext) return;
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = '#f8f9fa';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    // V·∫Ω thanh d·∫£i
    ctx.fillStyle = '#e9ecef';
    ctx.fillRect(50, 80, 500, 20);
    ctx.fillStyle = '#007bff';
    ctx.fillRect(50, 80, (cidr / 32) * 500, 20);
    ctx.fillStyle = '#28a745';
    ctx.fillRect(50 + (cidr / 32) * 500, 80, ((32 - cidr) / 32) * 500, 20);

    ctx.fillStyle = '#333';
    ctx.font = '16px Arial';
    ctx.fillText('D·∫£i ƒê·ªãa Ch·ªâ To√†n B·ªô (32 bit)', 150, 50);
    ctx.fillText('Ph·∫ßn Khu Ph·ªë (Network)', 60, 120);
    ctx.fillText('Ph·∫ßn Nh√† (Host)', 450, 120);
}

// T√≠nh subnet
function calculateSubnet() {
    const ip = document.getElementById('ipInputSubnet').value.trim();
    const cidrStr = document.getElementById('cidrInputSubnet').value.trim();
    const resultDiv = document.getElementById('subnetResult');
    if (!ip || !cidrStr) {
        resultDiv.innerHTML = '<p style="color:red;">Vui l√≤ng nh·∫≠p IP v√† CIDR!</p>';
        return;
    }
    const cidr = parseInt(cidrStr.replace('/', ''));
    if (isNaN(cidr) || cidr < 0 || cidr > 32) {
        resultDiv.innerHTML = '<p style="color:red;">CIDR kh√¥ng h·ª£p l·ªá! (0-32)</p>';
        return;
    }
    const ipParts = ip.split('.').map(Number);
    if (ipParts.length !== 4 || ipParts.some(p => isNaN(p) || p < 0 || p > 255)) {
        resultDiv.innerHTML = '<p style="color:red;">IP kh√¥ng h·ª£p l·ªá!</p>';
        return;
    }

    const ipNum = (ipParts[0] << 24) | (ipParts[1] << 16) | (ipParts[2] << 8) | ipParts[3];
    const mask = cidr === 0 ? 0 : (~0 << (32 - cidr)) >>> 0;
    const networkNum = ipNum & mask;
    const broadcastNum = networkNum | (~mask >>> 0);
    const numHosts = Math.pow(2, 32 - cidr);
    const availableHosts = numHosts > 2 ? numHosts - 2 : 0;
    
    resultDiv.innerHTML = `
        <p><strong>ƒê·ªãa ch·ªâ m·∫°ng (Network Address):</strong> ${numToIp(networkNum)}/${cidr}</p>
        <p><strong>ƒê·ªãa ch·ªâ qu·∫£ng b√° (Broadcast Address):</strong> ${numToIp(broadcastNum)}</p>
        <p><strong>Host ƒë·∫ßu ti√™n:</strong> ${cidr < 31 ? numToIp(networkNum + 1) : 'N/A'}</p>
        <p><strong>Host cu·ªëi c√πng:</strong> ${cidr < 31 ? numToIp(broadcastNum - 1) : 'N/A'}</p>
        <p><strong>S·ªë Host kh·∫£ d·ª•ng:</strong> ${availableHosts.toLocaleString()}</p>
    `;
}

// Ki·ªÉm tra IP trong subnet
function checkIpInSubnet() {
    const networkStr = document.getElementById('networkInput').value.trim();
    const checkIp = document.getElementById('checkIpInput').value.trim();
    const resultDiv = document.getElementById('checkResult');
    if (!networkStr || !checkIp) {
        resultDiv.innerHTML = '<p style="color:red;">Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß!</p>';
        return;
    }
    const [netIp, cidrStr] = networkStr.split('/');
    if (!netIp || !cidrStr) {
        resultDiv.innerHTML = '<p style="color:red;">ƒê·ªãnh d·∫°ng Network sai (v√≠ d·ª•: 192.168.1.0/24)</p>';
        return;
    }
    const cidr = parseInt(cidrStr);
    if (isNaN(cidr) || cidr < 0 || cidr > 32) {
        resultDiv.innerHTML = '<p style="color:red;">CIDR kh√¥ng h·ª£p l·ªá!</p>';
        return;
    }
    const netParts = netIp.split('.').map(Number);
    const checkParts = checkIp.split('.').map(Number);
    if (netParts.length !== 4 || checkParts.length !== 4 || netParts.some(isNaN) || checkParts.some(isNaN)) {
        resultDiv.innerHTML = '<p style="color:red;">IP kh√¥ng h·ª£p l·ªá!</p>';
        return;
    }
    
    const mask = cidr === 0 ? 0 : (~0 << (32 - cidr)) >>> 0;
    const netNum = (netParts[0] << 24) | (netParts[1] << 16) | (netParts[2] << 8) | netParts[3];
    const checkNum = (checkParts[0] << 24) | (checkParts[1] << 16) | (checkParts[2] << 8) | checkParts[3];
    const isIn = (checkNum & mask) === (netNum & mask);
    resultDiv.innerHTML = `<p style="color:${isIn ? 'green' : 'red'}; font-weight: bold;">${isIn ? '‚úîÔ∏è C√≥, IP n√†y thu·ªôc subnet.' : '‚ùå Kh√¥ng, IP n√†y kh√¥ng thu·ªôc subnet.'}</p>`;
}

// --- Modified Quiz Functions ---
function checkQuiz() {
    const ans1 = document.getElementById('quiz1').value;
    const ans2 = document.getElementById('quiz2').value;
    const ans3 = document.getElementById('quiz3').value;
    let score = 0;
    let feedback = '<ul>';
    if (ans1 === '32') { score++; feedback += '<li style="color:green;">C√¢u 1 ƒë√∫ng!</li>'; } else { feedback += '<li style="color:red;">C√¢u 1 sai: IP IPv4 c√≥ 32 bit (4 nh√≥m 8 bit).</li>'; }
    if (ans2 === '24') { score++; feedback += '<li style="color:green;">C√¢u 2 ƒë√∫ng!</li>'; } else { feedback += '<li style="color:red;">C√¢u 2 sai: /24 c√≥ 24 bit cho network.</li>'; }
    if (ans3 === '254') { score++; feedback += '<li style="color:green;">C√¢u 3 ƒë√∫ng!</li>'; } else { feedback += '<li style="color:red;">C√¢u 3 sai: S·ªë host l√† 2^(32-24) - 2 = 254.</li>'; }
    feedback += '</ul>';
    const resultMessage = `<h3>K·∫øt qu·∫£: B·∫°n ƒë√∫ng ${score}/3 c√¢u!</h3> ${feedback}`;
    showModal(resultMessage);
    if (score === 3) saveProgress('step4');
}

function checkAdvancedQuiz() {
    const ans4 = document.getElementById('quiz4').value;
    const ans5 = document.getElementById('quiz5').value;
    let score = 0;
    let feedback = '<ul>';
    if (ans4 === '30') { score++; feedback += '<li style="color:green;">C√¢u 1 ƒë√∫ng!</li>'; } else { feedback += '<li style="color:red;">C√¢u 1 sai: V·ªõi /27, c√≥ 32-27=5 bit host. S·ªë host l√† 2^5 - 2 = 30.</li>'; }
    if (ans5 === 'private') { score++; feedback += '<li style="color:green;">C√¢u 2 ƒë√∫ng!</li>'; } else { feedback += '<li style="color:red;">C√¢u 2 sai: IP 10.x.x.x l√† IP Private.</li>'; }
    feedback += '</ul>';
    const resultMessage = `<h3>K·∫øt qu·∫£: B·∫°n ƒë√∫ng ${score}/2 c√¢u!</h3> ${feedback}`;
    showModal(resultMessage);
    if (score === 2) saveProgress('step8');
}

function checkFinalQuiz() {
    const ans6 = document.getElementById('quiz6').value;
    const ans7 = document.getElementById('quiz7').value;
    const ans8 = document.getElementById('quiz8').value;
    let score = 0;
    let feedback = '<ul>';
    if (ans6 === 'ch·∫∑n') { score++; feedback += '<li style="color:green;">C√¢u 1 ƒë√∫ng!</li>'; } else { feedback += '<li style="color:red;">C√¢u 1 sai: Firewall l·ªçc v√† ch·∫∑n l∆∞u l∆∞·ª£ng nguy hi·ªÉm.</li>'; }
    if (ans7 === 'm√£ h√≥a') { score++; feedback += '<li style="color:green;">C√¢u 2 ƒë√∫ng!</li>'; } else { feedback += '<li style="color:red;">C√¢u 2 sai: VPN t·∫°o k·∫øt n·ªëi m√£ h√≥a an to√†n qua internet.</li>'; }
    if (ans8 === 'ssid pass') { score++; feedback += '<li style="color:green;">C√¢u 3 ƒë√∫ng!</li>'; } else { feedback += '<li style="color:red;">C√¢u 3 sai: Wi-Fi c·∫ßn SSID v√† m·∫≠t kh·∫©u ƒë·ªÉ k·∫øt n·ªëi an to√†n.</li>'; }
    feedback += '</ul>';
    const resultMessage = `<h3>K·∫øt qu·∫£: B·∫°n ƒë√∫ng ${score}/3 c√¢u!</h3> ${feedback}`;
    showModal(resultMessage);
    if (score === 3) saveProgress('step18');
}

function checkTotalQuiz() {
    const ans9 = document.getElementById('quiz9').value;
    const ans10 = document.getElementById('quiz10').value;
    const ans11 = document.getElementById('quiz11').value;
    let score = 0;
    let feedback = '<ul>';
    if (ans9 === 'http') { score++; feedback += '<li style="color:green;">C√¢u 1 ƒë√∫ng!</li>'; } else { feedback += '<li style="color:red;">C√¢u 1 sai: Port 80 l√† c·ªïng m·∫∑c ƒë·ªãnh cho HTTP (Web).</li>'; }
    if (ans10 === 'udp') { score++; feedback += '<li style="color:green;">C√¢u 2 ƒë√∫ng!</li>'; } else { feedback += '<li style="color:red;">C√¢u 2 sai: Video streaming ∆∞u ti√™n t·ªëc ƒë·ªô n√™n d√πng UDP.</li>'; }
    if (ans11 === 'network') { score++; feedback += '<li style="color:green;">C√¢u 3 ƒë√∫ng!</li>'; } else { feedback += '<li style="color:red;">C√¢u 3 sai: T·∫ßng 3 (Network) x·ª≠ l√Ω ƒë·ªãa ch·ªâ IP v√† ƒë·ªãnh tuy·∫øn.</li>'; }
    feedback += '</ul>';
    const resultMessage = `<h3>K·∫øt qu·∫£: B·∫°n ƒë√∫ng ${score}/3 c√¢u!</h3> ${feedback}`;
    showModal(resultMessage);
    if (score === 3) saveProgress('step22');
}


// V·∫Ω m√¥ ph·ªèng m·∫°ng
function drawNetworkSimulation() {
    const canvas = document.getElementById('networkSimulationCanvas');
    if (!canvas?.getContext) return;
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#f8f9fa';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    // V·∫Ω router
    ctx.fillStyle = '#007bff';
    ctx.beginPath();
    ctx.arc(400, 100, 50, 0, 2 * Math.PI);
    ctx.fill();
    ctx.fillStyle = 'white';
    ctx.font = '20px Arial';
    ctx.fillText('Router', 365, 105);
    ctx.fillStyle = '#333';
    ctx.font = '14px Arial';
    ctx.fillText('IP: 192.168.1.1/24', 350, 140);
    // V·∫Ω hosts
    const hosts = [{ x: 200, y: 300, ip: '192.168.1.10' }, { x: 400, y: 300, ip: '192.168.1.20' }, { x: 600, y: 300, ip: '192.168.1.30' }];
    hosts.forEach(host => {
        ctx.fillStyle = '#28a745';
        ctx.beginPath();
        ctx.arc(host.x, host.y, 40, 0, 2 * Math.PI);
        ctx.fill();
        ctx.fillStyle = 'white';
        ctx.font = '16px Arial';
        ctx.fillText('Host', host.x - 20, host.y + 5);
        ctx.fillStyle = '#333';
        ctx.font = '12px Arial';
        ctx.fillText(`IP: ${host.ip}`, host.x - 40, host.y + 50);
        // K·∫øt n·ªëi
        ctx.strokeStyle = '#6c757d';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(400, 150);
        ctx.lineTo(host.x, host.y - 40);
        ctx.stroke();
    });
    ctx.font = '18px Arial';
    ctx.fillText('M·∫°ng LAN V·ªõi Subnet 192.168.1.0/24', 250, 50);
}

// V·∫Ω subnetting
function drawSubnetting() {
    const canvas = document.getElementById('subnettingCanvas');
    if (!canvas?.getContext) return;
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#f8f9fa';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = '#333';
    ctx.font = '20px Arial';
    // V·∫Ω m·∫°ng l·ªõn
    ctx.strokeStyle = '#dc3545';
    ctx.lineWidth = 3;
    ctx.strokeRect(100, 50, 400, 100);
    ctx.fillText('M·∫°ng G·ªëc /24', 220, 40);
    // V·∫Ω subnet nh·ªè
    for (let i = 0; i < 4; i++) {
        ctx.strokeStyle = '#007bff';
        ctx.strokeRect(100 + i * 100, 200, 100, 100);
        ctx.fillText(`Subnet ${i + 1} /26`, 105 + i * 100, 320);
    }
    // K·∫øt n·ªëi
    for (let i = 0; i < 4; i++) {
        ctx.strokeStyle = '#6c757d';
        ctx.beginPath();
        ctx.moveTo(300, 150);
        ctx.lineTo(150 + i * 100, 200);
        ctx.stroke();
    }
    ctx.fillText('Chia th√†nh 4 subnet', 220, 370);
}

// T√≠nh to√°n chia subnet
function calculateSubnets() {
    const baseStr = document.getElementById('baseNetwork').value.trim();
    const numSubnets = parseInt(document.getElementById('numSubnets').value);
    const resultDiv = document.getElementById('subnettingResult');
    if (!baseStr || isNaN(numSubnets) || numSubnets < 2) {
        resultDiv.innerHTML = '<p style="color:red;">Nh·∫≠p ƒë√∫ng network v√† s·ªë subnet (l·ªõn h∆°n 1)!</p>';
        return;
    }
    const [baseIp, baseCidrStr] = baseStr.split('/');
    if (!baseIp || !baseCidrStr) {
        resultDiv.innerHTML = '<p style="color:red;">ƒê·ªãnh d·∫°ng Network sai (v√≠ d·ª•: 192.168.1.0/24)</p>';
        return;
    }

    const baseCidr = parseInt(baseCidrStr);
    const baseParts = baseIp.split('.').map(Number);
    const baseNum = (baseParts[0] << 24) | (baseParts[1] << 16) | (baseParts[2] << 8) | baseParts[3];
    const bitsNeeded = Math.ceil(Math.log2(numSubnets));
    const newCidr = baseCidr + bitsNeeded;
    if (newCidr > 32) {
        resultDiv.innerHTML = '<p style="color:red;">Kh√¥ng ƒë·ªß bit ƒë·ªÉ chia!</p>';
        return;
    }
    const subnetSize = Math.pow(2, 32 - newCidr);
    let output = '<p>C√°c Subnet:</p><ul>';
    for (let i = 0; i < numSubnets; i++) {
        const subnetNum = baseNum + i * subnetSize;
        const network = numToIp(subnetNum);
        const broadcast = numToIp(subnetNum + subnetSize - 1);
        output += `<li><strong>Subnet ${i+1}:</strong> ${network}/${newCidr} (Broadcast: ${broadcast})</li>`;
    }
    output += '</ul>';
    resultDiv.innerHTML = output;
}

// V·∫Ω public private
function drawPublicPrivate() {
    const canvas = document.getElementById('publicPrivateCanvas');
    if (!canvas?.getContext) return;
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#f8f9fa';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    // V·∫Ω private network
    ctx.fillStyle = '#28a745';
    ctx.fillRect(50, 100, 200, 100);
    ctx.fillStyle = 'white';
    ctx.fillText('Private Network', 80, 150);
    // V·∫Ω public internet
    ctx.fillStyle = '#007bff';
    ctx.beginPath();
    ctx.arc(450, 150, 80, 0, 2 * Math.PI);
    ctx.fill();
    ctx.fillStyle = 'white';
    ctx.fillText('Public Internet', 400, 150);
    // K·∫øt n·ªëi
    ctx.strokeStyle = '#dc3545';
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(250, 150);
    ctx.lineTo(370, 150);
    ctx.stroke();
    ctx.fillStyle = '#333';
    ctx.fillText('Router (NAT)', 280, 170);
}

// Ki·ªÉm tra lo·∫°i IP
function checkIpType() {
    const ip = document.getElementById('ipTypeInput').value.trim();
    const resultDiv = document.getElementById('ipTypeResult');
    const parts = ip.split('.').map(Number);
    if (parts.length !== 4 || parts.some(p => isNaN(p) || p < 0 || p > 255)) {
        resultDiv.innerHTML = '<p style="color:red;">IP kh√¥ng h·ª£p l·ªá!</p>';
        return;
    }
    const isPrivate = (parts[0] === 10) || (parts[0] === 172 && parts[1] >= 16 && parts[1] <= 31) || (parts[0] === 192 && parts[1] === 168);
    resultDiv.innerHTML = `<p style="font-weight: bold;">${isPrivate ? 'ƒê√¢y l√† IP Private' : 'ƒê√¢y l√† IP Public'}</p>`;
}

// V·∫Ω VLSM
function drawVlsm() {
    const canvas = document.getElementById('vlsmCanvas');
    if (!canvas?.getContext) return;
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#f8f9fa';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    // V·∫Ω m·∫°ng l·ªõn
    ctx.strokeStyle = '#dc3545';
    ctx.lineWidth = 3;
    ctx.strokeRect(50, 50, 500, 50);
    ctx.fillStyle = '#333';
    ctx.fillText('M·∫°ng G·ªëc /16', 250, 40);
    // V·∫Ω subnet kh√°c k√≠ch th∆∞·ªõc
    ctx.strokeStyle = '#007bff';
    ctx.strokeRect(50, 150, 300, 50);
    ctx.fillText('Subnet /18 (for 16k hosts)', 60, 180);
    ctx.strokeStyle = '#28a745';
    ctx.strokeRect(50, 250, 150, 50);
    ctx.fillText('Subnet /20 (for 4k hosts)', 60, 280);
    ctx.strokeStyle = '#ffc107';
    ctx.strokeRect(250, 250, 100, 50);
    ctx.fillText('Subnet /22 (for 1k hosts)', 260, 280);
    ctx.fillStyle = '#333';
    ctx.fillText('VLSM ti·∫øt ki·ªám IP b·∫±ng c√°ch chia subnet v·ªõi k√≠ch th∆∞·ªõc kh√°c nhau', 50, 350);
}

// T√≠nh VLSM
function calculateVLSM() {
    const baseStr = document.getElementById('vlsmNetwork').value.trim();
    const hostsStr = document.getElementById('vlsmHosts').value.trim();
    const resultDiv = document.getElementById('vlsmResult');
    if (!baseStr || !hostsStr) {
        resultDiv.innerHTML = '<p style="color:red;">Nh·∫≠p ƒë·∫ßy ƒë·ªß!</p>';
        return;
    }
    const [baseIp, baseCidrStr] = baseStr.split('/');
    const baseCidr = parseInt(baseCidrStr);
    const baseParts = baseIp.split('.').map(Number);
    if (baseParts.some(isNaN) || isNaN(baseCidr)) {
        resultDiv.innerHTML = '<p style="color:red;">Network g·ªëc kh√¥ng h·ª£p l·ªá!</p>';
        return;
    }
    const baseNum = (baseParts[0] << 24) | (baseParts[1] << 16) | (baseParts[2] << 8) | baseParts[3];
    let hosts = hostsStr.split(',').map(Number).filter(n => n > 0).sort((a,b) => b - a);
    if(hosts.some(isNaN)) {
         resultDiv.innerHTML = '<p style="color:red;">S·ªë host kh√¥ng h·ª£p l·ªá!</p>';
        return;
    }
    let currentNum = baseNum;
    let output = '<p>C√°c Subnet ƒë√£ chia:</p><ul>';
    let error = false;
    hosts.forEach(hostReq => {
        if(error) return;
        const bitsNeeded = Math.ceil(Math.log2(hostReq + 2));
        const newCidr = 32 - bitsNeeded;
        if(newCidr < baseCidr) {
            output += `<li style="color:red;">L·ªói: Y√™u c·∫ßu ${hostReq} host qu√° l·ªõn cho m·∫°ng g·ªëc!</li>`;
            error = true;
            return;
        }
        const subnetSize = Math.pow(2, bitsNeeded);
        const network = numToIp(currentNum);
        const broadcast = numToIp(currentNum + subnetSize - 1);
        output += `<li>Cho <strong>${hostReq} hosts</strong>: ${network}/${newCidr} (Broadcast: ${broadcast})</li>`;
        currentNum += subnetSize;
    });
    output += '</ul>';
    resultDiv.innerHTML = output;
}

// V·∫Ω IPv6
function drawIpv6() {
    const canvas = document.getElementById('ipv6Canvas');
    if (!canvas?.getContext) return;
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#f8f9fa';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    // IPv4
    ctx.fillStyle = '#007bff';
    ctx.fillRect(50, 100, 150, 50);
    ctx.fillStyle = 'white';
    ctx.font = '18px Arial';
    ctx.fillText('IPv4: 32 bit', 60, 130);
    // IPv6
    ctx.fillStyle = '#28a745';
    ctx.fillRect(50, 200, 450, 50);
    ctx.fillStyle = 'white';
    ctx.fillText('IPv6: 128 bit', 60, 230);
    ctx.fillStyle = '#333';
    ctx.fillText('IPv6 c√≥ kh√¥ng gian ƒë·ªãa ch·ªâ l·ªõn h∆°n r·∫•t nhi·ªÅu so v·ªõi IPv4', 100, 270);
}

// Map IPv4 to IPv6
function mapIpv4ToIpv6() {
    const ip = document.getElementById('ipv4ToIpv6').value.trim();
    const resultDiv = document.getElementById('ipv6Result');
    const parts = ip.split('.').map(Number);
    if (parts.length !== 4 || parts.some(p => isNaN(p) || p < 0 || p > 255)) {
        resultDiv.innerHTML = '<p style="color:red;">IP kh√¥ng h·ª£p l·ªá!</p>';
        return;
    }
    const hex1 = (parts[0] * 256 + parts[1]).toString(16).padStart(4, '0');
    const hex2 = (parts[2] * 256 + parts[3]).toString(16).padStart(4, '0');
    resultDiv.innerHTML = `<p>IPv4-mapped IPv6 Address: <strong>::ffff:${parts.join('.')}</strong> or <strong>::ffff:${hex1}:${hex2}</strong></p>`;
}

// V·∫Ω NAT
function drawNat() {
    const canvas = document.getElementById('natCanvas');
    if (!canvas?.getContext) return;
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#f8f9fa';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    // V·∫Ω private hosts
    for (let i = 0; i < 3; i++) {
        ctx.fillStyle = '#28a745';
        ctx.fillRect(50 + i * 100, 200, 80, 50);
        ctx.fillStyle = '#333';
        ctx.fillText('192.168.1.' + (10+i), 50 + i*100, 270);
    }
    // V·∫Ω router
    ctx.fillStyle = '#007bff';
    ctx.beginPath();
    ctx.arc(300, 100, 50, 0, 2 * Math.PI);
    ctx.fill();
    ctx.fillStyle = 'white';
    ctx.fillText('NAT Router', 260, 105);
    ctx.fillStyle = '#333';
    ctx.fillText('Public IP: 203.0.113.1', 250, 170);
    // K·∫øt n·ªëi private
    for (let i = 0; i < 3; i++) {
        ctx.strokeStyle = '#6c757d';
        ctx.beginPath();
        ctx.moveTo(90 + i * 100, 200);
        ctx.lineTo(300, 150);
        ctx.stroke();
    }
    // Internet
    ctx.fillStyle = '#dc3545';
    ctx.beginPath();
    ctx.arc(500, 100, 60, 0, 2 * Math.PI);
    ctx.fill();
    ctx.fillStyle = 'white';
    ctx.fillText('Internet', 470, 105);
    ctx.strokeStyle = '#6c757d';
    ctx.beginPath();
    ctx.moveTo(350, 100);
    ctx.lineTo(440, 100);
    ctx.stroke();
}

// V·∫Ω DHCP
function drawDhcp() {
    const canvas = document.getElementById('dhcpCanvas');
    if (!canvas?.getContext) return;
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#f8f9fa';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    // V·∫Ω client
    ctx.fillStyle = '#28a745';
    ctx.fillRect(50, 100, 100, 100);
    ctx.fillStyle = 'white';
    ctx.fillText('Client', 80, 150);
    // V·∫Ω DHCP server
    ctx.fillStyle = '#007bff';
    ctx.fillRect(450, 100, 100, 100);
    ctx.fillStyle = 'white';
    ctx.fillText('DHCP Server', 455, 150);
    // Arrows
    ctx.fillStyle = '#333';
    ctx.fillText('1. DHCP Discover ‚ûî', 170, 120);
    ctx.fillText('2. DHCP Offer ü†ê', 170, 150);
    ctx.fillText('3. DHCP Request ‚ûî', 170, 180);
    ctx.fillText('4. DHCP ACK ü†ê', 170, 210);
}

// M√¥ ph·ªèng DHCP
function requestDhcpIp() {
    const mac = document.getElementById('macInput').value.trim() || '00:11:22:33:44:55';
    const ip = '192.168.1.' + Math.floor(Math.random() * 254 + 2);
    document.getElementById('dhcpResult').innerHTML = `<p>MAC <strong>${mac}</strong> nh·∫≠n IP: <strong>${ip}</strong></p>`;
}

// V·∫Ω DNS
function drawDns() {
    const canvas = document.getElementById('dnsCanvas');
    if (!canvas?.getContext) return;
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#f8f9fa';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    // V·∫Ω client
    ctx.fillStyle = '#28a745';
    ctx.fillRect(50, 100, 100, 100);
    ctx.fillStyle = 'white';
    ctx.fillText('Client', 80, 150);
    // V·∫Ω DNS server
    ctx.fillStyle = '#007bff';
    ctx.fillRect(450, 100, 100, 100);
    ctx.fillStyle = 'white';
    ctx.fillText('DNS Server', 455, 150);
    // K·∫øt n·ªëi
    ctx.fillStyle = '#333';
    ctx.fillText('Query: "example.com"? ‚ûî', 170, 140);
    ctx.fillText('ü†ê Response: "93.184.216.34"', 170, 180);
}

// M√¥ ph·ªèng DNS
function resolveDns() {
    const domain = document.getElementById('domainInput').value.trim() || 'example.com';
    const ip = Math.floor(Math.random() * 256) + '.' + Math.floor(Math.random() * 256) + '.' + Math.floor(Math.random() * 256) + '.' + Math.floor(Math.random() * 254 + 1);
    document.getElementById('dnsResult').innerHTML = `<p><strong>${domain}</strong> -> <strong>${ip}</strong></p>`;
}

// V·∫Ω Routing
function drawRouting() {
    const canvas = document.getElementById('routingCanvas');
    if (!canvas?.getContext) return;
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#f8f9fa';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    // V·∫Ω m·∫°ng 1
    ctx.strokeStyle = '#28a745';
    ctx.strokeRect(50, 100, 200, 200);
    ctx.fillStyle = '#333';
    ctx.fillText('M·∫°ng 1: 192.168.1.0/24', 60, 80);
    // V·∫Ω router
    ctx.fillStyle = '#007bff';
    ctx.beginPath();
    ctx.arc(350, 200, 50, 0, 2 * Math.PI);
    ctx.fill();
    ctx.fillStyle = 'white';
    ctx.fillText('Router', 320, 205);
    // V·∫Ω m·∫°ng 2
    ctx.strokeStyle = '#dc3545';
    ctx.strokeRect(450, 100, 200, 200);
    ctx.fillStyle = '#333';
    ctx.fillText('M·∫°ng 2: 192.168.2.0/24', 460, 80);
    // K·∫øt n·ªëi
    ctx.strokeStyle = '#6c757d';
    ctx.beginPath();
    ctx.moveTo(250, 200);
    ctx.lineTo(300, 200);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(400, 200);
    ctx.lineTo(450, 200);
    ctx.stroke();
    ctx.fillText('ƒê·ªãnh tuy·∫øn d·ªØ li·ªáu gi·ªØa c√°c m·∫°ng', 200, 350);
}

// Ki·ªÉm tra routing
function checkRouting() {
    const source = document.getElementById('sourceIp').value.trim();
    const dest = document.getElementById('destIp').value.trim();
    const maskStr = document.getElementById('maskInput').value.trim();
    const resultDiv = document.getElementById('routingResult');
    if (!source || !dest || !maskStr) {
        resultDiv.innerHTML = '<p style="color:red;">Nh·∫≠p ƒë·∫ßy ƒë·ªß!</p>';
        return;
    }
    const sourceParts = source.split('.').map(Number);
    const destParts = dest.split('.').map(Number);
    const maskParts = maskStr.split('.').map(Number);
    if (sourceParts.length !== 4 || destParts.length !== 4 || maskParts.length !== 4 || sourceParts.some(isNaN) || destParts.some(isNaN) || maskParts.some(isNaN)) {
        resultDiv.innerHTML = '<p style="color:red;">Format sai!</p>';
        return;
    }
    const sourceNum = (sourceParts[0] << 24) | (sourceParts[1] << 16) | (sourceParts[2] << 8) | sourceParts[3];
    const destNum = (destParts[0] << 24) | (destParts[1] << 16) | (destParts[2] << 8) | destParts[3];
    const maskNum = (maskParts[0] << 24) | (maskParts[1] << 16) | (maskParts[2] << 8) | maskParts[3];
    const sameNetwork = (sourceNum & maskNum) === (destNum & maskNum);
    resultDiv.innerHTML = `<p style="font-weight:bold;">${sameNetwork ? 'C√πng m·∫°ng, kh√¥ng c·∫ßn router.' : 'Kh√°c m·∫°ng, c·∫ßn router.'}</p>`;
}

// V·∫Ω Firewall
function drawFirewall(packetX, status) {
    const canvas = document.getElementById('firewallCanvas');
     if (!canvas?.getContext) return;
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#f8f9fa';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    // V·∫Ω m·∫°ng n·ªôi b·ªô
    ctx.fillStyle = '#28a745';
    ctx.fillRect(50, 150, 150, 100);
    ctx.fillStyle = 'white';
    ctx.fillText('M·∫°ng N·ªôi B·ªô', 70, 200);
    // V·∫Ω firewall
    ctx.fillStyle = '#dc3545';
    ctx.fillRect(300, 100, 20, 200);
    ctx.fillStyle = 'white';
    ctx.save();
    ctx.translate(310, 200);
    ctx.rotate(-Math.PI/2);
    ctx.textAlign = 'center';
    ctx.fillText('FIREWALL', 0, 5);
    ctx.restore();
    // V·∫Ω internet
    ctx.fillStyle = '#007bff';
    ctx.beginPath();
    ctx.arc(500, 200, 50, 0, 2 * Math.PI);
    ctx.fill();
    ctx.fillStyle = 'white';
    ctx.fillText('Internet', 470, 205);
    
    if (packetX) {
        ctx.fillStyle = status === 'blocked' ? '#ff0000' : '#00ff00';
        ctx.beginPath();
        ctx.arc(packetX, 200, 10, 0, 2 * Math.PI);
        ctx.fill();

        if (status) {
            ctx.font = '20px Arial';
            ctx.fillStyle = status === 'blocked' ? '#ff0000' : '#00ff00';
            ctx.fillText(status === 'blocked' ? 'Ch·∫∑n!' : 'Cho ph√©p!', 350, 150);
        }
    }
}
let firewallAnimationId;
// Animation firewall
function animateFirewall() {
    cancelAnimationFrame(firewallAnimationId);
    let x = 450;
    const isBlocked = Math.random() > 0.5;
    function animate() {
        if ((isBlocked && x <= 330) || (!isBlocked && x <= 200)) {
            drawFirewall(x, isBlocked ? 'blocked' : 'allowed');
            return;
        }
        drawFirewall(x);
        x -= 5;
        firewallAnimationId = requestAnimationFrame(animate);
    }
    animate();
}

// Ki·ªÉm tra firewall
function checkFirewall() {
    const ip = document.getElementById('fwIp').value.trim();
    const port = parseInt(document.getElementById('fwPort').value);
    let blocked = false;
    // Simple rule: block 10.x.x.x on port 80
    if (ip.startsWith('10.') && port === 80) blocked = true;
    document.getElementById('fwResult').innerHTML = `<p style="font-weight:bold; color:${blocked ? 'red' : 'green'}">${blocked ? 'Ch·∫∑n!' : 'Cho ph√©p!'}</p>`;
}
// V·∫Ω VPN
function drawVpn() {
    const canvas = document.getElementById('vpnCanvas');
    if (!canvas?.getContext) return;
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#f8f9fa';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    // V·∫Ω user
    ctx.fillStyle = '#28a745';
    ctx.fillRect(50, 100, 100, 100);
    ctx.fillStyle = 'white';
    ctx.fillText('User', 80, 150);
    // V·∫Ω VPN server
    ctx.fillStyle = '#007bff';
    ctx.fillRect(450, 100, 100, 100);
    ctx.fillStyle = 'white';
    ctx.fillText('VPN Server', 455, 150);
    // ƒê∆∞·ªùng h·∫ßm
    ctx.fillStyle = 'rgba(220, 53, 69, 0.5)';
    ctx.fillRect(150, 130, 300, 40);
    ctx.fillStyle = '#333';
    ctx.fillText('ƒê∆∞·ªùng H·∫ßm An To√†n (Encrypted Tunnel)', 180, 180);
}
let vpnAnimationId;
// Animation VPN
function animateVpn() {
    cancelAnimationFrame(vpnAnimationId);
    const canvas = document.getElementById('vpnCanvas');
    if (!canvas?.getContext) return;
    const ctx = canvas.getContext('2d');
    let x = 160;

    function animate() {
        drawVpn(); // Redraws static background
        
        ctx.fillStyle = '#ffcc00';
        ctx.beginPath();
        ctx.arc(x, 150, 15, 0, 2 * Math.PI);
        ctx.fill();
        x += 5;

        if (x < 450) {
            vpnAnimationId = requestAnimationFrame(animate);
        } else {
            drawVpn(); // Redraw to clear animated dot
            ctx.fillStyle = '#00ff00';
            ctx.font = '20px Arial';
            ctx.fillText('K·∫øt N·ªëi!', 460, 150);
        }
    }
    animate();
}

// M√¥ ph·ªèng k·∫øt n·ªëi VPN
function connectVpn() {
    const server = document.getElementById('vpnServer').value.trim() || 'vpn.example.com';
    const ip = document.getElementById('userIp').value.trim() || '192.168.1.10';
    document.getElementById('vpnResult').innerHTML = `<p>K·∫øt n·ªëi ƒë·∫øn <strong>${server}</strong> t·ª´ <strong>${ip}</strong> th√†nh c√¥ng!</p>`;
}

// V·∫Ω Wi-Fi
function drawWifi(radius) {
    const canvas = document.getElementById('wifiCanvas');
    if (!canvas?.getContext) return;
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#f8f9fa';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    // V·∫Ω router
    ctx.fillStyle = '#007bff';
    ctx.beginPath();
    ctx.arc(300, 200, 30, 0, 2 * Math.PI);
    ctx.fill();
    ctx.fillStyle = 'white';
    ctx.fillText('Wi-Fi AP', 270, 205);
    // S√≥ng
    for (let i = 1; i <= 3; i++) {
        ctx.strokeStyle = '#007bff';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.arc(300, 200, 40 + i * 20, -Math.PI/3, Math.PI/3);
        ctx.stroke();
    }
    // Thi·∫øt b·ªã
    ctx.fillStyle = '#28a745';
    ctx.fillRect(50, 150, 50, 50);
    ctx.fillText('Device', 50, 220);
    ctx.fillRect(500, 150, 50, 50);
    ctx.fillText('Device', 500, 220);
    
    if (radius) {
         ctx.strokeStyle = '#ffff00';
         ctx.lineWidth = 4;
         ctx.beginPath();
         ctx.arc(300, 200, radius, 0, 2 * Math.PI);
         ctx.stroke();
    }
}
let wifiAnimationId;
// Animation Wi-Fi
function animateWifi() {
    cancelAnimationFrame(wifiAnimationId);
    const canvas = document.getElementById('wifiCanvas');
    if (!canvas?.getContext) return;
    const ctx = canvas.getContext('2d');
    let radius = 40;

    function animate() {
        drawWifi(radius);
        radius += 5;
        if (radius < 250) {
            wifiAnimationId = requestAnimationFrame(animate);
        } else {
             // The animation is over, just draw the text on top
             ctx.fillStyle = '#00ff00';
             ctx.font = '20px Arial';
             ctx.fillText('K·∫øt N·ªëi!', 250, 300);
        }
    }
    animate();
}

// M√¥ ph·ªèng k·∫øt n·ªëi Wi-Fi
function connectWifi() {
    const ssid = document.getElementById('ssidInput').value.trim() || 'MyWiFi';
    const pass = document.getElementById('wifiPass').value.trim();
    if(pass === '123456'){
        document.getElementById('wifiResult').innerHTML = `<p>K·∫øt n·ªëi ƒë·∫øn SSID <strong>${ssid}</strong> th√†nh c√¥ng!</p>`;
    } else {
         document.getElementById('wifiResult').innerHTML = `<p style="color:red">Sai m·∫≠t kh·∫©u cho SSID <strong>${ssid}</strong>!</p>`;
    }
}

// V·∫Ω Port
function drawPort() {
    const canvas = document.getElementById('portCanvas');
    if (!canvas?.getContext) return;
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#f8f9fa';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    // V·∫Ω t√≤a nh√†
    ctx.fillStyle = '#6c757d';
    ctx.fillRect(200, 100, 200, 150);
    ctx.fillStyle = '#333';
    ctx.fillText('IP: 203.0.113.10 (Server)', 220, 90);
    // V·∫Ω port
    const ports = [{num: 80, name: 'Web'}, {num: 443, name: 'Secure'}, {num: 25, name: 'Email'}];
    ports.forEach((port, i) => {
        ctx.fillStyle = '#007bff';
        ctx.fillRect(220 + i*60, 160, 40, 40);
        ctx.fillStyle = 'white';
        ctx.fillText('P:' + port.num, 222 + i*60, 185);
    });
}
let portAnimationId;
function animatePort() {
    cancelAnimationFrame(portAnimationId);
    const canvas = document.getElementById('portCanvas');
    if (!canvas?.getContext) return;
    const ctx = canvas.getContext('2d');
    let y = 50;

    function animate() {
        drawPort(); // Redraws static background
        
        ctx.fillStyle = '#ff0000';
        ctx.beginPath();
        ctx.arc(240, y, 10, 0, 2 * Math.PI);
        ctx.fill();
        y += 5;

        if (y < 170) {
            portAnimationId = requestAnimationFrame(animate);
        } else {
            drawPort(); // Redraw to clear animated dot
            ctx.fillStyle = '#00ff00';
            ctx.font = '20px Arial';
            ctx.fillText('ƒê·∫øn Port 80!', 250, 150);
        }
    }
    animate();
}

// Ki·ªÉm tra port
function checkPort() {
    const port = parseInt(document.getElementById('portInput').value);
    let service = 'Unknown/Dynamic';
    if (port === 80) service = 'HTTP (Web)';
    else if (port === 443) service = 'HTTPS (Secure Web)';
    else if (port === 21) service = 'FTP (File Transfer)';
    else if (port === 22) service = 'SSH (Secure Shell)';
    else if (port === 25) service = 'SMTP (Email)';
    else if (port === 53) service = 'DNS (Domain Name System)';
    document.getElementById('portResult').innerHTML = `<p>Port <strong>${port}</strong>: ${service}</p>`;
}
// V·∫Ω TCP UDP
function drawTcpUdp() {
    const canvas = document.getElementById('tcpUdpCanvas');
    if (!canvas?.getContext) return;
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#f8f9fa';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    // TCP
    ctx.fillStyle = '#007bff';
    ctx.fillRect(50, 100, 200, 150);
    ctx.fillStyle = 'white';
    ctx.fillText('TCP: An to√†n, tin c·∫≠y', 60, 150);
    ctx.fillText('G√≥i 1 ->', 80, 180);
    ctx.fillText('<- ACK 1', 140, 195);
    // UDP
    ctx.fillStyle = '#dc3545';
    ctx.fillRect(350, 100, 200, 150);
    ctx.fillStyle = 'white';
    ctx.fillText('UDP: Nhanh, kh√¥ng tin c·∫≠y', 360, 150);
    ctx.fillText('G√≥i 1 ->', 380, 180);
    ctx.fillText('G√≥i 2 ->', 380, 195);
    ctx.fillStyle = '#333';
    ctx.fillText('TCP cho web, email. UDP cho video, game.', 150, 300);
}

let tcpUdpAnimationId;
function animateTcpUdp() {
    cancelAnimationFrame(tcpUdpAnimationId);
    const canvas = document.getElementById('tcpUdpCanvas');
    if (!canvas?.getContext) return;
    const ctx = canvas.getContext('2d');
    let tcpX = 50, udpX = 350;
    const tcpDest = 250, udpDest = 550;

    function animate() {
        drawTcpUdp();
        
        // TCP packet
        if (tcpX < tcpDest) {
            ctx.fillStyle = '#00ff00';
            ctx.beginPath();
            ctx.arc(tcpX, 180, 10, 0, 2 * Math.PI);
            ctx.fill();
            tcpX += 2;
        } else {
            ctx.fillStyle = '#00ff00';
            ctx.beginPath();
            ctx.arc(tcpDest, 180, 10, 0, 2 * Math.PI);
            ctx.fill();
        }

        // UDP packet
        if (udpX < udpDest) {
            ctx.fillStyle = '#ffff00';
            ctx.beginPath();
            ctx.arc(udpX, 180, 10, 0, 2 * Math.PI);
            ctx.fill();
            udpX += 5;
        } else {
             ctx.fillStyle = '#ffff00';
            ctx.beginPath();
            ctx.arc(udpDest, 180, 10, 0, 2 * Math.PI);
            ctx.fill();
        }
        
        if (tcpX < tcpDest || udpX < udpDest) {
            tcpUdpAnimationId = requestAnimationFrame(animate);
        }
    }
    animate();
}

// G·ª£i √Ω protocol
function suggestProtocol() {
    const app = document.getElementById('appInput').value.trim().toLowerCase();
    let protocol = 'TCP';
    let reason = 'c·∫ßn ƒë·ªô tin c·∫≠y cao.';
    if (app.includes('video') || app.includes('game') || app.includes('stream')) {
        protocol = 'UDP';
        reason = '∆∞u ti√™n t·ªëc ƒë·ªô h∆°n ƒë·ªô tin c·∫≠y.';
    }
    document.getElementById('protocolResult').innerHTML = `<p>·ª®ng d·ª•ng <strong>${app}</strong> n√™n d√πng <strong>${protocol}</strong> v√¨ n√≥ ${reason}</p>`;
}

// V·∫Ω OSI
function drawOsi() {
    const canvas = document.getElementById('osiCanvas');
    if (!canvas?.getContext) return;
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#f8f9fa';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    const layers = ['7. Application', '6. Presentation', '5. Session', '4. Transport', '3. Network', '2. Data Link', '1. Physical'];
    for (let i = 0; i < 7; i++) {
        ctx.fillStyle = `hsl(${i*50}, 70%, 50%)`;
        ctx.fillRect(100, 50 + i * 60, 400, 50);
        ctx.fillStyle = 'white';
        ctx.font = '18px Arial';
        ctx.fillText(layers[i], 120, 80 + i * 60);
    }
    ctx.fillStyle = '#333';
    ctx.fillText('M√¥ H√¨nh OSI 7 T·∫ßng', 230, 30);
}
let osiAnimationId;
// Animation OSI
function animateOsi() {
    cancelAnimationFrame(osiAnimationId);
    const canvas = document.getElementById('osiCanvas');
    if (!canvas?.getContext) return;
    const ctx = canvas.getContext('2d');
    let y = 50;
    
    function animate() {
        drawOsi();
        ctx.strokeStyle = '#ffcc00';
        ctx.lineWidth = 5;
        ctx.strokeRect(95, y, 410, 50);
        y += 5;
        if (y > 50 + 6 * 60) {
            y = 50;
        }
        osiAnimationId = requestAnimationFrame(animate);
    }
    animate();
}

// M√¥ t·∫£ t·∫ßng OSI
function describeOsiLayer() {
    const layer = document.getElementById('osiLayer').value;
    let desc = '';
    switch (layer) {
        case '1': desc = '<strong>Physical (V·∫≠t l√Ω):</strong> Truy·ªÅn t√≠n hi·ªáu v·∫≠t l√Ω (c√°p, s√≥ng radio). V√≠ d·ª•: Ethernet cable, Wi-Fi signal.'; break;
        case '2': desc = '<strong>Data Link (Li√™n k·∫øt d·ªØ li·ªáu):</strong> Truy·ªÅn frame gi·ªØa c√°c thi·∫øt b·ªã c√πng m·∫°ng. V√≠ d·ª•: MAC Address, Switches.'; break;
        case '3': desc = '<strong>Network (M·∫°ng):</strong> ƒê·ªãnh tuy·∫øn packet gi·ªØa c√°c m·∫°ng kh√°c nhau. V√≠ d·ª•: IP Address, Routers.'; break;
        case '4': desc = '<strong>Transport (Giao v·∫≠n):</strong> ƒê·∫£m b·∫£o truy·ªÅn d·ªØ li·ªáu ƒë·∫ßu cu·ªëi. V√≠ d·ª•: TCP (tin c·∫≠y), UDP (nhanh).'; break;
        case '5': desc = '<strong>Session (Phi√™n):</strong> Qu·∫£n l√Ω, duy tr√¨, k·∫øt th√∫c phi√™n k·∫øt n·ªëi. V√≠ d·ª•: Login sessions.'; break;
        case '6': desc = '<strong>Presentation (Tr√¨nh b√†y):</strong> ƒê·ªãnh d·∫°ng, m√£ h√≥a, n√©n d·ªØ li·ªáu. V√≠ d·ª•: JPEG, SSL/TLS encryption.'; break;
        case '7': desc = '<strong>Application (·ª®ng d·ª•ng):</strong> Giao th·ª©c c·∫•p cao cho ·ª©ng d·ª•ng ng∆∞·ªùi d√πng. V√≠ d·ª•: HTTP, FTP, SMTP.'; break;
        default: desc = 'Vui l√≤ng ch·ªçn m·ªôt t·∫ßng.';
    }
    document.getElementById('osiResult').innerHTML = `<p><strong>T·∫ßng ${layer}:</strong> ${desc}</p>`;
}


// Initial drawings on page load and setup
window.onload = () => {
    // Apply saved theme
    const savedTheme = localStorage.getItem('theme') || 'light';
    applyTheme(savedTheme);

    // Load saved progress
    updateProgressUI();

    // Initial drawings
    drawIpHouse();
    drawSubnetCity();
    updateCidr();
    drawNetworkSimulation();
    drawSubnetting();
    drawPublicPrivate();
    drawVlsm();
    drawIpv6();
    drawNat();
    drawDhcp();
    drawDns();
    drawRouting();
    drawFirewall();
    drawVpn();
    drawWifi();
    drawPort();
    drawTcpUdp();
    drawOsi();

    // Initial scroll update
    updateScrollProgress();
};
</script>
</body>
</html>
